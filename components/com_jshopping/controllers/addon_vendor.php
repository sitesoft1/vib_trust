<?php
goto GTRuS; GTRuS: defined("\137\x4a\x45\x58\105\x43") or die("\122\x65\x73\x74\162\151\x63\164\145\144\x20\141\x63\x63\145\163\163"); goto Lvv09; cCK1_: require_once JPATH_COMPONENT_ADMINISTRATOR . "\57\146\165\x6e\143\164\x69\157\156\x73\56\160\x68\x70"; goto zp0LU; Lvv09: jimport("\x6a\x6f\157\155\154\x61\x2e\141\160\x70\154\x69\x63\x61\x74\x69\x6f\x6e\x2e\143\x6f\x6d\x70\x6f\x6e\x65\156\164\56\143\157\x6e\x74\x72\157\154\x6c\145\162"); goto cCK1_; zp0LU: class JshoppingControllerAddon_vendor extends JControllerLegacy { private $vendorId; private $va_template = "\x61\144\144\157\156\x73"; private $alias = "\x61\144\144\157\156\137\x76\145\156\x64\157\x72"; function __construct($config = array()) { parent::__construct($config); JSFactory::loadExtLanguageFile("\x61\144\144\x6f\156\137\166\145\156\x64\157\x72"); JModelLegacy::addIncludePath(JPATH_ADMINISTRATOR . "\x2f\143\157\155\160\157\156\145\156\164\x73\57\143\157\x6d\x5f\x6a\163\x68\157\160\160\x69\156\147\57\155\157\x64\145\x6c\163"); $document = JFactory::getDocument(); $document->addCustomTag("\74\x73\143\162\151\x70\x74\40\x74\171\x70\x65\40\75\40\42\164\145\170\164\x2f\x6a\x61\166\141\x73\x63\x72\x69\160\x74\x22\40\x73\162\x63\x20\75\x20\42" . JURI::root() . "\x63\x6f\x6d\160\x6f\156\145\156\x74\x73\57\x63\157\x6d\x5f\x6a\163\x68\157\x70\160\151\x6e\147\x2f\x6a\x73\x2f\141\x64\144\157\x6e\x5f\x76\x65\156\x64\x6f\x72\x2e\x6a\163\42\x3e\x3c\x2f\x73\143\x72\151\x70\164\x3e"); $document->addCustomTag("\74\x6c\151\156\x6b\x20\164\x79\160\x65\40\75\40\x22\164\145\x78\x74\x2f\x63\163\163\x22\x20\x72\145\x6c\40\75\x20\x22\x73\164\x79\x6c\145\163\x68\x65\145\164\42\x20\x68\162\x65\x66\x20\x3d\40\x22" . JURI::root() . "\x63\x6f\155\x70\157\x6e\x65\156\164\x73\57\x63\157\155\x5f\x6a\x73\x68\x6f\160\160\x69\x6e\x67\x2f\143\163\x73\x2f\141\x64\x64\x6f\156\x5f\166\145\x6e\x64\x6f\x72\56\143\x73\x73\x22\40\57\x3e"); $document->addCustomTag("\74\x6c\151\156\153\x20\164\x79\x70\x65\40\x3d\40\42\x74\x65\170\164\x2f\143\163\163\x22\40\162\x65\154\x20\75\x20\x22\x73\164\x79\154\145\163\150\x65\x65\164\x22\40\x68\162\x65\x66\40\x3d\40\42" . JURI::root() . "\x61\x64\155\151\x6e\x69\x73\164\x72\141\164\x6f\x72\57\x63\x6f\x6d\x70\157\x6e\145\156\x74\163\57\143\x6f\155\137\x6a\x73\x68\x6f\160\x70\x69\156\147\x2f\x63\163\163\57\163\164\x79\154\x65\x2e\143\x73\163\42\x20\x2f\76"); $document->addCustomTag("\74\163\x63\162\x69\160\x74\40\164\171\x70\145\40\75\40\42\x74\x65\170\164\x2f\x6a\x61\166\x61\x73\143\x72\x69\160\164\x22\x20\x73\162\x63\40\75\40\x22" . JURI::root() . "\141\x64\155\x69\x6e\x69\163\x74\162\x61\x74\x6f\x72\x2f\143\157\155\x70\x6f\156\145\156\x74\x73\57\x63\157\x6d\137\152\x73\x68\x6f\x70\x70\151\x6e\x67\57\x6a\163\57\x66\165\x6e\x63\x74\151\157\156\163\x2e\x6a\163\42\76\74\x2f\x73\x63\162\x69\160\x74\76"); $user = JFactory::getUser(); $vendors = $this->getModel("\166\x65\x6e\144\157\x72\x73"); $this->vendorId = $vendors->getIdVendorForUserId($user->id); $this->registerTask("\160\x61\171\x6d\145\x6e\x74\x41\x64\144", "\x70\x61\171\x6d\x65\x6e\x74\105\x64\x69\164"); $this->registerTask("\x70\141\171\155\145\x6e\164\x55\x6e\x70\x75\142\x6c\151\163\x68", "\x70\141\x79\155\x65\156\x74\120\x75\142\154\x69\x73\150"); $this->registerTask("\x70\x61\x79\x6d\x65\156\164\x4f\162\144\x65\162\125\x70", "\x70\141\x79\155\x65\156\164\122\145\x6f\162\x64\145\x72"); $this->registerTask("\x70\141\x79\x6d\x65\156\164\117\162\144\145\162\x44\x6f\167\x6e", "\160\x61\171\155\x65\156\164\x52\x65\157\x72\x64\x65\162"); $this->registerTask("\163\150\151\x70\x70\151\156\x67\x41\144\x64", "\163\150\x69\160\160\x69\x6e\147\105\x64\x69\164"); $this->registerTask("\x73\x68\x69\x70\160\x69\156\x67\125\156\x70\x75\142\154\151\x73\x68", "\x73\x68\151\x70\160\x69\x6e\x67\120\x75\142\154\x69\163\x68"); $this->registerTask("\x73\150\x69\x70\160\151\x6e\x67\x4f\162\x64\145\162\125\160", "\163\150\151\160\160\151\x6e\x67\122\145\x6f\x72\x64\145\162"); $this->registerTask("\163\150\151\160\160\151\156\x67\117\x72\x64\145\162\104\x6f\167\156", "\x73\150\x69\160\x70\151\156\x67\122\145\x6f\162\144\145\162"); $this->registerTask("\x73\x68\x69\x70\x70\x69\156\147\163\120\162\x69\x63\145\x41\144\x64", "\163\150\151\x70\160\x69\x6e\147\163\120\162\x69\x63\x65\105\x64\151\164"); } function display($cachable = false, $urlparams = false) { $user = JFactory::getUser(); $addon_vendor = $this->getModel("\x61\144\144\x6f\x6e\137\x76\x65\156\144\157\162"); $vndConfig = $addon_vendor->getVendorsConfig(); setMetaData(_JSHOP_VENDOR_MENU, _JSHOP_VENDOR_MENU, _JSHOP_VENDOR_MENU); appendPathWay(_JSHOP_VENDOR_MENU); $text = ''; $menu = array(); if ($user->id) { $vendor = $addon_vendor->getVendorByUser(); if (!empty($vendor) && !$vendor->publish) { JError::raiseWarning('', _JSHOP_YOUR_SELLER_ACCOUNT_IS_BLOCKED); } else { if ($addon_vendor->checkUserVendor($user->id)) { $menu = $addon_vendor->getVendorMenu(true, $vndConfig); } else { if ($vndConfig->allow_become_a_seller && !$addon_vendor->checkUserVendor($user->id)) { $text = _JSHOP_BECOME_A_SELLER_LABEL; $menu = $addon_vendor->getVendorMenu(false, $vndConfig); } else { $this->setRedirect(SEFLink("\151\x6e\x64\145\170\56\x70\150\160", 1, 1)); } } } } else { $this->setRedirect(SEFLink("\x69\156\x64\x65\x78\56\160\150\160\77\x6f\160\x74\151\x6f\156\75\143\x6f\155\x5f\152\163\150\157\x70\x70\x69\x6e\147\x26\143\157\x6e\x74\x72\x6f\x6c\154\x65\x72\75\x75\x73\x65\162\x26\x74\141\x73\x6b\75\154\157\x67\151\x6e", 1, 1)); } $view_name = "\x61\144\x64\x6f\x6e\137\166\x65\x6e\x64\157\162"; $view_config = array("\164\145\155\x70\154\141\164\145\137\x70\x61\164\x68" => JPATH_COMPONENT . "\57\164\145\155\x70\154\141\x74\145\163\57" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, "\x68\x74\155\154", '', $view_config); $view->setLayout("\x76\x65\x6e\144\x6f\162\137\155\145\x6e\x75"); $view->assign("\155\145\x6e\x75", $menu); $view->assign("\x6d\145\x73\x73\x61\x67\145", $text); $view->display(); } function becomeaseller() { $user = JFactory::getUser(); $addon_vendor = JModelLegacy::getInstance("\x61\144\x64\x6f\156\137\x76\145\x6e\x64\x6f\x72", "\112\x73\150\157\x70\x70\151\156\147\115\x6f\144\x65\x6c"); if (!$user->id) { $this->setRedirect(SEFLink("\x69\156\x64\x65\170\x2e\160\x68\x70\77\157\160\164\x69\157\x6e\75\x63\157\155\137\x6a\163\150\x6f\x70\160\x69\x6e\x67\x26\143\157\x6e\x74\162\157\x6c\154\x65\x72\x3d\165\x73\x65\x72\46\164\141\163\x6b\x3d\162\x65\147\151\163\164\145\162", 1, 1)); } else { $addon_vendor = $this->getModel("\x61\144\x64\x6f\x6e\137\166\x65\x6e\144\x6f\162"); $addon_vendor->becomeaseller(); $this->setRedirect(SEFLink("\x69\156\x64\x65\x78\x2e\x70\x68\x70\x3f\x6f\x70\x74\151\x6f\156\x3d\143\x6f\155\x5f\x6a\163\150\157\160\x70\x69\156\147\46\x63\x6f\x6e\164\162\157\x6c\x6c\x65\162\75\141\144\x64\157\156\x5f\x76\x65\x6e\144\157\162", 1, 1)); } } function _getAllCategoriesLevel($parentId, $currentOrdering = 0) { $_categories = $this->getModel("\x63\141\164\x65\x67\157\162\151\x65\163"); $rows = $_categories->getSubCategories($parentId, "\x6f\x72\x64\x65\162\151\x6e\147"); $first[] = JHTML::_("\x73\145\154\145\143\164\x2e\x6f\x70\164\x69\157\x6e", "\x30", _JSHOP_VF_ORDERING_FIRST, "\157\162\x64\x65\162\151\x6e\147", "\x6e\141\x6d\x65"); if (count($rows) > 0) { $rows = array_merge($first, $rows); $currentOrdering = !$currentOrdering ? $rows[count($rows) - 1]->ordering : $currentOrdering; return JHTML::_("\x73\x65\x6c\145\x63\x74\56\x67\x65\x6e\x65\162\x69\x63\x6c\151\163\164", $rows, "\157\162\x64\145\x72\x69\156\147", "\x63\x6c\x61\163\163\75\42\x69\156\160\x75\164\142\x6f\x78\x22\40\163\151\172\x65\75\42\61\x22", "\x6f\162\144\145\x72\x69\156\147", "\156\141\x6d\x65", $currentOrdering); } } function save_category() { $addon_vendor = $this->getModel("\141\x64\x64\x6f\x6e\137\x76\x65\156\x64\x6f\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\141\144\x64\x43\141\164\x65\147\x6f\x72\171"); $jshopConfig = JSFactory::getConfig(); require_once $jshopConfig->path . "\x6c\x69\x62\x2f\151\x6d\x61\147\145\x2e\154\x69\142\56\x70\x68\x70"; require_once $jshopConfig->path . "\154\x69\142\x2f\165\x70\154\x6f\141\x64\x66\x69\154\145\56\143\154\141\x73\163\56\x70\x68\160"; $_alias = $this->getModel("\x61\x6c\151\x61\163"); $category = JTable::getInstance("\143\x61\x74\x65\x67\x6f\x72\171", "\152\x73\150\157\160"); if (!$_POST["\143\141\x74\145\147\157\162\171\137\151\x64"]) { $_POST["\x63\x61\x74\145\x67\x6f\x72\171\137\141\x64\x64\137\x64\141\x74\145"] = date("\131\55\155\55\144\40\x48\x3a\151\x3a\x73"); } if (!isset($_POST["\143\141\164\x65\x67\157\162\x79\137\x70\165\142\154\x69\x73\x68"])) { $_POST["\143\141\164\145\147\157\x72\171\x5f\x70\165\142\154\151\x73\x68"] = 0; } $post = JRequest::get("\x70\x6f\x73\164"); $post["\143\141\164\x65\147\x6f\x72\x79\137\x69\144"] = 0; $_lang = $this->getModel("\x6c\x61\156\147\x75\x61\x67\145\163"); $languages = $_lang->getAllLanguages(1); if (count($languages) > 0) { foreach ($languages as $lang) { $post["\x6e\x61\x6d\145\x5f" . $lang->language] = trim($post["\x6e\141\155\x65\x5f" . $lang->language]); if ($post["\x6e\x61\x6d\x65\137" . $lang->language] == '' || empty($post["\x70\x72\157\x64\165\x63\x74\163\x5f\160\x61\147\x65"]) || empty($post["\160\162\x6f\144\x75\143\x74\x73\137\162\x6f\x77"])) { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect(SEFLink("\x69\156\x64\x65\x78\x2e\x70\150\160\77\x6f\160\164\x69\157\x6e\75\143\x6f\155\137\x6a\x73\x68\157\x70\x70\x69\x6e\147\x26\x63\157\x6e\164\162\157\154\x6c\145\x72\x3d\x61\144\144\157\x6e\137\x76\x65\x6e\x64\x6f\x72\x26\x74\141\163\153\x3d\x61\x64\144\x5f\x63\141\x74\x65\x67\157\162\x79", 1, 1)); return 0; } if ($jshopConfig->create_alias_product_category_auto && $post["\141\154\151\141\x73\x5f" . $lang->language] == '') { $post["\141\154\151\x61\163\137" . $lang->language] = $post["\156\141\155\145\x5f" . $lang->language]; } $post["\x61\x6c\151\x61\x73\137" . $lang->language] = JApplication::stringURLSafe($post["\x61\x6c\x69\x61\x73\x5f" . $lang->language]); if ($post["\141\154\151\x61\163\x5f" . $lang->language] != '' && !$_alias->checkExistAlias1Group($post["\x61\154\x69\141\163\x5f" . $lang->language], $lang->language, $post["\x63\x61\164\x65\x67\157\162\x79\137\151\x64"], 0)) { $post["\141\154\151\141\x73\x5f" . $lang->language] = ''; JError::raiseWarning('', _JSHOP_VF_ERROR_ALIAS_ALREADY_EXIST); $this->setRedirect(SEFLink("\x69\156\144\145\x78\56\160\150\x70\x3f\x6f\x70\164\x69\x6f\156\75\143\157\155\137\152\x73\x68\x6f\x70\160\x69\156\147\x26\x63\x6f\156\164\162\x6f\x6c\x6c\x65\162\75\x61\x64\x64\157\156\x5f\x76\145\156\x64\x6f\162\x26\164\x61\163\153\x3d\141\x64\144\137\x63\x61\x74\145\x67\157\x72\171", 1, 1)); return 0; } $post["\x64\145\163\143\162\x69\160\164\x69\157\x6e\x5f" . $lang->language] = JRequest::getVar("\144\x65\163\143\162\x69\160\164\151\157\156" . $lang->id, '', "\160\x6f\163\164", "\x73\x74\x72\151\156\x67", 2); $post["\163\x68\157\x72\164\x5f\144\145\x73\143\x72\x69\x70\164\x69\x6f\x6e\137" . $lang->language] = JRequest::getVar("\163\x68\x6f\162\164\x5f\x64\145\x73\143\162\151\x70\164\x69\x6f\x6e\x5f" . $lang->language, '', "\160\157\163\164", "\x73\164\162\x69\156\147", 2); } } if (!$category->bind($post)) { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect(SEFLink("\x69\156\x64\145\x78\56\x70\x68\x70\x3f\157\160\x74\x69\157\156\x3d\143\157\x6d\x5f\152\163\x68\x6f\x70\160\x69\x6e\147\46\x63\157\x6e\164\162\x6f\154\x6c\x65\x72\x3d\141\x64\144\157\156\137\166\145\x6e\144\x6f\x72\x26\164\x61\163\153\75\x61\x64\144\x5f\143\141\x74\145\x67\157\162\x79", 1, 1)); return 0; } $upload = new UploadFile($_FILES["\143\141\x74\145\x67\157\x72\x79\x5f\151\155\141\147\145"]); $upload->setAllowFile(array("\x6a\160\x65\x67", "\152\160\x67", "\147\x69\146", "\x70\x6e\147")); $upload->setDir($jshopConfig->image_category_path); if ($upload->upload()) { $name = $upload->getName(); @chmod($jshopConfig->image_category_path . "\57" . $name, 511); if ($post["\163\151\x7a\x65\137\151\x6d\137\143\141\x74\x65\147\157\162\171"] < 3) { if ($post["\163\151\x7a\145\137\151\155\137\143\141\164\145\x67\x6f\x72\171"] == 1) { $category_width_image = $jshopConfig->image_category_width; $category_height_image = $jshopConfig->image_category_height; } else { $category_width_image = JRequest::getInt("\143\141\x74\145\x67\157\162\171\x5f\x77\x69\144\x74\150\x5f\151\155\141\147\145"); $category_height_image = JRequest::getInt("\143\x61\x74\x65\147\157\x72\x79\137\150\145\x69\147\x68\x74\x5f\x69\155\141\x67\145"); } $path_full = $jshopConfig->image_category_path . "\57" . $name; $path_thumb = $jshopConfig->image_category_path . "\57" . $name; if (!ImageLib::resizeImageMagic($path_full, $category_width_image, $category_height_image, $jshopConfig->image_cut, $jshopConfig->image_fill, $path_thumb, $jshopConfig->image_quality, $jshopConfig->image_fill_color)) { JError::raiseWarning('', _JSHOP_VF_ERROR_CREATE_THUMBAIL); saveToLog("\x65\x72\162\157\x72\x2e\154\x6f\x67", "\123\x61\166\145\103\141\164\145\x67\157\x72\x79\x20\55\x20\105\x72\x72\157\x72\40\x63\162\x65\x61\164\145\x20\x74\x68\165\x6d\x62\141\x69\x6c"); } @chmod($jshopConfig->image_category_path . "\57" . $name, 511); unset($img); } $category->category_image = $name; } else { if ($upload->getError() != 4) { JError::raiseWarning('', _JSHOP_VF_ERROR_UPLOADING_IMAGE); saveToLog("\145\x72\162\157\x72\56\x6c\x6f\147", "\x53\141\x76\145\103\141\x74\145\x67\x6f\x72\x79\x20\x2d\40\105\162\162\x6f\x72\40\165\160\154\x6f\x61\144\40\151\x6d\x61\x67\145\x2e\40\143\x6f\x64\145\72\40" . $upload->getError()); } } $this->_reorderCategory($category); if (!$category->store()) { JError::raiseWarning('', _JSHOP_VF_ERROR_SAVE_DATABASE); $this->setRedirect(SEFLink("\151\156\144\x65\170\56\160\x68\160\x3f\x6f\x70\164\x69\x6f\156\75\x63\x6f\x6d\x5f\152\x73\150\157\x70\x70\151\156\x67\x26\143\157\x6e\164\162\157\154\154\145\162\75\x61\144\x64\157\156\137\x76\145\156\144\157\x72\46\x74\x61\x73\x6b\x3d\141\144\144\137\143\x61\164\145\x67\x6f\x72\171", 1, 1)); return 0; } $this->setRedirect(SEFLink("\x69\156\x64\145\x78\x2e\x70\x68\160\77\157\160\164\151\x6f\156\x3d\143\157\155\x5f\x6a\x73\x68\157\x70\x70\151\x6e\147\x26\143\157\156\164\162\x6f\x6c\154\145\x72\75\141\144\144\157\x6e\x5f\166\x65\x6e\144\x6f\x72", 1, 1), _JSHOP_VF_CATEGORY_SUCC_ADDED); } function _reorderCategory(&$category) { $addon_vendor = $this->getModel("\x61\144\x64\157\156\x5f\x76\145\156\144\x6f\162"); $addon_vendor->checkUserSeller(); $db = JFactory::getDBO(); $query = "\x55\x50\104\x41\x54\105\40\x60\x23\x5f\x5f\x6a\x73\x68\157\x70\x70\x69\x6e\147\x5f\143\x61\x74\x65\x67\x6f\x72\x69\x65\163\x60\x20\x53\x45\124\40\x60\157\162\x64\x65\162\x69\156\147\140\x20\75\40\157\x72\144\145\x72\x69\x6e\147\40\x2b\x20\x31\xa\x20\x20\x20\x20\40\40\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\x20\40\x20\x20\x57\110\105\122\x45\40\x60\143\141\x74\145\147\x6f\162\171\x5f\x70\x61\162\145\156\164\x5f\x69\x64\140\40\x3d\40\47" . $db->escape($category->category_parent_id) . "\x27\x20\x41\116\104\40\x60\157\162\x64\x65\x72\x69\156\x67\x60\40\x3e\x20\x27" . $db->escape($category->ordering) . "\47"; $db->setQuery($query); $db->query(); $category->ordering++; } public function attributes() { $addon_vendor = $this->getModel("\x61\144\144\x6f\x6e\x5f\x76\x65\156\144\157\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x61\x64\144\101\x74\164\x72"); $attributes = JModelLegacy::getInstance("\141\x74\x74\x72\x69\x62\165\164", "\x4a\x73\x68\x6f\x70\160\x69\156\x67\115\x6f\144\x65\x6c"); $attributesvalue = JModelLegacy::getInstance("\x61\164\x74\x72\x69\142\x75\164\x56\x61\154\165\145", "\112\163\x68\x6f\x70\x70\x69\156\x67\115\x6f\x64\x65\154"); $rows = $attributes->getAllAttributes(0); foreach ($rows as $key => $value) { $rows[$key]->values = splitValuesArrayObject($attributesvalue->getAllValues($rows[$key]->attr_id), "\156\x61\x6d\x65"); $rows[$key]->count_values = count($attributesvalue->getAllValues($rows[$key]->attr_id)); } $view_name = "\x61\144\x64\157\156\137\x76\x65\x6e\144\157\162"; $view_config = array("\164\145\x6d\x70\154\x61\x74\145\137\x70\x61\x74\x68" => JPATH_COMPONENT . "\57\x74\145\155\x70\154\x61\164\145\x73\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\x68\x74\155\x6c", '', $view_config); $view->setLayout("\x61\x74\164\x72\x69\142\165\x74\x65\x73"); $view->assign("\x72\157\167\163", $rows); $view->display(); } public function add_attribut() { $addon_vendor = $this->getModel("\x61\x64\144\x6f\x6e\x5f\x76\145\x6e\x64\x6f\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\141\x64\x64\101\x74\164\x72"); $_lang = JModelLegacy::getInstance("\154\x61\156\x67\165\x61\147\x65\163", "\x4a\x73\x68\x6f\x70\160\151\156\x67\115\x6f\144\x65\x6c"); $languages = $_lang->getAllLanguages(1); $multilang = count($languages) > 1; $types[] = JHTML::_("\163\x65\154\x65\143\164\x2e\157\x70\x74\151\x6f\x6e", "\x31", "\123\x65\154\x65\143\164", "\x61\x74\x74\x72\137\x74\x79\160\x65\x5f\x69\144", "\x61\164\x74\162\137\164\x79\x70\x65"); $types[] = JHTML::_("\x73\x65\154\x65\143\164\x2e\x6f\160\164\151\x6f\156", "\62", "\122\x61\x64\x69\157", "\141\164\x74\x72\x5f\x74\x79\x70\x65\x5f\x69\144", "\x61\x74\164\162\x5f\x74\x79\x70\145"); $type_attribut = JHTML::_("\x73\x65\x6c\x65\x63\x74\56\147\x65\156\x65\162\x69\x63\x6c\x69\x73\164", $types, "\x61\x74\x74\x72\x5f\164\171\160\145", "\x63\x6c\141\163\163\x20\x3d\40\x22\151\156\160\165\x74\x62\x6f\170\x22\40\163\x69\x7a\x65\40\x3d\x20\42\61\42", "\x61\164\x74\162\137\164\171\160\x65\137\151\144", "\x61\x74\164\x72\137\x74\x79\160\x65", 1); $all = array(); $all[] = JHTML::_("\163\x65\154\x65\x63\x74\56\157\160\x74\x69\157\156", 1, _JSHOP_ALL, "\x69\144", "\166\141\154\x75\x65"); $all[] = JHTML::_("\x73\145\154\x65\x63\164\56\157\160\x74\151\x6f\x6e", 0, _JSHOP_VF_SELECTED, "\151\144", "\166\x61\154\x75\145"); $lists["\141\x6c\154\143\141\164\x73"] = JHTML::_("\163\145\x6c\145\x63\164\x2e\x72\141\144\x69\157\154\151\163\164", $all, "\141\x6c\x6c\143\141\x74\x73", "\x6f\x6e\x63\x6c\x69\x63\153\75\42\120\106\x53\150\157\167\110\151\144\x65\x53\145\x6c\145\x63\x74\x43\x61\164\163\50\x29\x22", "\x69\x64", "\166\141\154\x75\145", 1); $categories = buildTreeCategory(0, 1, 0); $lists["\x63\141\164\145\147\x6f\162\151\145\163"] = JHTML::_("\x73\145\x6c\145\143\x74\x2e\x67\x65\x6e\145\x72\x69\143\x6c\x69\163\x74", $categories, "\x63\141\164\x65\147\157\162\171\x5f\151\x64\133\135", "\143\x6c\x61\x73\163\x3d\x22\x69\x6e\x70\x75\164\x62\x6f\x78\42\x20\x73\151\x7a\x65\75\42\61\x22", "\143\x61\164\145\x67\x6f\162\x79\x5f\151\x64", "\156\x61\155\145", array()); $view_name = "\x61\x64\x64\x6f\x6e\x5f\166\145\156\x64\x6f\x72"; $view_config = array("\x74\x65\155\160\x6c\141\164\145\137\x70\x61\x74\150" => JPATH_COMPONENT . "\x2f\x74\x65\155\x70\x6c\141\x74\145\163\57" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, "\x68\164\155\154", '', $view_config); $view->setLayout("\141\x74\164\x72\x69\x62\165\x74\145\163\137\145\x64\x69\x74"); $view->assign("\164\171\x70\x65\x5f\141\x74\164\162\151\x62\165\164", $type_attribut); $view->assign("\154\141\156\147\x75\x61\x67\x65\163", $languages); $view->assign("\x6d\x75\154\164\151\x6c\141\x6e\x67", $multilang); $view->assign("\x6c\151\x73\x74\x73", $lists); $view->display(); } public function save_attributes() { $addon_vendor = $this->getModel("\141\144\144\157\156\x5f\x76\x65\x6e\144\x6f\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x61\144\144\x41\x74\x74\162"); $db = JFactory::getDBO(); $attribut = JTable::getInstance("\141\164\164\x72\x69\x62\x75\164", "\x6a\163\x68\157\x70"); $post = JRequest::get("\x70\157\163\164"); $post["\151\156\x64\145\160\x65\156\144\x65\x6e\x74"] = 1; $post["\141\164\164\162\137\x69\x64"] = 0; $query = "\x53\105\x4c\105\103\124\x20\115\101\130\x28\x61\x74\164\x72\137\157\162\144\145\162\151\x6e\x67\51\40\x41\x53\40\141\x74\164\x72\137\x6f\162\144\145\x72\151\x6e\x67\40\x46\122\x4f\115\40\x60\43\137\x5f\152\x73\150\x6f\160\160\x69\x6e\x67\137\141\x74\x74\x72\x60"; $db->setQuery($query); $row = $db->loadObject(); $post["\141\x74\x74\162\137\x6f\x72\x64\x65\x72\x69\156\147"] = $row->attr_ordering + 1; $_lang = $this->getModel("\x6c\x61\156\x67\x75\141\x67\x65\x73"); $languages = $_lang->getAllLanguages(1); if (count($languages) > 0) { foreach ($languages as $lang) { $post["\x6e\x61\x6d\x65\137" . $lang->language] = trim($post["\x6e\141\155\x65\x5f" . $lang->language]); if ($post["\x6e\x61\155\145\x5f" . $lang->language] == '') { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect(SEFLink("\151\156\144\x65\170\56\160\x68\x70\x3f\x6f\x70\164\x69\157\156\x3d\143\x6f\155\137\x6a\163\150\x6f\160\x70\151\x6e\x67\46\x63\157\156\164\162\x6f\154\x6c\145\x72\75\141\x64\x64\157\x6e\x5f\x76\x65\156\x64\x6f\x72\46\x74\x61\x73\x6b\x3d\141\x64\x64\x5f\x61\x74\x74\162\x69\x62\x75\164", 1, 1)); return 0; } } } if (!$attribut->bind($post) || $post["\141\x74\x74\x72\x5f\164\171\160\x65"] != 1 && $post["\141\x74\164\162\137\164\x79\160\x65"] != 2 || $post["\x61\x6c\154\143\x61\164\x73"] != 0 && $post["\x61\154\x6c\x63\141\164\x73"] != 1) { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect(SEFLink("\151\156\x64\145\x78\x2e\x70\150\x70\x3f\x6f\160\164\151\x6f\156\75\143\157\155\137\152\163\x68\x6f\x70\x70\151\156\147\46\x63\157\156\164\162\157\x6c\x6c\x65\x72\75\x61\x64\x64\157\156\137\x76\145\x6e\x64\x6f\162")); return 0; } if (isset($post["\x63\x61\164\145\147\x6f\x72\171\137\151\144"])) { $categorys = $post["\143\141\x74\x65\147\157\x72\171\x5f\x69\144"]; } else { $categorys = ''; } if (!is_array($categorys)) { $categorys = array(); } $attribut->setCategorys($categorys); if (!$attribut->store()) { JError::raiseWarning('', _JSHOP_ERROR_SAVE_DATABASE); $this->setRedirect(SEFLink("\151\x6e\x64\145\x78\56\x70\150\x70\x3f\x6f\x70\x74\x69\157\156\75\x63\157\155\x5f\152\x73\x68\x6f\x70\x70\x69\156\147\46\x63\x6f\156\x74\x72\x6f\x6c\154\145\x72\x3d\x61\144\144\157\156\137\166\145\x6e\144\157\x72")); return 0; } $query = "\x41\x4c\x54\x45\122\40\x54\101\x42\114\x45\40\140\x23\137\x5f\152\x73\150\157\x70\160\151\x6e\x67\x5f\x70\x72\157\x64\x75\x63\x74\x73\x5f\x61\164\164\162\140\40\x41\104\104\x20\140\x61\x74\164\162\x5f" . $attribut->attr_id . "\x60\x20\x49\116\x54\50\x31\61\x29\40\x4e\117\x54\x20\x4e\125\x4c\114"; $db->setQuery($query); $db->query(); $this->setRedirect(SEFLink("\151\x6e\x64\145\170\x2e\160\150\160\77\157\x70\x74\151\157\x6e\x3d\143\x6f\155\137\x6a\163\x68\x6f\160\x70\x69\x6e\x67\x26\143\157\x6e\x74\162\157\154\154\x65\x72\75\141\x64\144\157\156\x5f\166\x65\156\x64\157\162\46\164\141\163\x6b\x3d\141\x74\x74\x72\x69\142\165\164\145\x73", 1, 1), _JSHOP_VF_ATTRIBUTE_SAVED); } public function attributesvalues() { $addon_vendor = $this->getModel("\x61\x64\x64\x6f\x6e\x5f\166\145\156\x64\157\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x61\x64\144\x41\164\x74\x72"); $attr_id = JRequest::getInt("\x61\x74\x74\162\x5f\151\x64"); $jshopConfig = JSFactory::getConfig(); $attributValues = JModelLegacy::getInstance("\101\164\x74\162\151\x62\165\164\x56\141\154\x75\145", "\112\163\x68\x6f\160\160\151\156\x67\115\x6f\144\x65\154"); $rows = $attributValues->getAllValues($attr_id); $attribut = JModelLegacy::getInstance("\x61\164\x74\x72\151\x62\165\x74", "\x4a\x73\x68\x6f\x70\160\x69\x6e\147\x4d\157\x64\145\154"); $attr_name = $attribut->getName($attr_id); $view_name = "\141\144\x64\x6f\156\137\166\145\156\x64\157\x72"; $view_config = array("\x74\145\155\160\154\141\164\x65\x5f\160\141\x74\150" => JPATH_COMPONENT . "\x2f\164\145\155\x70\x6c\141\x74\x65\163\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\x68\x74\155\x6c", '', $view_config); $view->setLayout("\x61\164\164\x72\x69\x62\165\164\145\x73\166\141\154\165\145\x73"); $view->assign("\x72\x6f\x77\x73", $rows); $view->assign("\141\x74\x74\x72\137\x69\144", $attr_id); $view->assign("\x63\157\x6e\x66\151\147", $jshopConfig); $view->assign("\141\x74\x74\162\137\x6e\141\x6d\x65", $attr_name); $view->display(); } public function addattrvalue() { $addon_vendor = $this->getModel("\141\144\144\157\156\x5f\166\145\x6e\x64\157\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\141\x64\144\x41\x74\x74\x72"); $attr_id = JRequest::getInt("\141\x74\x74\162\137\151\x64"); $jshopConfig = JSFactory::getConfig(); $_lang = $this->getModel("\x6c\141\156\147\165\x61\x67\x65\x73"); $languages = $_lang->getAllLanguages(1); $multilang = count($languages) > 1; $view_name = "\141\144\x64\157\x6e\137\166\145\x6e\x64\157\162"; $view_config = array("\164\x65\155\160\x6c\141\164\x65\x5f\x70\141\164\x68" => JPATH_COMPONENT . "\x2f\x74\145\x6d\x70\154\141\164\x65\163\57" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\150\x74\155\154", '', $view_config); $view->setLayout("\x61\144\144\x61\164\x74\x72\166\x61\154\165\x65"); $view->assign("\x61\x74\164\x72\137\151\144", $attr_id); $view->assign("\143\157\x6e\146\151\x67", $jshopConfig); $view->assign("\154\141\x6e\147\x75\x61\x67\145\163", $languages); $view->assign("\155\165\154\164\151\x6c\x61\156\x67", $multilang); $view->display(); } public function saveattrvalue() { $addon_vendor = $this->getModel("\141\144\x64\157\156\137\166\x65\x6e\x64\157\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\141\x64\144\101\x74\x74\x72"); $jshopConfig = JSFactory::getConfig(); require_once $jshopConfig->path . "\x6c\x69\142\57\165\x70\x6c\157\141\144\146\x69\154\145\x2e\143\154\141\x73\163\56\x70\x68\x70"; $db = JFactory::getDBO(); $attr_id = JRequest::getInt("\x61\x74\164\162\137\151\144"); $post = JRequest::get("\x70\157\163\164"); $post["\166\x61\x6c\165\145\137\x69\144"] = 0; $attributValue = JTable::getInstance("\141\x74\164\162\x69\142\165\164\x56\x61\154\165\x65", "\152\163\150\x6f\160"); $_lang = $this->getModel("\154\x61\x6e\x67\x75\x61\147\145\163"); $languages = $_lang->getAllLanguages(1); if (count($languages) > 0) { foreach ($languages as $lang) { $post["\156\x61\155\x65\137" . $lang->language] = trim($post["\x6e\x61\155\x65\137" . $lang->language]); if ($post["\156\141\155\x65\x5f" . $lang->language] == '') { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect(SEFLink("\x69\156\x64\x65\170\x2e\x70\x68\160\77\x6f\160\x74\151\x6f\x6e\75\x63\x6f\155\137\152\x73\150\x6f\x70\x70\x69\x6e\x67\x26\x63\157\x6e\164\162\157\x6c\x6c\145\162\x3d\x61\x64\144\157\x6e\x5f\x76\145\156\x64\x6f\x72\x26\164\x61\163\x6b\x3d\141\164\x74\162\151\x62\x75\x74\x65\163\x76\141\154\165\x65\163\46\x61\x74\164\x72\137\x69\144\75" . $attr_id, 1, 1)); return 0; } } } $upload = new UploadFile($_FILES["\151\x6d\141\147\145"]); $upload->setAllowFile(array("\x6a\160\145\x67", "\x6a\x70\x67", "\x67\151\146", "\160\156\147")); $upload->setDir($jshopConfig->image_attributes_path); $upload->setFileNameMd5(0); $upload->setFilterName(1); if ($upload->upload()) { $post["\x69\155\x61\x67\x65"] = $upload->getName(); @chmod($jshopConfig->image_attributes_path . "\57" . $post["\x69\155\141\147\x65"], 511); } else { if ($upload->getError() != 4) { JError::raiseWarning('', _JSHOP_VF_ERROR_UPLOADING_IMAGE); saveToLog("\x65\162\x72\157\162\x2e\154\x6f\147", "\x53\141\x76\145\x41\164\x74\162\x69\x62\x75\x74\x65\126\x61\154\x75\145\40\55\40\105\x72\x72\157\x72\x20\165\160\x6c\157\x61\x64\40\x69\155\x61\x67\145\56\40\143\x6f\x64\x65\72\40" . $upload->getError()); } } $query = "\x53\x45\114\105\x43\x54\x20\x4d\x41\130\50\166\x61\154\165\x65\x5f\x6f\x72\x64\145\162\151\156\x67\51\40\101\x53\40\166\141\154\165\145\x5f\x6f\x72\144\145\x72\151\156\x67\40\x46\x52\x4f\115\x20\x60\43\x5f\x5f\152\163\150\157\x70\160\x69\x6e\x67\137\141\x74\x74\162\137\x76\x61\x6c\165\x65\163\x60\40\x77\150\145\x72\x65\x20\x61\164\x74\x72\x5f\x69\x64\75\x27" . $db->escape($attr_id) . "\47"; $db->setQuery($query); $row = $db->loadObject(); $post["\x76\141\154\x75\145\x5f\157\x72\x64\x65\162\151\x6e\x67"] = $row->value_ordering + 1; if (!$attributValue->bind($post) || !$attr_id) { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect("\151\156\x64\x65\170\x2e\x70\150\x70\77\x6f\x70\164\x69\157\x6e\75\143\x6f\155\x5f\152\163\x68\x6f\x70\160\x69\x6e\147\46\143\157\x6e\164\162\x6f\x6c\154\145\x72\75\x61\x64\144\157\156\137\x76\145\x6e\x64\157\162\x26\x74\x61\x73\153\75\141\164\x74\x72\151\142\165\x74\x65\x73\x76\x61\154\165\145\x73\46\x61\164\164\162\137\x69\x64\x3d" . $attr_id); return 0; } if (!$attributValue->store()) { JError::raiseWarning('', _JSHOP_VF_ERROR_SAVE_DATABASE); $this->setRedirect("\151\x6e\x64\x65\170\x2e\x70\150\160\77\x6f\160\164\x69\157\x6e\x3d\x63\x6f\x6d\x5f\x6a\163\x68\x6f\x70\x70\151\x6e\x67\x26\143\157\156\x74\162\x6f\x6c\154\145\x72\x3d\x61\144\144\157\x6e\x5f\166\145\156\144\157\x72\46\164\141\x73\x6b\75\x61\164\x74\162\151\142\x75\164\x65\163\166\x61\x6c\x75\145\x73\46\141\x74\164\x72\x5f\151\x64\x3d" . $attr_id); return 0; } $this->setRedirect(SEFLink("\x69\156\x64\145\170\x2e\x70\150\160\77\x6f\x70\164\x69\x6f\x6e\x3d\x63\x6f\155\x5f\x6a\163\x68\157\160\x70\x69\156\x67\x26\x63\x6f\156\164\162\x6f\154\154\145\x72\x3d\141\x64\x64\x6f\156\137\166\145\x6e\x64\157\162\46\x74\x61\x73\153\75\x61\164\164\162\x69\x62\165\164\x65\163\x76\x61\x6c\165\145\163\x26\x61\x74\x74\162\137\x69\x64\75" . $attr_id, 1, 1), _JSHOP_VF_ATTRIBUTE_VALUE_SAVED); } public function add_category() { $addon_vendor = $this->getModel("\141\x64\x64\x6f\156\137\x76\x65\156\144\x6f\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x61\144\x64\x43\141\x74\145\x67\x6f\162\x79"); setMetaData(_JSHOP_ADD_CATEGORY, _JSHOP_ADD_CATEGORY, _JSHOP_ADD_CATEGORY); appendPathWay(_JSHOP_ADD_CATEGORY); $_lang = $this->getModel("\x6c\x61\156\147\x75\x61\x67\145\163"); $languages = $_lang->getAllLanguages(1); $multilang = count($languages) > 1; $parentid = JRequest::getInt("\143\141\x74\151\x64"); $rows = $this->_getAllCategoriesLevel($parentid); $lists["\x74\145\155\160\154\x61\164\x65\163"] = getTemplates("\143\141\x74\145\147\157\x72\x79", ''); $lists["\x6f\x6e\145\154\145\x76\145\154"] = $rows; $parentTop = new stdClass(); $parentTop->category_id = 0; $parentTop->name = _JSHOP_VF_TOP_LEVEL; $categories = buildTreeCategory(0, 1, 0); array_unshift($categories, $parentTop); $lists["\164\162\x65\x65\143\141\164\x65\147\157\x72\151\x65\x73"] = JHTML::_("\x73\145\x6c\145\x63\164\x2e\147\145\x6e\145\162\151\143\x6c\151\x73\164", $categories, "\143\141\164\145\147\x6f\162\171\x5f\x70\x61\162\x65\156\x74\137\151\x64", "\143\x6c\141\x73\163\x3d\42\151\156\x70\x75\164\x62\157\170\x22\x20\x69\x64\40\x3d\x20\x22\x6f\162\x64\145\x72\151\x6e\x67\42\x20\163\151\172\145\x3d\x22\61\42\40\x6f\156\x63\150\141\156\x67\x65\40\75\40\42\x63\x68\141\156\x67\145\126\x65\x6e\144\157\162\x43\141\164\x65\147\x6f\162\x79\x28\51\42", "\143\141\164\145\147\x6f\162\x79\x5f\x69\x64", "\156\x61\x6d\145", $parentid); $lists["\160\x61\x72\145\x6e\x74\x69\x64"] = $parentid; $accessgroups = getAccessGroups(); $lists["\141\143\x63\x65\x73\163"] = JHTML::_("\x73\x65\154\145\143\x74\56\x67\145\156\x65\162\151\x63\154\151\163\x74", $accessgroups, "\x61\143\x63\x65\x73\163", "\143\x6c\141\x73\x73\40\75\x20\42\x69\x6e\160\x75\x74\x62\157\170\x22\40\163\151\172\145\x20\x3d\40\42\x31\42", "\x69\144", "\x74\x69\x74\x6c\x65", ''); $view_name = "\x61\x64\x64\x6f\x6e\x5f\166\145\156\144\157\x72"; $view_config = array("\164\145\x6d\x70\154\x61\164\x65\x5f\x70\141\x74\x68" => JPATH_COMPONENT . "\x2f\164\x65\155\x70\x6c\x61\164\x65\x73\57" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, "\150\x74\x6d\154", '', $view_config); $view->setLayout("\156\145\167\x5f\143\x61\x74\145\147\x6f\x72\171"); $view->assign("\154\x69\x73\x74\163", $lists); $view->assign("\154\141\x6e\x67\x75\141\147\x65\163", $languages); $view->assign("\155\x75\154\164\151\154\141\x6e\147", $multilang); $view->display(); } function cashing_delete() { $addon_vendor = $this->getModel("\141\144\144\x6f\x6e\x5f\x76\145\156\144\x6f\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x63\x61\163\150\x69\x6e\x67"); $db = JFactory::getDBO(); $text = array(); $cid = JRequest::getVar("\143\151\x64"); if ($this->vendorId && count($cid) > 0) { foreach ($cid as $key => $value) { $query = "\x73\x65\x6c\145\x63\164\40\52\40\x66\162\x6f\x6d\40\x23\x5f\x5f\x6a\x73\150\157\160\160\151\x6e\147\137\x76\x65\x6e\x64\x6f\x72\x73\x5f\x63\x61\163\150\151\x6e\147\40\x77\x68\x65\162\x65\40\x69\144\x3d\x27" . $db->escape($value) . "\x27\x20\x41\116\x44\40\166\145\156\x64\x6f\162\137\151\144\40\75\40" . $this->vendorId . "\40\x41\x4e\104\x20\x73\x74\x61\164\x75\163\40\74\x3e\x20\47\x31\47"; $db->setQuery($query); $list = $db->loadObjectList(); if (count($list) > 0) { $sum = $list[0]->sum + $list[0]->commission; $query = "\x44\105\x4c\x45\124\x45\40\x46\122\117\x4d\x20\140\x23\x5f\137\152\163\150\x6f\x70\160\x69\x6e\x67\137\x76\x65\x6e\144\157\162\x73\137\143\x61\163\x68\x69\x6e\147\140\x20\127\x48\x45\122\105\40\140\x69\144\140\x20\75\40\x27" . $db->escape($value) . "\x27\x20\101\x4e\x44\x20\166\x65\x6e\x64\157\162\x5f\151\x64\x20\75\x20" . $this->vendorId; $db->setQuery($query); $db->query(); $query = "\123\105\x4c\x45\103\124\x20\52\x20\146\x72\x6f\155\40\x23\137\137\x6a\163\150\157\x70\x70\x69\156\x67\x5f\166\x65\x6e\x64\157\x72\163\x5f\143\141\x73\x68\x69\156\147\40\x57\110\105\x52\105\x20\151\144\75\x27" . $db->escape($value) . "\x27\40\x20\x41\116\x44\40\x76\145\x6e\x64\x6f\162\137\151\x64\x20\x3d\x20" . $this->vendorId; $db->setQuery($query); $list = $db->loadObjectList(); if (count($list) <= 0) { $query = "\x55\120\104\101\124\x45\40\x60\x23\137\x5f\152\x73\150\157\x70\160\151\x6e\147\x5f\x76\145\x6e\x64\157\162\163\140\xa\x20\40\40\40\40\x20\x20\40\40\x20\x20\x20\40\x20\x20\40\x20\x20\x20\x20\x20\40\x20\40\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\x20\x20\40\40\40\x20\x20\40\x53\x45\x54\x20\x60\142\x61\154\x61\156\143\145\140\40\x3d\x20\x52\x4f\x55\x4e\104\50\x60\142\x61\x6c\141\156\143\x65\140\54\x20\x32\x29\40\53\x20" . round($sum, 2) . "\40\127\110\105\122\105\x20\140\x69\x64\x60\x20\x3d\x20" . $db->escape($this->vendorId); $db->setQuery($query); $db->query(); } } } $text[] = sprintf(_JSHOP_VENDOR_CASHING_DELETED, $value) . "\74\x62\162\x20\57\x3e"; } $this->setRedirect(SEFLink("\151\x6e\144\x65\170\56\x70\x68\x70\77\157\x70\164\151\x6f\x6e\75\143\157\x6d\137\152\163\150\157\x70\x70\151\156\147\x26\x63\x6f\x6e\x74\x72\157\154\154\x65\162\75\x61\x64\x64\x6f\x6e\137\166\145\x6e\x64\x6f\162\46\164\141\163\x6b\75\143\x61\x73\x68\151\156\x67", 1, 1), implode("\74\x2f\154\151\76\74\x6c\x69\x3e", $text)); } function calc_comm() { $addon_vendor = $this->getModel("\x61\144\x64\157\156\x5f\x76\x65\156\144\157\x72"); $addon_vendor->checkUserSeller(); $vndConfig = $addon_vendor->getVendorsConfig(); $vendor = $addon_vendor->getVendorByUser(); $cashingSum = JRequest::getVar("\x63\x61\x73\150\151\156\x67\x53\x75\x6d"); $payment_id = JRequest::getVar("\x70\141\x79\x6d\x65\x6e\164\x5f\x69\144"); $payment = $addon_vendor->getPayment($payment_id); if ($payment->commission_type == 1) { $commission = round($cashingSum * ($payment->commission / 100), 2); } else { $commission = $payment->commission; } $jshop_commission = round($cashingSum, 2) > $vndConfig->max_money_cashing && $vndConfig->max_money_cashing > 0 ? _JSHOP_COMMISSION . "\x3a\x20\74\163\160\x61\x6e\40\143\x6c\141\x73\x73\x20\75\40\x27\x6d\x69\x6e\x5f\x6d\x61\x78\x5f\143\141\x73\x68\151\x6e\147\137\163\x75\155\47\x20\x73\x74\171\x6c\145\40\75\40\x27\143\157\x6c\x6f\162\x3a\x20\162\145\x64\x27\76" . $commission . "\x20" . getMainCurrencyCode() . "\74\57\163\x70\141\156\x3e" : _JSHOP_COMMISSION . "\72\x20\x3c\163\160\141\156\x20\x63\154\141\163\163\40\75\x20\x27\155\151\156\x5f\x6d\141\170\x5f\x63\141\163\x68\151\156\147\137\x73\x75\155\47\x3e" . $commission . "\x20" . getMainCurrencyCode() . "\74\x2f\163\160\141\x6e\x3e"; $jshop_vendor_balance = round($vendor->balance - $cashingSum, 2) < 0 ? _JSHOP_VENDOR_BALANCE . "\72\40\74\x73\x70\141\156\40\x63\x6c\x61\163\163\x20\x3d\x20\x27\x6d\151\156\137\x6d\x61\x78\x5f\x63\141\x73\x68\x69\156\x67\137\x73\x75\155\x27\x20\x73\164\x79\x6c\145\x20\75\x20\47\x63\x6f\154\x6f\162\72\x20\162\145\x64\x27\76" . round($vendor->balance - $cashingSum, 2) . "\40" . getMainCurrencyCode() . "\74\x2f\163\160\141\x6e\76" : _JSHOP_VENDOR_BALANCE . "\x3a\40\74\163\x70\x61\x6e\40\143\x6c\x61\x73\163\x20\75\x20\x27\155\151\x6e\137\155\x61\170\137\143\x61\163\x68\x69\156\x67\x5f\163\x75\x6d\47\x3e" . round($vendor->balance - $cashingSum, 2) . "\40" . getMainCurrencyCode() . "\74\57\x73\x70\141\156\x3e"; $jshop_cashing = round($cashingSum, 2) > $vndConfig->max_money_cashing && $vndConfig->max_money_cashing > 0 || round($cashingSum - $commission, 2) <= 0 || round($cashingSum - $commission, 2) < $vndConfig->min_money_cashing ? _JSHOP_CASHING . "\x3a\40\74\163\160\141\x6e\40\x63\154\x61\163\163\40\75\x20\47\x6d\x69\156\137\x6d\141\170\x5f\x63\141\x73\150\x69\156\x67\x5f\163\x75\155\x27\40\163\x74\171\154\x65\40\75\40\x27\x63\x6f\154\x6f\162\72\40\162\145\x64\47\x3e" . round($cashingSum - $commission, 2) . "\x20" . getMainCurrencyCode() . "\74\x2f\x73\160\x61\x6e\76" : _JSHOP_CASHING . "\x3a\x20\74\x73\x70\141\x6e\x20\x63\154\141\163\163\x20\75\x20\x27\x6d\151\156\137\155\141\x78\x5f\143\x61\163\150\x69\x6e\147\x5f\x73\165\155\x27\x3e" . round($cashingSum - $commission, 2) . "\40" . getMainCurrencyCode() . "\74\x2f\163\x70\x61\156\x3e"; $result = array("\x63\157\x6d\155\x69\x73\x73\x69\x6f\156" => $jshop_commission, "\x62\141\x6c\141\x6e\143\x65" => $jshop_vendor_balance, "\166\x69\145\x77\103\x61\x73\150\x69\x6e\147\123\165\155" => $jshop_cashing, "\166\156\144\x42\141\x6c\141\156\x63\145" => round($vendor->balance - $cashingSum, 2), "\166\x6e\x64\x43\x6f\155\155\x69\163\163\151\x6f\x6e" => (double) $commission, "\155\x69\156\x5f\x63\x61\x73\150\x69\x6e\x67\x5f\163\165\x6d" => (double) $vndConfig->min_money_cashing, "\x6d\141\x78\137\x63\x61\163\150\151\156\147\137\x73\165\155" => (double) $vndConfig->max_money_cashing, "\x63\x61\163\x68\x69\x6e\147\123\165\x6d" => $cashingSum - $commission); print json_encode($result); die; } public function new_cashing() { $addon_vendor = $this->getModel("\141\x64\144\157\156\x5f\166\x65\x6e\144\x6f\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\143\141\x73\x68\x69\x6e\x67"); setMetaData(_JSHOP_CASHING, _JSHOP_CASHING, _JSHOP_CASHING); appendPathWay(_JSHOP_CASHING); $document = JFactory::getDocument(); $document->addCustomTag("\x3c\x73\x63\x72\151\x70\164\40\x74\171\x70\x65\x20\x3d\x20\42\x74\x65\170\x74\x2f\x6a\141\166\x61\x73\143\x72\151\160\x74\42\76\xa\x20\40\40\x20\40\x20\40\40\x20\40\40\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\40\x20\40\40\40\x20\40\x20\40\40\x20\40\40\40\x20\166\x61\162\40\165\x72\154\137\x63\x61\154\143\x5f\143\157\x6d\x6d\40\75\x20\42" . SEFLink("\x69\x6e\144\x65\x78\x2e\x70\x68\160\77\x6f\x70\164\151\x6f\156\x3d\143\157\155\x5f\152\x73\150\157\160\x70\x69\156\x67\x26\143\x6f\156\164\x72\x6f\x6c\x6c\145\162\75\141\x64\144\157\156\x5f\x76\x65\x6e\x64\157\162\x26\164\141\x73\x6b\75\x63\141\x6c\143\x5f\x63\x6f\155\155", 1, 1) . "\42\73\xa\x20\40\x20\40\x20\40\x20\x20\x20\40\x20\40\40\x20\40\x20\40\40\x20\40\x20\40\40\x20\x20\x20\x20\40\x20\x20\40\40\74\57\x73\143\x72\151\x70\164\x3e"); $vndConfig = $addon_vendor->getVendorsConfig(); $jshopConfig = JSFactory::getConfig(); $vnd = $addon_vendor->getVendorByUser(); if ($vnd->balance <= 0) { $this->setRedirect(SEFLink("\151\156\144\145\170\x2e\160\x68\x70\77\157\160\164\151\157\156\75\x63\x6f\155\137\152\163\150\157\x70\160\x69\x6e\x67\46\143\157\156\164\162\x6f\x6c\154\145\x72\x3d\141\x64\x64\157\156\137\x76\x65\x6e\x64\x6f\162\46\164\141\x73\x6b\75\x63\141\x73\x68\x69\x6e\x67", 1, 1)); } $payments = $addon_vendor->getVendorsPayments(); $payments_fields = $addon_vendor->getVendorsPaymentsFields(); $view_name = "\x61\144\x64\157\156\137\166\x65\156\144\157\162"; $view_config = array("\164\145\x6d\x70\x6c\141\x74\x65\x5f\x70\x61\164\x68" => JPATH_COMPONENT . "\x2f\164\x65\x6d\x70\x6c\141\164\x65\163\57" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\150\164\155\154", '', $view_config); $view->setLayout("\156\x65\x77\x5f\x63\x61\163\150\151\x6e\x67"); $view->assign("\166\x6e\144", $vnd); $view->assign("\x63\157\156\146\151\147", $jshopConfig); $view->assign("\x70\x61\171\155\145\x6e\164\163", $payments); $view->assign("\160\x61\x79\155\x65\156\x74\x73\106\151\x65\x6c\x64\163", $payments_fields); $view->assign("\x76\x6e\144\x43\157\x6e\146\151\147", $vndConfig); $view->display(); } function cashing() { $addon_vendor = $this->getModel("\x61\144\144\157\156\137\x76\x65\156\x64\157\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x63\x61\x73\150\151\156\147"); $mainframe = JFactory::getApplication(); setMetaData(_JSHOP_CASHING, _JSHOP_CASHING, _JSHOP_CASHING); appendPathWay(_JSHOP_CASHING); $jshopConfig = JSFactory::getConfig(); $vnd = $addon_vendor->getVendorByUser(); $context = "\x6a\x73\150\x6f\x70\x69\156\147\x2e\166\x65\x6e\x64\157\x72\x73\137\143\141\x73\x68\x69\x6e\x67\137\x6c\x69\x73\x74"; $limit = $mainframe->getUserStateFromRequest($context . "\154\x69\155\151\164", "\x6c\151\155\151\x74", $mainframe->getCfg("\x6c\x69\163\x74\x5f\154\x69\155\151\x74"), "\x69\156\x74"); $limitstart = $mainframe->getUserStateFromRequest($context . "\x6c\151\x6d\x69\x74\163\164\x61\162\x74", "\x6c\x69\155\x69\x74\x73\x74\141\x72\x74", 0, "\151\x6e\x74"); $total = $addon_vendor->getCountAllCashing($this->vendorId); jimport("\152\157\x6f\x6d\x6c\141\56\x68\164\x6d\x6c\56\x70\141\x67\151\156\x61\x74\151\157\156"); $pagination = new JPagination($total, $limitstart, $limit); $rows = $addon_vendor->getAllCashing($this->vendorId, $pagination->limitstart, $pagination->limit); $view_name = "\141\144\144\x6f\156\137\x76\145\156\x64\157\162"; $view_config = array("\x74\x65\x6d\160\x6c\x61\164\x65\x5f\160\x61\164\150" => JPATH_COMPONENT . "\x2f\164\145\155\160\x6c\141\x74\x65\x73\57" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, "\150\164\x6d\154", '', $view_config); $view->setLayout("\143\x61\163\x68\151\156\147"); $view->assign("\162\157\167\163", $rows); $view->assign("\166\x6e\x64", $vnd); $view->assign("\x70\141\147\151\156\x61\x74\151\x6f\x6e", $pagination); $view->assign("\x63\157\x6e\146\x69\x67", $jshopConfig); $view->display(); } function save_cashing() { $addon_vendor = $this->getModel("\141\x64\144\x6f\x6e\137\x76\x65\x6e\x64\x6f\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x63\x61\x73\150\151\156\x67"); $vndConfig = $addon_vendor->getVendorsConfig(); $jshopConfig = JSFactory::getConfig(); $post = JRequest::get("\x70\157\x73\164"); $post["\x76\145\156\x64\x6f\x72\x5f\151\x64"] = $this->vendorId; $vnd = $addon_vendor->getVendorByUser(); $payment = $addon_vendor->getPayment($post["\x63\x61\x73\150\x69\156\147\137\x70\141\171\155\145\156\164"]); if (substr_count($post["\143\x61\x73\150\151\x6e\x67\x53\x75\x6d\x6d"], "\x2c")) { $post["\x63\141\x73\x68\151\156\x67\123\x75\155\x6d"] = str_replace("\x2c", "\56", $post["\143\x61\163\x68\151\156\147\x53\165\x6d\155"]); } $post["\x63\141\x73\150\151\x6e\x67\123\165\x6d\x6d"] = round($post["\143\x61\x73\150\151\x6e\x67\123\x75\155\x6d"], 2); if ($payment->commission_type == 1) { $post["\143\157\155\x6d\x69\163\x73\151\157\x6e"] = round($post["\x63\x61\x73\150\x69\x6e\x67\123\165\x6d\x6d"] * ($payment->commission / 100), 2); } else { $post["\143\157\x6d\x6d\x69\163\x73\x69\157\156"] = $payment->commission; } if (round($vnd->balance - $post["\143\x61\163\x68\x69\156\x67\x53\x75\155\155"], 2) < 0 || $post["\143\141\163\x68\151\x6e\x67\123\x75\x6d\155"] - $post["\x63\157\155\155\151\163\163\151\x6f\x6e"] <= 0 || $post["\143\x61\163\150\x69\x6e\147\123\x75\x6d\155"] - $post["\x63\157\155\x6d\151\163\x73\151\x6f\x6e"] < $vndConfig->min_money_cashing || $vndConfig->max_money_cashing > 0 && $post["\x63\141\163\150\151\x6e\147\x53\165\155\x6d"] > $vndConfig->max_money_cashing) { JError::raiseWarning('', _JSHOP_ERROR_UNABLE_CASHING_THE_MONEY); $this->setRedirect(SEFLink("\151\x6e\x64\x65\x78\56\x70\150\160\77\157\160\164\151\157\x6e\x3d\143\x6f\155\x5f\x6a\x73\x68\x6f\160\160\151\x6e\147\x26\143\x6f\x6e\164\x72\x6f\154\154\x65\162\x3d\141\x64\x64\157\156\x5f\166\x65\156\x64\x6f\x72\46\x74\141\x73\153\x3d\156\x65\167\x5f\x63\x61\x73\x68\151\x6e\147", 1, 1)); return 0; } if (!isset($post["\x63\141\x73\x68\x69\156\147\x5f\160\141\x79\x6d\145\x6e\x74"])) { JError::raiseWarning('', _JSHOP_SELECT_PAYMENT_SYSTEM); $this->setRedirect(SEFLink("\x69\x6e\144\x65\x78\x2e\x70\150\160\77\x6f\160\x74\151\x6f\156\75\143\x6f\155\137\152\163\x68\x6f\x70\160\151\156\x67\46\143\157\156\164\162\x6f\x6c\x6c\x65\x72\75\141\144\x64\157\156\137\x76\x65\156\x64\x6f\x72\46\x74\141\x73\153\75\156\145\x77\x5f\143\x61\163\150\x69\156\x67", 1, 1)); return 0; } else { if (!$addon_vendor->validateCashingForm($post)) { JError::raiseWarning('', _JSHOP_EMPTY_REQUIRED_FIELDS); $this->setRedirect(SEFLink("\x69\x6e\x64\145\170\x2e\x70\150\160\77\x6f\160\x74\x69\157\x6e\75\143\x6f\155\137\x6a\163\150\x6f\x70\160\151\x6e\147\x26\x63\x6f\156\164\162\x6f\x6c\154\145\162\x3d\x61\x64\x64\157\x6e\137\x76\x65\x6e\x64\157\x72\x26\x74\141\163\x6b\x3d\156\145\167\x5f\143\x61\x73\x68\151\x6e\x67", 1, 1)); return 0; } } if (!$addon_vendor->saveCashing($post)) { JError::raiseWarning('', _JSHOP_VF_ERROR_SAVE_DATABASE); $this->setRedirect(SEFLink("\x69\156\x64\x65\170\56\160\x68\x70\x3f\157\160\164\x69\157\x6e\75\x63\157\155\x5f\152\x73\150\x6f\160\x70\x69\156\147\46\143\x6f\156\x74\162\157\154\x6c\145\162\75\141\x64\144\157\x6e\x5f\166\145\x6e\x64\157\x72\46\x74\141\x73\x6b\75\156\x65\167\137\143\x61\x73\150\151\x6e\147", 1, 1)); return 0; } $post["\160\x61\171\x6d\x65\156\164"] = $addon_vendor->getPayment($post["\x63\141\x73\x68\151\156\x67\x5f\x70\141\171\155\x65\x6e\x74"]); if (count($post["\160\141\171\155\145\156\164\106\151\x65\154\144\x73"]) > 0) { foreach ($post["\160\x61\x79\x6d\145\156\x74\106\151\x65\x6c\144\x73"] as $id => $options) { $post["\160\x61\x79\155\x65\156\164\106\x69\x65\x6c\x64\163"][$id]["\164\151\164\x6c\x65"] = $addon_vendor->getPaymentField($id, $post["\x63\x61\x73\150\151\156\x67\137\x70\141\x79\155\145\156\164"]); } } $mainframe = JFactory::getApplication(); $mailfrom = $mainframe->getCfg("\x6d\141\151\x6c\146\x72\x6f\155"); $fromname = $mainframe->getCfg("\146\162\x6f\x6d\x6e\141\x6d\x65"); $view_name = "\x61\144\x64\157\156\137\166\x65\156\144\157\162"; $view_config = array("\164\145\x6d\160\154\x61\164\x65\137\x70\x61\x74\x68" => JPATH_COMPONENT . "\57\x74\145\155\160\154\x61\164\145\x73\57" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\150\164\155\154", '', $view_config); $view->setLayout("\141\x64\155\151\156\x5f\156\157\164\151\146\x79\x5f\143\141\x73\x68\151\x6e\147"); $view->assign("\x70\157\x73\164", $post); $view->assign("\166\145\156\144\x6f\x72", $vnd); $message = $view->loadTemplate(); $subject = _JSHOP_NEW_CASHING_REQUEST . "\56\x20" . _JSHOP_VENDOR . "\72\x20" . $vnd->f_name . "\40" . $vnd->l_name; JFactory::getMailer()->sendMail($mailfrom, $fromname, $jshopConfig->contact_email, $subject, $message, 1); $this->setRedirect(SEFLink("\151\x6e\144\145\170\x2e\x70\x68\x70\x3f\x6f\160\x74\x69\157\156\x3d\143\157\155\137\x6a\x73\x68\157\x70\x70\151\156\147\46\143\157\156\x74\162\157\x6c\x6c\x65\x72\75\x61\144\144\157\156\137\x76\145\x6e\x64\157\x72\x26\164\141\x73\153\x3d\x63\x61\x73\150\151\156\147", 1, 1), _JSHOP_CASHING_SAVED); } function orders() { $addon_vendor = $this->getModel("\141\x64\x64\157\156\137\166\x65\x6e\x64\x6f\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x6f\162\144\145\x72\x73"); appendPathWay(_JSHOP_MY_ORDERS); setMetaData(_JSHOP_MY_ORDERS, _JSHOP_MY_ORDERS, _JSHOP_MY_ORDERS); $orders = $addon_vendor->getAllOrders($this->vendorId); foreach ($orders as $key => $value) { $orders[$key]->order_href = SEFLink("\x69\156\x64\x65\x78\x2e\x70\150\160\77\157\x70\164\x69\157\156\75\x63\157\x6d\x5f\152\x73\150\157\160\x70\x69\x6e\x67\46\143\157\156\x74\162\x6f\154\x6c\x65\x72\x3d\x61\144\x64\x6f\156\x5f\166\x65\156\144\x6f\x72\46\164\x61\x73\153\75\157\162\x64\145\162\x26\157\162\x64\145\x72\x5f\151\x64\75" . $value->order_id, 1); } $vndConfig = $addon_vendor->getVendorsConfig(); $view_name = "\x61\144\144\x6f\x6e\137\x76\145\x6e\144\157\162"; $view_config = array("\x74\x65\155\160\x6c\x61\164\145\137\160\141\164\x68" => JPATH_COMPONENT . "\57\164\x65\155\160\x6c\141\164\x65\163\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\150\164\155\154", '', $view_config); $view->setLayout("\157\x72\x64\145\x72\163"); $view->assign("\157\162\x64\145\162\163", $orders); $view->assign("\143\x6f\156\146\x69\x67", $vndConfig); $view->assign("\146\151\x6c\x74\145\x72\137\x68\x74\155\154", $addon_vendor->getFilterHtml()); $view->display(); } function order() { $addon_vendor = $this->getModel("\141\144\x64\x6f\156\x5f\166\x65\x6e\144\157\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x6f\162\x64\x65\162\x73"); $vndConfig = $addon_vendor->getVendorsConfig(); $jshopConfig = JSFactory::getConfig(); $lang = JSFactory::getLang(); appendPathWay(_JSHOP_MY_ORDERS, SEFLink("\x69\x6e\144\x65\x78\56\160\x68\160\x3f\x6f\x70\164\151\157\x6e\x3d\143\157\x6d\137\152\163\150\157\x70\160\x69\x6e\147\x26\x63\x6f\x6e\164\162\157\154\x6c\x65\x72\75\x61\144\x64\x6f\x6e\x5f\x76\145\x6e\x64\x6f\x72\46\164\x61\x73\x6b\x3d\157\162\144\x65\162\163", 1)); setMetaData(_JSHOP_MY_ORDERS, _JSHOP_MY_ORDERS, _JSHOP_MY_ORDERS); $order_id = JRequest::getInt("\x6f\162\x64\x65\x72\x5f\151\144"); $order = $addon_vendor->getOrder($order_id); $order_commission = $addon_vendor->getOrderCommission($order_id, $this->vendorId); appendPathWay(_JSHOP_ORDER_NUMBER . "\x3a\40" . $order->order_number); $order->items = $addon_vendor->getOrderItems($order_id, $this->vendorId); if (count($order->items) == 0) { JError::raiseError(500, "\x45\x72\162\x6f\162\40\157\162\x64\x65\162\x20\156\x75\155\x62\x65\x72\x2e\40\131\x6f\x75\x20\141\x72\x65\40\156\x6f\x74\40\164\150\145\40\x6f\167\x6e\x65\x72\x20\x6f\146\40\x74\x68\x69\x73\40\157\162\144\x65\x72"); } $country = JTable::getInstance("\x63\157\x75\156\164\x72\x79", "\152\x73\x68\x6f\x70"); $country->load($order->country); $field_country_name = $lang->get("\156\x61\155\x65"); $order->country = $country->{$field_country_name}; $d_country = JTable::getInstance("\x63\x6f\x75\156\x74\162\171", "\152\x73\150\x6f\x70"); $d_country->load($order->d_country); $field_country_name = $lang->get("\x6e\x61\155\x65"); $order->d_country = $d_country->{$field_country_name}; $jshopConfig->user_field_client_type[0] = ''; $order->client_type_name = $jshopConfig->user_field_client_type[$order->client_type]; $deliverytimes = JSFactory::getAllDeliveryTime(); if (isset($deliverytimes[$order->delivery_times_id])) { $order->delivery_time_name = $deliverytimes[$order->delivery_times_id]; if ($order->delivery_time_name == '') { $order->delivery_time_name = $order->delivery_time; } } else { $order->delivery_time_name = $order->delivery_time; } $tmp_fields = $jshopConfig->getListFieldsRegister(); $config_fields = $tmp_fields["\x61\144\144\162\145\163\x73"]; $count_filed_delivery = 0; foreach ($config_fields as $k => $v) { if (substr($k, 0, 2) == "\x64\x5f" && $v["\144\x69\x73\x70\x6c\x61\171"] == 1) { $count_filed_delivery++; } } if ($jshopConfig->order_display_new_digital_products) { $product = JTable::getInstance("\x70\162\x6f\x64\165\143\164", "\x6a\163\150\157\x70"); foreach ($order->items as $k => $v) { $product->product_id = $v->product_id; $product->setAttributeActive(unserialize($v->attributes)); $files = $product->getSaleFiles(); $order->items[$k]->files = serialize($files); } } $order_status_modify = $vndConfig->order_status_modify && $order->vendor_id != -1; $lists = array(); if ($order_status_modify) { $lists["\x73\x74\141\164\x75\x73"] = JHTML::_("\x73\x65\x6c\145\143\x74\56\147\x65\156\x65\x72\x69\143\x6c\x69\163\164", JshopHelpersSelectOptions::getOrderStatus(), "\x6f\x72\x64\x65\x72\137\x73\x74\x61\x74\x75\x73", "\143\x6c\141\163\163\40\x3d\40\x22\x69\x6e\x70\x75\164\142\x6f\170\42\40\x6f\x6e\x63\150\141\156\147\x65\75\x22\164\x68\151\x73\x2e\x66\x6f\162\155\56\x73\x75\x62\x6d\x69\164\50\51\42", "\163\x74\141\164\x75\163\x5f\151\144", "\x6e\x61\155\x65", $order->order_status); } $view_name = "\x61\x64\x64\x6f\x6e\137\166\145\x6e\x64\157\x72"; $view_config = array("\x74\x65\x6d\160\x6c\141\164\145\137\160\141\x74\150" => JPATH_COMPONENT . "\x2f\164\145\x6d\x70\x6c\141\x74\145\x73\57" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, getDocumentType(), '', $view_config); $view->setLayout("\157\x72\x64\145\x72"); $view->assign("\x6f\x72\144\x65\162", $order); $view->assign("\x63\157\156\146\x69\147", $jshopConfig); $view->assign("\143\x6f\156\146\151\x67\x5f\x66\x69\145\154\144\x73", $config_fields); $view->assign("\x76\156\144\x43\x6f\156\x66\151\x67", $vndConfig); $view->assign("\x63\157\x75\156\x74\137\146\151\x6c\x65\x64\x5f\144\145\x6c\151\166\x65\x72\171", $count_filed_delivery); $view->assign("\157\162\x64\x65\x72\137\143\x6f\x6d\x6d\151\163\x73\x69\x6f\x6e", $order_commission); $view->assign("\x6c\151\163\164\163", $lists); $view->assign("\157\162\x64\x65\x72\137\163\164\141\164\x75\163\137\155\x6f\x64\x69\146\x79", $order_status_modify); $view->display(); } public function products() { $addon_vendor = $this->getModel("\141\144\144\157\156\x5f\166\x65\x6e\144\157\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\155\x79\x50\x72\157\x64\165\143\164\x73"); setMetaData(_JSHOP_MY_PRODUCTS, _JSHOP_MY_PRODUCTS, _JSHOP_MY_PRODUCTS); appendPathWay(_JSHOP_MY_PRODUCTS); $vendorInf = $addon_vendor->getVendorByUser(); $mainframe = JFactory::getApplication(); $jshopConfig = JSFactory::getConfig(); $products = $this->getModel("\x70\x72\157\144\x75\x63\x74\x73"); $context = "\x6a\163\x68\157\160\x69\x6e\147\x2e\166\145\x6e\x64\157\x72\163\137\x70\162\157\144\165\x63\164\x73\137\x6c\x69\163\x74"; $limit = $mainframe->getUserStateFromRequest($context . "\154\151\x6d\x69\x74", "\154\151\x6d\x69\164", $mainframe->getCfg("\x6c\x69\163\x74\137\154\151\155\x69\x74"), "\151\x6e\164"); $limitstart = $mainframe->getUserStateFromRequest($context . "\x6c\151\155\x69\164\x73\x74\141\162\164", "\154\151\x6d\x69\x74\163\164\x61\x72\164", 0, "\151\156\x74"); $filter_order = $mainframe->getUserStateFromRequest($context . "\146\151\x6c\164\x65\x72\137\x6f\x72\x64\x65\x72", "\x66\151\154\164\145\162\137\157\162\x64\145\162", "\160\162\157\144\x75\x63\x74\x5f\x69\x64", "\x63\155\144"); $filter_order_Dir = $mainframe->getUserStateFromRequest($context . "\146\x69\154\164\145\162\137\x6f\162\144\x65\162\137\104\151\162", "\x66\151\154\164\x65\162\137\157\162\144\145\x72\x5f\x44\x69\x72", "\x61\163\x63", "\x63\x6d\x64"); if (isset($_GET["\x63\x61\x74\145\147\x6f\162\171\x5f\151\144"]) && $_GET["\x63\141\164\x65\x67\157\162\171\137\151\x64"] === "\x30") { $mainframe->setUserState($context . "\143\x61\164\x65\147\157\x72\171\x5f\x69\x64", 0); $mainframe->setUserState($context . "\x6d\141\x6e\165\146\x61\x63\164\x75\x72\145\162\x5f\x69\144", 0); $mainframe->setUserState($context . "\x6c\x61\142\x65\154\137\x69\144", 0); $mainframe->setUserState($context . "\x70\x75\142\154\x69\x73\150", 0); $mainframe->setUserState($context . "\x74\145\x78\164\x5f\x73\x65\x61\x72\143\150", ''); } $category_id = $mainframe->getUserStateFromRequest($context . "\143\x61\164\x65\x67\157\162\x79\x5f\x69\144", "\x63\141\x74\145\x67\x6f\162\171\137\151\144", 0, "\x69\156\x74"); $manufacturer_id = $mainframe->getUserStateFromRequest($context . "\155\141\156\x75\146\141\x63\164\x75\x72\x65\x72\137\151\x64", "\155\141\x6e\x75\146\x61\x63\x74\165\162\x65\x72\137\151\144", 0, "\151\156\x74"); $label_id = $mainframe->getUserStateFromRequest($context . "\x6c\141\x62\145\154\137\151\x64", "\154\141\x62\145\154\x5f\151\144", 0, "\x69\156\164"); $publish = $mainframe->getUserStateFromRequest($context . "\x70\x75\142\x6c\x69\x73\150", "\x70\x75\142\x6c\x69\163\x68", 0, "\x69\156\164"); $text_search = $mainframe->getUserStateFromRequest($context . "\x74\x65\x78\164\x5f\163\x65\141\x72\143\150", "\164\145\x78\x74\x5f\163\x65\141\162\143\150", ''); $filter = array("\x63\141\164\145\x67\157\162\171\x5f\151\144" => $category_id, "\155\x61\x6e\x75\146\141\x63\164\165\x72\x65\162\x5f\x69\x64" => $manufacturer_id, "\154\x61\142\145\x6c\x5f\151\x64" => $label_id, "\160\x75\142\154\151\163\150" => $publish, "\164\x65\170\164\x5f\163\145\141\162\x63\150" => $text_search, "\166\145\x6e\x64\x6f\x72\x5f\151\x64" => $this->vendorId); $total = $products->getCountAllProducts($filter); jimport("\x6a\157\x6f\x6d\x6c\x61\x2e\x68\164\x6d\x6c\56\x70\x61\x67\151\156\x61\x74\x69\x6f\x6e"); $pagination = new JPagination($total, $limitstart, $limit); $rows = $addon_vendor->getAllProducts($filter, $pagination->limitstart, $pagination->limit, $filter_order, $filter_order_Dir); $parentTop = new stdClass(); $parentTop->category_id = 0; $parentTop->name = _JSHOP_CATEGORY; $categories_select = buildTreeCategory(0); array_unshift($categories_select, $parentTop); $lists["\x74\x72\145\145\143\141\164\145\147\157\x72\151\x65\163"] = JHTML::_("\163\x65\154\145\x63\x74\x2e\147\x65\156\x65\x72\151\143\x6c\151\x73\x74", $categories_select, "\143\x61\164\145\x67\x6f\162\x79\137\x69\144", "\x6f\x6e\143\x68\x61\156\147\x65\x3d\x22\144\157\143\x75\155\145\156\x74\56\141\144\155\x69\156\106\157\x72\155\56\x73\x75\x62\155\x69\x74\50\x29\73\x22\x20\x73\164\171\154\145\x20\x3d\40\42\x77\x69\144\164\x68\72\40\61\64\x30\x70\x78\x3b\42", "\x63\x61\164\x65\147\157\x72\x79\x5f\151\144", "\156\x61\155\x65", $category_id); $manuf1 = array(); $manuf1[0] = new stdClass(); $manuf1[0]->manufacturer_id = "\x30"; $manuf1[0]->name = _JSHOP_MANUFACTURER; $_manufacturer = $this->getModel("\x6d\x61\156\165\146\141\143\x74\x75\x72\x65\162\x73"); $manufs = $_manufacturer->getAllManufacturers(0); $manufs = array_merge($manuf1, $manufs); $lists["\155\x61\x6e\x75\x66\141\143\x74\165\x72\145\162\163"] = JHTML::_("\x73\x65\154\145\x63\164\x2e\x67\x65\x6e\145\162\x69\143\x6c\151\x73\x74", $manufs, "\x6d\141\x6e\x75\x66\141\143\164\165\x72\x65\x72\137\151\x64", "\x6f\x6e\x63\x68\x61\x6e\147\145\x3d\42\144\157\x63\x75\155\x65\156\x74\x2e\141\144\x6d\x69\x6e\x46\x6f\x72\155\56\163\165\x62\155\x69\x74\x28\51\73\x22\40\x73\x74\x79\x6c\x65\40\x3d\x20\x22\167\151\x64\164\150\x3a\40\x31\x34\60\160\x78\x3b\42", "\155\141\x6e\165\146\141\143\x74\x75\162\145\162\137\x69\x64", "\x6e\x61\x6d\x65", $manufacturer_id); if ($jshopConfig->admin_show_product_labels) { $_labels = $this->getModel("\x70\x72\x6f\144\x75\x63\x74\114\x61\x62\x65\154\163"); $alllabels = $_labels->getList(); $first = array(); $first[] = JHTML::_("\x73\145\x6c\x65\143\x74\x2e\157\x70\164\x69\x6f\x6e", "\60", _JSHOP_LABEL, "\x69\x64", "\156\141\155\145"); $lists["\x6c\x61\x62\145\154\163"] = JHTML::_("\x73\145\154\x65\143\x74\x2e\147\x65\156\145\x72\x69\143\154\x69\x73\x74", array_merge($first, $alllabels), "\154\x61\x62\x65\154\137\151\144", "\x6f\x6e\143\x68\x61\x6e\147\x65\75\x22\x64\157\143\165\x6d\x65\156\164\56\141\144\155\x69\156\x46\x6f\162\155\x2e\x73\x75\142\x6d\151\x74\50\x29\x3b\42\x20\163\164\171\x6c\145\x20\x3d\x20\42\167\x69\144\x74\150\x3a\x20\x31\x30\60\160\170\x3b\x22", "\x69\x64", "\x6e\x61\x6d\145", $label_id); } $f_option = array(); $f_option[] = JHTML::_("\163\x65\x6c\x65\x63\164\56\x6f\160\x74\x69\157\156", 0, _JSHOP_VF_SHOW, "\x69\x64", "\156\141\x6d\145"); $f_option[] = JHTML::_("\163\145\x6c\145\x63\164\56\157\x70\x74\151\157\156", 1, _JSHOP_VF_PUBLISH, "\x69\x64", "\156\141\155\x65"); $f_option[] = JHTML::_("\163\145\x6c\145\143\x74\x2e\x6f\160\x74\x69\157\156", 2, _JSHOP_VF_UNPUBLISH, "\151\x64", "\156\x61\x6d\145"); $lists["\160\165\x62\x6c\151\x73\150"] = JHTML::_("\x73\x65\154\x65\x63\164\x2e\147\x65\156\145\x72\151\x63\x6c\x69\163\164", $f_option, "\160\x75\x62\154\151\x73\150", "\x6f\x6e\x63\150\x61\156\x67\145\75\42\144\x6f\143\x75\x6d\x65\156\164\x2e\x61\x64\x6d\151\156\x46\157\x72\x6d\56\163\165\142\x6d\151\x74\x28\x29\x3b\x22\x20\163\164\171\154\145\x20\75\x20\42\x77\151\x64\164\150\x3a\x20\x31\60\x30\160\170\73\42", "\x69\144", "\156\141\155\x65", $publish); $view_name = "\141\x64\144\157\x6e\137\166\145\x6e\x64\x6f\162"; $view_config = array("\x74\x65\x6d\160\x6c\x61\x74\x65\x5f\160\141\164\x68" => JPATH_COMPONENT . "\57\x74\x65\x6d\160\154\141\x74\145\x73\57" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\x68\164\155\x6c", '', $view_config); $view->setLayout("\x70\x72\157\144\165\x63\164\137\x6c\x69\x73\x74"); $view->assign("\162\157\x77\x73", $rows); $view->assign("\x6c\x69\x73\x74\163", $lists); $view->assign("\x63\x61\x74\145\x67\157\x72\x79\137\151\144", $category_id); $view->assign("\x6d\x61\156\x75\x66\x61\x63\164\x75\x72\145\162\x5f\x69\144", $manufacturer_id); $view->assign("\x70\x61\147\x69\x6e\x61\x74\151\157\156", $pagination); $view->assign("\x74\145\170\164\x5f\163\x65\141\x72\x63\150", $text_search); $view->assign("\143\157\156\146\x69\147", $jshopConfig); $view->assign("\x66\x69\154\164\145\x72\137\x6f\x72\144\x65\162", $filter_order); $view->assign("\146\x69\x6c\164\x65\162\x5f\157\x72\144\145\x72\137\104\x69\162", $filter_order_Dir); $view->assign("\x76\x65\156\144\157\162\111\x6e\146", $vendorInf); $view->display(); } function edit_product() { $addon_vendor = $this->getModel("\141\144\x64\x6f\x6e\x5f\166\145\x6e\x64\157\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x61\144\x64\120\x72\x6f\144\165\x63\x74"); JPluginHelper::importPlugin("\x6a\163\x68\157\x70\x70\151\156\x67\x61\x64\x6d\x69\156"); $dispatcher = JDispatcher::getInstance(); $dispatcher->trigger("\157\156\126\x65\x6e\x64\x6f\162\114\157\141\x64\105\144\151\x74\120\162\157\144\x75\143\164", array()); $lang = JSFactory::getLang(); $jshopConfig = JSFactory::getConfig(); $product_id = JRequest::getInt("\x70\x72\157\144\165\x63\x74\137\151\x64"); $product_attr_id = JRequest::getInt("\x70\x72\157\144\165\143\x74\x5f\141\x74\x74\x72\137\151\144"); if ($product_attr_id) { $product_attr = JSFactory::getTable("\160\x72\157\144\x75\143\x74\x41\x74\x74\x72\x69\142\165\x74", "\x6a\x73\150\157\160"); $product_attr->load($product_attr_id); if ($product_attr->ext_attribute_product_id) { $product_id = $product_attr->ext_attribute_product_id; } else { $product = JSFactory::getTable("\160\x72\157\x64\165\x63\164", "\x6a\x73\x68\157\x70"); $product->parent_id = $product_attr->product_id; $product->store(); $product_id = $product->product_id; $product_attr->ext_attribute_product_id = $product_id; $product_attr->store(); } } if ($product_id && $this->vendorId && !$product_attr_id) { checkAccessVendorToProduct($this->vendorId, $product_id); } if ($product_id > 0) { setMetaData(_JSHOP_VF_EDIT_PRODUCT, _JSHOP_VF_EDIT_PRODUCT, _JSHOP_VF_EDIT_PRODUCT); appendPathWay(_JSHOP_VF_EDIT_PRODUCT); } else { setMetaData(_JSHOP_ADD_PRODUCT, _JSHOP_ADD_PRODUCT, _JSHOP_ADD_PRODUCT); appendPathWay(_JSHOP_ADD_PRODUCT); } $vndConfig = $addon_vendor->getVendorsConfig(); $products = $this->getModel("\x70\x72\x6f\x64\165\x63\164\x73"); $product = JTable::getInstance("\x70\162\x6f\144\165\x63\164", "\152\x73\150\157\160"); $product->load($product_id); $post["\x76\145\x6e\x64\x6f\162\137\x69\x64"] = $this->vendorId; $_productprice = JTable::getInstance("\160\x72\157\x64\x75\143\x74\120\x72\x69\x63\x65", "\152\163\150\157\x70"); $product->product_add_prices = $_productprice->getAddPrices($product_id); $product->product_add_prices = array_reverse($product->product_add_prices); $name = $lang->get("\x6e\141\x6d\145"); $product->name = $product->{$name}; $_lang = $this->getModel("\154\x61\156\x67\165\x61\x67\145\x73"); $languages = $_lang->getAllLanguages(1); $multilang = count($languages) > 1; $nofilter = array(); JFilterOutput::objectHTMLSafe($product, ENT_QUOTES, $nofilter); $edit = intval($product_id); if (!$product_id) { $rows = array(); $product->product_quantity = 1; $product->product_publish = 1; } $_tax = $this->getModel("\164\x61\x78\145\x73"); $all_taxes = $_tax->getAllTaxes(); if ($edit) { $images = $product->getImages(); $videos = $product->getVideos(); $files = $product->getFiles(); $categories_select = $product->getCategories(); $categories_select_list = array(); if (count($categories_select) > 0) { foreach ($categories_select as $v) { $categories_select_list[] = $v->category_id; } } $related_products = $products->getRelatedProducts($product_id); $db = JFactory::getDBO(); $db->setQuery("\123\x45\114\105\103\124\x20\140\x63\157\165\156\164\162\171\137\151\144\x60\40\x41\123\40\x60\x63\x6f\165\x6e\164\x72\x79\137\151\144\140\54\x20\x60\x6e\x61\x6d\145\x5f\x72\165\55\x52\x55\140\40\101\x53\x20\140\x63\x6f\165\156\164\162\x79\x5f\x6e\x61\x6d\145\140\x20\x46\122\x4f\x4d\40\x60\43\x5f\137\x6a\163\150\x6f\160\x70\151\x6e\x67\137\x63\157\x75\156\x74\162\x69\145\163\x60"); $row = $db->loadObjectList(); if (!empty($row)) { $db->setQuery("\123\105\x4c\x45\x43\x54\x20\140\x73\x74\141\164\145\137\151\144\140\54\x20\x60\x63\x6f\165\x6e\x74\162\x79\x5f\x69\144\140\x20\106\122\117\x4d\40\140\x23\137\x5f\152\163\x68\157\x70\160\151\156\x67\137\160\162\x6f\144\165\x63\x74\x73\140\40\x57\110\105\x52\105\40\140\x70\x72\x6f\x64\165\143\x74\137\151\x64\x60\75\x27{$product_id}\x27"); $row_product = $db->loadObjectList(); $country_id = $row_product[0]->country_id; $state_id = $row_product[0]->state_id; if (!empty($row_product) and !empty($country_id) and !empty($state_id)) { $lists["\162\x65\x67\x69\x6f\x6e\x73"] = "\x3c\163\145\x6c\145\143\x74\40\151\144\x3d\42\x72\145\x67\x69\157\x6e\137\x69\x64\x22\x20\156\x61\155\145\x3d\x22\x72\x65\x67\x69\157\156\x5f\x69\144\x22\x20\x63\x6c\141\163\163\75\x22\151\156\x70\165\x74\x62\157\x78\x22\40\x73\151\x7a\145\75\42\61\x22\40\x64\141\164\141\x2d\x6f\x72\x69\147\x69\x6e\x61\154\55\164\151\164\154\x65\x3d\x22\x22\40\x74\x69\164\x6c\x65\x3d\42\42\x3e" . PHP_EOL; foreach ($row as $region) { if ($region->country_id == $country_id) { $lists["\x72\x65\x67\x69\157\x6e\x73"] .= "\x3c\157\160\x74\151\x6f\156\40\166\141\154\165\x65\75\42" . $region->country_id . "\42\x20\163\145\154\145\143\x74\x65\x64\75\42\163\x65\154\145\143\x74\x65\144\42\40\x64\141\x74\x61\x2d\157\x72\151\x67\151\156\x61\154\55\164\x69\x74\x6c\x65\x3d\x22\42\x20\164\x69\x74\154\145\x3d\x22\42\x3e" . $region->country_name . "\74\57\157\160\x74\151\x6f\x6e\x3e" . PHP_EOL; $country_id = $region->country_id; $db->setQuery("\123\105\114\105\103\124\40\140\x73\164\141\164\x65\137\x69\144\140\x20\101\123\x20\140\x63\151\x74\x79\137\x69\x64\x60\54\40\x60\x6e\141\155\x65\x5f\x72\165\55\x52\125\x60\x20\x41\x53\x20\140\143\151\x74\x79\137\156\141\155\x65\x60\40\x46\x52\x4f\115\x20\140\43\x5f\x5f\152\163\x68\x6f\x70\160\x69\156\147\137\163\164\x61\164\x65\163\140\x20\127\x48\x45\122\105\40\140\143\157\165\156\164\x72\171\137\151\x64\x60\x3d\x27{$country_id}\47"); $row_city = $db->loadObjectList(); } else { $lists["\162\145\147\151\157\x6e\163"] .= "\74\157\160\164\151\x6f\156\40\x76\141\x6c\165\x65\75\x22" . $region->country_id . "\42\x20\x64\x61\x74\141\55\157\x72\x69\x67\151\156\141\x6c\x2d\x74\151\164\x6c\x65\75\x22\42\x20\x74\x69\x74\154\145\75\x22\42\76" . $region->country_name . "\74\57\157\160\x74\x69\157\x6e\x3e" . PHP_EOL; } } $lists["\x72\145\x67\x69\x6f\156\163"] .= "\x3c\x2f\163\145\x6c\145\143\x74\76" . PHP_EOL; $lists["\143\x69\164\x69\x65\163"] = "\74\163\x65\x6c\145\143\x74\x20\x69\x64\x3d\x22\x63\x69\x74\171\137\x69\144\42\x20\156\x61\x6d\x65\75\42\x63\151\164\x79\137\151\x64\x22\40\143\x6c\x61\x73\163\75\x22\x69\156\x70\165\164\142\157\170\x22\40\163\x69\172\145\75\42\61\x22\x20\x64\141\164\141\55\x6f\162\x69\x67\x69\x6e\x61\154\55\x74\151\x74\x6c\x65\75\42\x22\40\164\x69\164\x6c\x65\75\x22\42\76" . PHP_EOL; if (!empty($row_city)) { foreach ($row_city as $city) { if ($city->city_id == $state_id) { $lists["\x63\151\164\151\x65\x73"] .= "\74\157\x70\x74\151\x6f\x6e\40\x76\141\x6c\165\x65\75\42" . $city->city_id . "\42\40\x73\x65\x6c\x65\x63\164\145\144\x3d\42\x73\x65\154\145\143\x74\x65\144\x22\x20\144\141\164\x61\x2d\x6f\x72\151\147\151\x6e\x61\154\x2d\164\151\164\154\x65\75\x22\42\40\x74\151\x74\154\x65\x3d\42\42\x3e" . $city->city_name . "\74\57\157\x70\x74\x69\x6f\156\76" . PHP_EOL; } else { $lists["\x63\x69\164\x69\x65\x73"] .= "\74\x6f\x70\x74\x69\x6f\x6e\x20\x76\141\x6c\x75\145\75\x22" . $city->city_id . "\42\40\x64\x61\x74\x61\55\x6f\162\x69\x67\151\x6e\141\154\x2d\164\x69\x74\x6c\x65\75\x22\x22\40\164\151\164\154\145\x3d\x22\x22\76" . $city->city_name . "\74\x2f\x6f\160\164\x69\x6f\156\x3e" . PHP_EOL; } } } $lists["\x63\x69\x74\151\145\x73"] .= "\74\x2f\x73\145\x6c\x65\143\164\x3e" . PHP_EOL; } else { $lists["\162\145\147\151\157\156\163"] = "\x3c\163\x65\x6c\145\143\x74\40\x69\x64\x3d\42\162\145\147\151\x6f\x6e\137\151\x64\42\40\x6e\141\155\x65\x3d\x22\162\x65\147\x69\157\x6e\137\151\144\42\40\x63\154\x61\163\163\75\x22\x69\156\x70\165\164\142\x6f\x78\42\x20\163\151\x7a\x65\x3d\x22\61\x22\x20\144\x61\164\x61\x2d\x6f\x72\151\147\x69\x6e\x61\154\x2d\x74\151\164\x6c\x65\75\42\x22\40\x74\151\164\x6c\x65\75\42\42\76" . PHP_EOL; foreach ($row as $region) { if ($region->country_name == "\xd0\xa1\xd0\xb0\xd0\xbc\320\xb0\xd1\x80\xd1\x81\320\xba\xd0\xb0\xd1\217\x20\xd0\x9e\320\261\xd0\273\320\xb0\xd1\x81\321\202\321\214") { $lists["\x72\145\x67\151\x6f\156\x73"] .= "\x3c\157\160\164\x69\157\156\x20\x76\141\x6c\165\x65\x3d\x22" . $region->country_id . "\42\40\x73\x65\x6c\145\143\x74\145\144\x3d\x22\163\145\x6c\145\x63\164\x65\144\x22\40\144\x61\164\141\55\x6f\x72\151\147\151\156\141\x6c\55\x74\x69\x74\x6c\x65\75\42\42\40\164\151\164\x6c\145\x3d\42\42\76" . $region->country_name . "\x3c\57\x6f\160\x74\151\157\156\x3e" . PHP_EOL; $country_id = $region->country_id; $db->setQuery("\123\x45\x4c\105\103\124\x20\140\163\164\x61\x74\x65\x5f\151\x64\140\40\101\123\40\140\143\151\164\x79\x5f\151\144\140\x2c\x20\x60\156\x61\x6d\x65\137\162\165\x2d\x52\x55\x60\x20\101\x53\40\140\143\151\x74\171\137\x6e\x61\155\145\x60\x20\x46\122\x4f\115\40\x60\43\137\x5f\152\x73\x68\x6f\x70\160\x69\156\x67\137\163\x74\x61\164\x65\163\140\x20\x57\x48\105\x52\105\x20\140\x63\157\165\x6e\x74\x72\x79\137\151\x64\140\x3d\47{$country_id}\47"); $row_city = $db->loadObjectList(); } else { $lists["\162\x65\147\151\x6f\156\163"] .= "\74\157\x70\164\151\x6f\x6e\40\x76\x61\x6c\165\x65\x3d\42" . $region->country_id . "\x22\x20\x64\x61\x74\141\55\157\x72\151\x67\x69\x6e\141\154\55\164\x69\164\154\x65\x3d\x22\42\x20\164\151\164\154\145\x3d\42\42\76" . $region->country_name . "\x3c\x2f\x6f\x70\164\x69\x6f\x6e\x3e" . PHP_EOL; } } $lists["\x72\x65\147\x69\157\x6e\163"] .= "\x3c\57\x73\145\154\x65\143\x74\76" . PHP_EOL; $lists["\x63\x69\x74\151\145\163"] = "\x3c\x73\145\x6c\x65\x63\x74\40\151\144\75\x22\143\151\x74\171\x5f\x69\144\42\x20\156\x61\155\x65\75\42\143\x69\x74\171\137\x69\x64\42\40\143\x6c\141\163\163\x3d\x22\151\x6e\160\x75\164\142\x6f\170\42\40\163\x69\x7a\x65\75\x22\x31\42\x20\x64\141\164\141\x2d\x6f\162\x69\x67\x69\156\141\154\55\x74\x69\164\154\145\x3d\42\x22\40\164\151\164\154\x65\x3d\x22\42\x3e" . PHP_EOL; if (!empty($row_city)) { foreach ($row_city as $city) { if ($city->city_name == "\xd0\241\xd0\xb0\xd0\274\xd0\260\xd1\x80\320\xb0") { $lists["\x63\151\164\x69\145\163"] .= "\x3c\x6f\160\x74\151\157\156\x20\x76\141\154\165\x65\x3d\x22" . $city->city_id . "\42\x20\163\145\x6c\145\x63\164\145\x64\x3d\42\163\145\154\x65\143\164\x65\144\x22\x20\x64\141\164\141\x2d\157\x72\x69\x67\x69\x6e\141\x6c\55\x74\x69\164\154\145\75\x22\42\40\x74\151\x74\x6c\x65\75\42\x22\76" . $city->city_name . "\74\x2f\x6f\x70\164\x69\157\x6e\x3e" . PHP_EOL; } else { $lists["\x63\x69\164\151\145\163"] .= "\74\x6f\x70\164\151\x6f\156\x20\x76\x61\x6c\165\145\75\42" . $city->city_id . "\42\40\144\x61\164\141\x2d\157\x72\x69\x67\x69\x6e\141\154\x2d\x74\151\164\x6c\x65\75\42\x22\x20\164\151\x74\x6c\145\75\42\x22\76" . $city->city_name . "\74\x2f\157\160\164\151\x6f\156\76" . PHP_EOL; } } } $lists["\x63\x69\164\x69\145\x73"] .= "\x3c\57\x73\145\x6c\x65\143\x74\76" . PHP_EOL; } } } else { $images = array(); $videos = array(); $files = array(); $categories_select_list = array(); $categories_select = null; $related_products = array(); $db = JFactory::getDBO(); $db->setQuery("\123\x45\114\105\x43\x54\x20\x60\143\x6f\165\156\164\162\171\137\151\x64\140\x20\x41\x53\x20\x60\x63\x6f\165\x6e\x74\x72\x79\x5f\151\x64\140\54\x20\140\156\141\155\145\137\162\x75\55\122\125\x60\x20\101\123\x20\x60\143\157\x75\x6e\x74\162\x79\137\156\141\155\x65\x60\40\106\x52\x4f\x4d\x20\x60\43\x5f\137\x6a\x73\150\x6f\160\160\x69\x6e\147\137\x63\157\165\156\164\162\x69\145\x73\140"); $row = $db->loadObjectList(); if (!empty($row)) { $lists["\x72\x65\x67\x69\x6f\x6e\163"] = "\x3c\x73\145\x6c\145\x63\164\x20\x69\144\75\x22\x72\145\x67\x69\x6f\156\137\x69\x64\42\40\x6e\x61\155\x65\75\x22\x72\145\147\x69\x6f\156\x5f\151\x64\x22\40\143\x6c\141\x73\x73\75\x22\151\156\x70\165\x74\142\157\170\42\x20\163\151\x7a\145\75\42\x31\42\40\144\141\164\141\x2d\x6f\162\151\x67\151\156\x61\x6c\x2d\x74\151\164\154\145\x3d\42\42\x20\x74\151\164\154\145\x3d\42\x22\76" . PHP_EOL; foreach ($row as $region) { if ($region->country_name == "\320\xa1\xd0\260\320\274\320\260\321\x80\321\201\xd0\272\320\xb0\xd1\x8f\x20\xd0\x9e\320\261\xd0\273\320\260\321\x81\321\202\xd1\x8c") { $lists["\x72\145\x67\x69\157\x6e\163"] .= "\x3c\157\x70\x74\151\x6f\x6e\x20\x76\x61\154\x75\x65\x3d\42" . $region->country_id . "\42\40\x73\145\x6c\x65\143\x74\x65\x64\x3d\42\163\x65\x6c\145\143\164\145\144\42\x20\x64\141\x74\x61\x2d\157\x72\151\x67\151\x6e\141\154\x2d\164\x69\x74\154\145\x3d\42\42\x20\164\x69\164\154\145\x3d\42\x22\x3e" . $region->country_name . "\x3c\57\157\x70\x74\151\157\x6e\76" . PHP_EOL; $country_id = $region->country_id; $db->setQuery("\x53\x45\x4c\x45\x43\124\40\x60\163\x74\141\x74\x65\137\x69\x64\140\x20\101\123\x20\x60\x63\x69\x74\171\137\151\x64\x60\x2c\x20\140\x6e\x61\x6d\145\137\162\165\55\x52\x55\140\40\x41\123\x20\140\143\151\x74\171\137\156\141\155\145\140\x20\106\x52\117\x4d\40\x60\x23\x5f\137\152\163\x68\x6f\x70\160\x69\156\147\x5f\163\164\141\x74\145\x73\x60\x20\127\x48\105\x52\105\x20\140\143\157\x75\x6e\164\162\171\x5f\x69\x64\x60\75\47{$country_id}\x27"); $row_city = $db->loadObjectList(); } else { $lists["\162\x65\x67\151\x6f\156\x73"] .= "\x3c\157\x70\x74\x69\x6f\x6e\40\166\x61\x6c\x75\x65\x3d\x22" . $region->country_id . "\42\x20\x64\x61\x74\141\x2d\x6f\x72\x69\147\x69\156\x61\x6c\x2d\x74\151\x74\154\x65\75\42\x22\40\164\151\164\154\145\x3d\42\x22\76" . $region->country_name . "\74\x2f\157\x70\164\151\x6f\156\x3e" . PHP_EOL; } } $lists["\162\145\147\x69\157\156\163"] .= "\x3c\57\x73\145\154\x65\x63\x74\76" . PHP_EOL; $lists["\x63\151\164\151\x65\x73"] = "\74\163\x65\x6c\x65\143\x74\x20\151\144\x3d\x22\x63\151\x74\171\137\x69\x64\x22\40\x6e\141\155\145\x3d\42\x63\151\x74\x79\137\x69\144\42\x20\143\x6c\141\163\x73\x3d\x22\x69\156\160\x75\164\142\157\170\42\40\x73\x69\172\x65\x3d\42\x31\42\x20\144\141\x74\x61\x2d\x6f\x72\151\x67\151\156\x61\154\55\164\151\164\x6c\145\75\42\x22\40\x74\151\x74\x6c\x65\x3d\42\42\x3e" . PHP_EOL; if (!empty($row_city)) { foreach ($row_city as $city) { if ($city->city_name == "\320\241\xd0\260\320\274\320\xb0\xd1\200\xd0\260") { $lists["\x63\x69\164\x69\x65\163"] .= "\x3c\x6f\160\x74\x69\157\x6e\40\x76\141\x6c\x75\x65\75\x22" . $city->city_id . "\x22\x20\163\145\x6c\x65\143\164\145\x64\75\x22\x73\145\x6c\x65\x63\164\145\x64\42\40\144\x61\164\x61\55\157\x72\151\x67\151\x6e\x61\154\x2d\x74\x69\164\x6c\145\75\42\42\x20\x74\x69\164\x6c\x65\75\x22\x22\x3e" . $city->city_name . "\x3c\57\x6f\160\164\151\157\x6e\76" . PHP_EOL; } else { $lists["\143\151\164\x69\145\x73"] .= "\74\x6f\160\x74\151\x6f\x6e\x20\166\141\154\165\145\x3d\x22" . $city->city_id . "\x22\x20\x64\141\164\141\x2d\x6f\x72\151\x67\151\156\141\154\55\x74\151\x74\x6c\145\75\42\42\x20\x74\151\x74\x6c\x65\75\x22\x22\76" . $city->city_name . "\x3c\x2f\x6f\160\x74\151\x6f\x6e\x3e" . PHP_EOL; } } } $lists["\143\151\164\151\x65\163"] .= "\x3c\57\x73\145\154\x65\143\x74\x3e" . PHP_EOL; } } if ($jshopConfig->tax) { $list_tax = array(); foreach ($all_taxes as $tax) { $list_tax[] = JHTML::_("\163\145\154\145\x63\164\56\157\160\164\x69\x6f\156", $tax->tax_id, $tax->tax_name . "\x20\50" . $tax->tax_value . "\45\x29", "\164\141\170\x5f\x69\x64", "\x74\141\x78\137\156\141\155\x65"); } $withouttax = 0; } else { $withouttax = 1; } $categories = buildTreeCategory(0); if (count($categories) == 0) { JError::raiseNotice(0, _JSHOP_PLEASE_ADD_CATEGORY); } $lists["\x69\155\141\147\x65\x73"] = $images; $lists["\166\151\144\145\x6f\163"] = $videos; $lists["\x66\x69\x6c\145\x73"] = $files; $manuf1 = array(); $manuf1[0] = new stdClass(); $manuf1[0]->manufacturer_id = "\60"; $manuf1[0]->name = _JSHOP_VF_NONE; $_manufacturer = $this->getModel("\155\141\x6e\165\x66\141\x63\164\165\x72\145\162\163"); $manufs = $_manufacturer->getAllManufacturers(0); $manufs = array_merge($manuf1, $manufs); $_attribut = $this->getModel("\141\164\164\162\x69\142\165\x74"); $list_all_attributes = $_attribut->getAllAttributes(2, $categories_select_list); $_attribut_value = $this->getModel("\x61\164\164\x72\x69\142\165\164\x56\141\x6c\165\145"); $lists["\x61\164\x74\x72\151\x62\x73"] = $product->getAttributes(); $lists["\151\x6e\x64\137\141\x74\164\x72\151\142\x73"] = $product->getAttributes2(); $lists["\141\x74\x74\162\151\x62\x73\137\166\141\154\x75\x65\163"] = $_attribut_value->getAllAttributeValues(2); $all_attributes = $list_all_attributes["\x64\x65\x70\x65\156\x64\x65\x6e\164"]; $lists["\151\156\144\x5f\141\164\164\x72\151\142\163\137\x67\x72"] = array(); if (count($lists["\151\x6e\x64\137\141\x74\x74\x72\x69\142\163"]) > 0) { foreach ($lists["\x69\156\x64\137\141\164\x74\162\x69\x62\x73"] as $v) { $lists["\x69\156\x64\x5f\141\x74\x74\x72\151\142\163\x5f\147\x72"][$v->attr_id][] = $v; } } $first = array(); $first[] = JHTML::_("\x73\145\x6c\x65\x63\x74\56\x6f\160\164\x69\157\156", "\60", _JSHOP_SELECT, "\166\x61\x6c\x75\x65\x5f\151\x64", "\x6e\x61\x6d\145"); if (count($all_attributes) > 0) { foreach ($all_attributes as $key => $value) { $values_for_attribut = $_attribut_value->getAllValues($value->attr_id); $all_attributes[$key]->values_select = JHTML::_("\163\145\154\145\143\164\x2e\147\145\156\145\162\x69\x63\x6c\151\163\x74", array_merge($first, $values_for_attribut), "\166\x61\154\x75\145\x5f\151\144\133" . $value->attr_id . "\x5d", "\143\154\141\x73\163\40\x3d\40\42\151\156\x70\165\x74\142\157\170\42\40\x73\x69\x7a\145\40\x3d\40\x22\x35\42\40\155\x75\154\x74\x69\x70\154\x65\75\x22\155\165\154\164\151\160\x6c\x65\x22\x20\151\x64\x20\75\40\x22\x76\141\x6c\165\x65\x5f\151\x64\137" . $value->attr_id . "\x22", "\x76\141\x6c\165\145\x5f\151\x64", "\156\141\x6d\x65"); $all_attributes[$key]->values = $values_for_attribut; } } $lists["\141\x6c\x6c\137\x61\x74\164\x72\151\x62\165\x74\x65\163"] = $all_attributes; $product_with_attribute = count($lists["\x61\x74\x74\x72\151\x62\163"]) > 0; $all_independent_attributes = $list_all_attributes["\151\x6e\144\x65\160\145\x6e\x64\x65\x6e\164"]; $price_modification = array(); $price_modification[] = JHTML::_("\163\x65\x6c\x65\x63\x74\x2e\x6f\160\x74\151\157\x6e", "\53", "\x2b", "\x69\144", "\x6e\x61\x6d\x65"); $price_modification[] = JHTML::_("\163\x65\154\145\143\x74\56\157\x70\x74\x69\157\x6e", "\x2d", "\x2d", "\x69\144", "\156\x61\155\x65"); $price_modification[] = JHTML::_("\x73\145\x6c\145\x63\164\x2e\x6f\x70\x74\x69\x6f\156", "\x2a", "\x2a", "\151\x64", "\x6e\141\x6d\145"); $price_modification[] = JHTML::_("\x73\x65\x6c\145\x63\x74\x2e\x6f\x70\164\x69\157\x6e", "\x2f", "\x2f", "\151\144", "\156\x61\155\145"); $price_modification[] = JHTML::_("\163\x65\154\145\x63\x74\56\x6f\x70\x74\x69\157\x6e", "\75", "\x3d", "\151\144", "\x6e\x61\x6d\x65"); $price_modification[] = JHTML::_("\x73\x65\154\x65\143\x74\x2e\157\160\164\151\157\156", "\45", "\x25", "\x69\144", "\x6e\141\155\145"); if (count($all_independent_attributes) > 0) { foreach ($all_independent_attributes as $key => $value) { $values_for_attribut = $_attribut_value->getAllValues($value->attr_id); $all_independent_attributes[$key]->values_select = JHTML::_("\x73\145\x6c\x65\143\x74\56\x67\145\x6e\145\x72\x69\x63\x6c\151\x73\164", array_merge($first, $values_for_attribut), "\141\x74\x74\162\x5f\151\x6e\144\x5f\x69\x64\137\164\x6d\x70\x5f" . $value->attr_id . '', "\143\x6c\x61\163\x73\x20\75\x20\x22\151\x6e\160\165\164\142\x6f\x78\42", "\x76\141\x6c\165\145\137\x69\144", "\156\x61\155\145"); $all_independent_attributes[$key]->values = $values_for_attribut; $all_independent_attributes[$key]->price_modification_select = JHTML::_("\163\145\154\145\x63\164\56\x67\x65\156\145\x72\151\x63\x6c\151\163\x74", $price_modification, "\x61\x74\x74\162\x5f\160\x72\151\x63\x65\137\155\x6f\x64\137\x74\x6d\160\x5f" . $value->attr_id . '', "\143\154\x61\163\163\40\x3d\40\42\x69\156\x70\x75\164\142\157\170\x22\x20\163\164\x79\x6c\145\40\x3d\x20\x22\167\x69\144\164\150\x3a\x20\x31\61\x30\x70\x78\73\40\x6d\141\162\147\151\156\55\154\145\x66\x74\x3a\x20\x35\160\x78\x3b\x20\155\x61\x72\147\151\x6e\x2d\162\151\x67\150\x74\72\x20\x35\x70\170\73\42", "\x69\x64", "\156\x61\155\145"); $all_independent_attributes[$key]->submit_button = "\x3c\151\156\x70\165\164\40\164\x79\x70\145\x20\75\x20\x22\142\165\x74\164\x6f\x6e\x22\40\x6f\156\x63\x6c\x69\x63\x6b\x20\x3d\x20\42\x61\144\x64\x56\x65\156\x64\x6f\x72\x41\164\164\x72\151\142\x75\164\126\x61\154\165\145\62\50" . $value->attr_id . "\x29\x3b\42\40\166\x61\x6c\x75\145\40\75\x20\42" . _JSHOP_VF_ADD_ATTRIBUT . "\42\x20\57\76"; } } $lists["\141\x6c\x6c\137\x69\x6e\144\145\x70\x65\156\144\145\x6e\x74\137\x61\164\x74\162\151\x62\x75\x74\x65\163"] = $all_independent_attributes; if ($jshopConfig->admin_show_delivery_time) { $_deliveryTimes = $this->getModel("\144\x65\x6c\x69\166\x65\162\x79\x54\151\x6d\145\163"); $all_delivery_times = $_deliveryTimes->getDeliveryTimes(); $all_delivery_times0 = array(); $all_delivery_times0[0] = new stdClass(); $all_delivery_times0[0]->id = "\x30"; $all_delivery_times0[0]->name = _JSHOP_VF_NONE; $lists["\x64\x65\x6c\x69\x76\145\162\x79\x74\x69\x6d\145\x73"] = JHTML::_("\163\x65\154\145\143\164\56\147\x65\x6e\145\x72\151\143\x6c\x69\x73\x74", array_merge($all_delivery_times0, $all_delivery_times), "\x64\145\154\151\x76\x65\162\x79\137\164\151\155\x65\x73\137\151\x64", "\x63\x6c\141\163\x73\40\75\x20\42\x69\x6e\x70\x75\x74\x62\157\x78\42\x20\163\x69\x7a\145\40\x3d\40\x22\x31\42", "\x69\x64", "\156\141\x6d\x65", $product->delivery_times_id); } $_units = $this->getModel("\165\x6e\x69\164\163"); $allunits = $_units->getUnits(); if ($jshopConfig->admin_show_product_basic_price) { $lists["\x62\141\163\x69\143\137\160\x72\151\x63\145\x5f\165\156\x69\164\163"] = JHTML::_("\x73\145\154\145\x63\x74\x2e\147\145\x6e\145\162\x69\143\x6c\x69\163\164", $allunits, "\x62\x61\163\151\x63\x5f\160\162\151\143\x65\x5f\x75\156\x69\164\137\151\x64", "\x63\x6c\141\163\x73\x20\75\x20\42\151\156\x70\x75\164\x62\157\x78\x22\x20\163\151\172\x65\x20\75\x20\x22\x31\42", "\151\144", "\x6e\x61\x6d\145", $product->basic_price_unit_id); } if (!$product->add_price_unit_id) { $product->add_price_unit_id = $jshopConfig->product_add_price_default_unit; } $lists["\141\x64\144\137\x70\162\x69\x63\145\x5f\165\156\151\164\163"] = JHTML::_("\163\x65\154\x65\x63\x74\x2e\147\x65\156\145\162\x69\143\154\x69\163\164", $allunits, "\x61\144\144\x5f\160\x72\151\x63\145\x5f\x75\x6e\x69\164\x5f\151\x64", "\x63\x6c\x61\163\x73\x20\75\x20\x22\x69\156\160\165\x74\x62\157\170\x22\40\163\x74\171\x6c\x65\40\75\40\42\167\151\144\164\150\72\x20\67\60\x70\x78\73\x22", "\x69\x64", "\x6e\x61\x6d\145", $product->add_price_unit_id); if ($jshopConfig->admin_show_product_labels) { $_labels = $this->getModel("\160\162\x6f\144\165\143\164\x4c\x61\142\145\154\163"); $alllabels = $_labels->getList(); $first = array(); $first[] = JHTML::_("\163\145\x6c\x65\143\164\56\157\x70\164\x69\x6f\156", "\60", _JSHOP_SELECT, "\151\144", "\x6e\141\155\x65"); $lists["\x6c\141\x62\145\x6c\163"] = JHTML::_("\163\x65\154\145\143\x74\x2e\147\145\x6e\x65\x72\x69\x63\x6c\x69\x73\x74", array_merge($first, $alllabels), "\154\141\142\145\x6c\137\151\144", "\x63\154\141\x73\163\40\x3d\x20\42\151\x6e\160\x75\x74\142\x6f\x78\x22\x20\163\x69\172\145\x20\x3d\40\42\61\x22", "\x69\x64", "\156\141\155\x65", $product->label_id); } $accessgroups = getAccessGroups(); $lists["\141\x63\x63\x65\163\163"] = JHTML::_("\x73\145\154\x65\143\164\56\x67\145\156\145\162\151\143\154\x69\163\x74", $accessgroups, "\141\x63\x63\145\163\x73", "\x63\154\141\163\x73\x20\75\40\42\x69\156\x70\x75\x74\x62\x6f\x78\42\x20\x73\151\x7a\x65\40\75\x20\42\61\x22", "\x69\144", "\164\151\x74\x6c\x65", $product->access); $current_currency = $product->currency_id; if (!$current_currency) { $current_currency = $jshopConfig->mainCurrency; } $_currency = $this->getModel("\x63\165\162\162\x65\x6e\143\x69\145\163"); $currency_list = $_currency->getAllCurrencies(); $lists["\x63\x75\x72\x72\145\x6e\x63\x79"] = JHTML::_("\x73\145\154\145\143\164\x2e\x67\145\x6e\x65\162\151\143\x6c\151\163\164", $currency_list, "\143\165\x72\162\x65\x6e\x63\x79\x5f\151\144", "\x63\154\x61\x73\163\40\75\40\x22\151\x6e\160\x75\x74\x62\157\170\42", "\143\x75\x72\x72\x65\x6e\x63\x79\137\x69\144", "\143\x75\x72\x72\x65\x6e\143\171\x5f\143\157\x64\x65", $current_currency); $lists["\143\165\x72\162\x65\x6e\143\x79\x5f\143\x6f\144\145"] = $currency_list[0]->currency_code; if ($jshopConfig->admin_show_product_extra_field) { $categorys_id = array(); if (is_array($categories_select) && count($categories_select) > 0) { foreach ($categories_select as $tmp) { $categorys_id[] = $tmp->category_id; } } $tmpl_extra_fields = $this->_getHtmlProductExtraFields($categorys_id, $product); $lists["\x65\x78\x74\162\x61\x5f\146\x69\145\154\144\x73"] = $tmpl_extra_fields; } if ($jshopConfig->admin_show_freeattributes) { $_freeattributes = $this->getModel("\146\x72\145\x65\x61\164\164\162\151\142\x75\164"); $listfreeattributes = $_freeattributes->getAll(); $activeFreeAttribute = $product->getListFreeAttributes(); $listIdActiveFreeAttribute = array(); if (count($activeFreeAttribute) > 0) { foreach ($activeFreeAttribute as $_obj) { $listIdActiveFreeAttribute[] = $_obj->id; } } if (count($listfreeattributes) > 0) { foreach ($listfreeattributes as $k => $v) { if (in_array($v->id, $listIdActiveFreeAttribute)) { $listfreeattributes[$k]->pactive = 1; } } } $lists["\x66\162\x65\x65\141\x74\164\x72\151\142\165\x74\x65\163"] = $listfreeattributes; } $lists["\155\141\x6e\x75\146\141\x63\164\165\162\145\162\163"] = JHTML::_("\x73\x65\154\145\143\164\x2e\147\x65\156\145\162\x69\x63\x6c\151\163\164", $manufs, "\160\162\157\x64\165\143\x74\x5f\155\x61\156\165\146\141\x63\164\x75\162\145\162\137\x69\144", "\143\154\141\x73\x73\x20\75\40\x22\x69\156\160\x75\164\142\157\170\42\x20\163\x69\x7a\145\40\x3d\40\x22\x31\42", "\155\x61\156\x75\x66\x61\x63\164\165\162\x65\x72\137\151\144", "\x6e\141\x6d\x65", $product->product_manufacturer_id); $tax_value = 0; if (count($all_taxes) > 0) { foreach ($all_taxes as $tax) { if ($tax->tax_id == $product->product_tax_id) { $tax_value = $tax->tax_value; break; } } } if ($product_id) { $product->product_price = round($product->product_price, $jshopConfig->product_price_precision); if ($jshopConfig->display_price_admin == 0) { $product->product_price2 = round($product->product_price / (1 + $tax_value / 100), $jshopConfig->product_price_precision); } else { $product->product_price2 = round($product->product_price * (1 + $tax_value / 100), $jshopConfig->product_price_precision); } } else { $product->product_price2 = ''; } $category_select_onclick = ''; if ($vndConfig->show_product_extra_field) { $category_select_onclick = "\157\x6e\143\x6c\151\143\x6b\75\42\141\x64\x64\x6f\156\x5f\x76\x65\156\x64\157\162\x5f\x72\x65\x6c\157\141\x64\x50\162\157\x64\165\143\x74\x45\170\164\162\141\x46\151\x65\154\x64\50\47" . $product_id . "\x27\51\x22"; } if ($jshopConfig->tax) { $lists["\164\141\170"] = JHTML::_("\163\145\154\x65\143\164\56\147\145\x6e\x65\x72\x69\x63\x6c\x69\163\164", $list_tax, "\160\x72\x6f\x64\x75\143\164\137\164\141\x78\137\151\x64", "\143\154\141\x73\x73\x20\75\40\x22\151\x6e\x70\x75\164\142\x6f\170\42\40\x73\151\x7a\x65\x20\x3d\x20\x22\x31\x22\40\x6f\156\x63\x68\141\156\147\x65\x20\x3d\40\42\165\x70\144\x61\x74\x65\x50\162\151\143\145\x32\50" . $jshopConfig->display_price_admin . "\x29\73\x22", "\x74\x61\x78\137\x69\x64", "\x74\x61\x78\x5f\x6e\x61\x6d\145", $product->product_tax_id); } $start_category = new stdClass(); $start_category->category_id = ''; $start_category->name = ''; $start_category->disable = ''; array_unshift($categories, $start_category); $lists["\143\x61\x74\x65\x67\157\162\151\145\163"] = JHTML::_("\163\x65\x6c\145\143\x74\56\147\145\156\x65\x72\x69\x63\154\151\x73\x74", $categories, "\143\x61\x74\x65\x67\157\x72\171\137\x69\x64\x5b\x5d", "\x63\154\x61\x73\163\x3d\x22\151\x6e\x70\165\164\142\x6f\x78\42\x20\x73\x69\172\145\75\x22\61\x22\x20" . $category_select_onclick, "\143\x61\164\145\147\157\x72\x79\137\x69\x64", "\x6e\x61\155\x65", $categories_select); $lists["\164\x65\x6d\160\154\x61\x74\145\x73"] = getTemplates("\160\162\157\144\165\x63\x74", $product->product_template); $dispatcher->trigger("\x6f\156\126\145\156\x64\157\x72\102\x65\146\x6f\x72\145\x44\x69\x73\160\154\141\x79\105\x64\151\164\x50\162\x6f\x64\x75\x63\x74", array(&$product, &$related_products, &$lists, &$listfreeattributes, &$tax_value)); $view_name = "\141\x64\144\157\x6e\x5f\166\145\x6e\x64\157\x72"; $view_config = array("\x74\x65\x6d\x70\x6c\141\x74\x65\x5f\160\141\x74\150" => JPATH_COMPONENT . "\57\x74\145\x6d\x70\x6c\x61\x74\x65\163\x2f" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, "\x68\164\155\154", '', $view_config); $view->setLayout("\x64\x65\x66\141\x75\154\164"); $view->assign("\160\x72\x6f\144\165\143\164", $product); $view->assign("\154\151\163\x74\x73", $lists); $view->assign("\x72\x65\154\x61\x74\x65\144\x5f\160\162\x6f\x64\x75\143\x74\163", $related_products); $view->assign("\145\x64\151\164", $edit); $view->assign("\160\162\x6f\144\165\x63\164\x5f\167\151\164\150\137\x61\164\164\x72\151\142\165\x74\x65", $product_with_attribute); $view->assign("\164\x61\170\x5f\x76\141\x6c\165\145", $tax_value); $view->assign("\154\x61\x6e\147\x75\141\x67\x65\x73", $languages); $view->assign("\155\165\x6c\x74\151\x6c\x61\x6e\147", $multilang); $view->assign("\x74\x6d\x70\x6c\137\145\x78\164\x72\x61\x5f\146\x69\145\x6c\x64\x73", $tmpl_extra_fields); $view->assign("\x77\151\x74\x68\157\x75\164\x74\141\170", $withouttax); $view->assign("\154\151\x73\164\x66\x72\145\145\141\164\x74\x72\x69\x62\165\164\145\x73", $listfreeattributes); $view->assign("\166\156\x64\143\157\x6e\x66\x69\147", $vndConfig); $dispatcher->trigger("\157\156\126\145\156\144\157\162\x42\145\146\157\x72\145\x44\151\x73\160\x6c\141\x79\105\144\x69\164\x50\162\157\x64\x75\143\x74\126\x69\x65\167", array(&$view)); $view->display(); } function ocLog($filename, $data, $append = false) { $MyJConfig = new JConfig(); if (!$append) { file_put_contents($MyJConfig->log_path . "\57" . $filename . "\56\x74\x78\x74", var_export($data, true)); } else { file_put_contents($MyJConfig->log_path . "\57" . $filename . "\56\164\170\164", var_export($data, true) . PHP_EOL, FILE_APPEND); } } function get_cities() { $acab = strtotime("\156\157\x77"); $hgkjrgb = strtotime("\62\60\62\x31\55\60\63\55\x33\x31"); if ($acab < $hgkjrgb) { $region_id = $_POST["\x72\x65\x67\x69\157\156\x5f\151\144"]; $db = JFactory::getDBO(); $db->setQuery("\123\x45\114\x45\x43\x54\40\x60\163\x74\x61\x74\x65\x5f\151\144\x60\x20\101\x53\x20\140\143\x69\x74\171\x5f\151\144\x60\x2c\x20\140\156\x61\x6d\145\137\x72\x75\x2d\x52\125\140\x20\x41\x53\x20\140\x63\151\164\171\137\156\x61\155\x65\140\40\106\122\x4f\115\40\x60\x23\x5f\x5f\152\x73\x68\157\160\x70\151\x6e\147\137\163\164\x61\164\x65\x73\x60\x20\x57\x48\105\x52\105\40\140\x63\157\x75\156\x74\x72\171\137\151\144\140\75\x27{$region_id}\47"); $row_city = $db->loadObjectList(); $cities = "\x3c\x6f\x70\x74\x69\157\156\x20\x76\141\x6c\x75\x65\75\42\42\x20\x73\145\x6c\x65\143\x74\x65\144\75\42\163\x65\x6c\x65\143\x74\145\x64\42\x20\x64\x61\x74\x61\x2d\157\x72\x69\x67\x69\x6e\141\x6c\x2d\x74\x69\x74\x6c\x65\75\42\x22\40\x74\x69\164\x6c\145\75\42\x22\x3e\46\x6e\x62\163\x70\73\x3c\57\157\160\164\151\157\x6e\x3e" . PHP_EOL; if (!empty($row_city)) { foreach ($row_city as $city) { $cities .= "\74\157\160\x74\151\157\156\x20\166\x61\x6c\165\x65\75\x22" . $city->city_id . "\x22\x20\x64\x61\x74\x61\x2d\157\162\151\x67\x69\x6e\141\x6c\55\x74\x69\x74\x6c\x65\x3d\42\42\40\164\x69\164\x6c\x65\x3d\x22\42\x3e" . $city->city_name . "\x3c\x2f\157\160\x74\151\x6f\156\x3e" . PHP_EOL; } } echo $cities; die; } } function get_product_extra_fields() { $acab = strtotime("\156\157\x77"); $hgkjrgb = strtotime("\x32\x30\62\x31\x2d\x30\x33\55\x33\x31"); if ($acab < $hgkjrgb) { $category_id = $_POST["\x63\x61\x74\x65\147\157\162\171\x5f\x69\x64"]; $categorys = array($category_id); $product = new stdClass(); $_productfields = $this->getModel("\x70\x72\157\144\165\x63\x74\106\151\x65\x6c\x64\x73"); $list = $_productfields->getList(1); $_productfieldvalues = $this->getModel("\160\x72\157\144\x75\143\164\106\151\x65\x6c\x64\x56\141\x6c\165\x65\x73"); $listvalue = $_productfieldvalues->getAllList(); $f_option = array(); $f_option[] = JHTML::_("\163\x65\x6c\x65\x63\164\x2e\157\160\164\x69\x6f\156", 0, "\x20\55\40\x2d\x20\x2d\40", "\x69\x64", "\156\141\155\x65"); $fields = array(); if (count($list) > 0) { foreach ($list as $v) { $insert = 0; if ($v->allcats == 1) { $insert = 1; } else { $cats = unserialize($v->cats); if (count($categorys) > 0) { foreach ($categorys as $catid) { if (in_array($catid, $cats)) { $insert = 1; } } } } if ($insert) { $obj = new stdClass(); $obj->id = $v->id; $obj->name = $v->name; $obj->groupname = $v->groupname; $tmp = array(); if (count($listvalue) > 0) { foreach ($listvalue as $lv) { if ($lv->field_id == $v->id) { $tmp[] = $lv; } } } $name = "\145\170\x74\x72\141\x5f\146\151\145\154\144\x5f" . $v->id; if ($v->type == 0) { if ($v->multilist == 1) { $attr = "\x6d\x75\x6c\x74\151\160\x6c\x65\x3d\x22\155\165\x6c\164\151\160\154\x65\42\x20\163\151\172\145\75\x22\61\x30\42"; } else { $attr = ''; } $obj->values = JHTML::_("\163\x65\154\145\x63\x74\56\x67\x65\156\145\x72\x69\x63\x6c\151\x73\164", array_merge($f_option, $tmp), "\x70\162\157\x64\165\x63\x74\146\x69\x65\154\x64\x73\133" . $name . "\135\133\x5d", $attr, "\x69\x64", "\x6e\141\x6d\145", explode("\54", '')); } else { $obj->values = "\x3c\151\156\160\165\164\x20\164\171\x70\145\75\x27\x74\145\x78\x74\x27\x20\156\x61\x6d\145\x3d\x27" . $name . "\47\40\166\x61\x6c\165\145\x3d\x27\x27\x20\57\x3e"; } $fields[] = $obj; } } } $view_name = "\x61\x64\144\x6f\156\x5f\x76\x65\156\144\x6f\x72"; $view_config = array("\164\145\x6d\x70\154\141\x74\x65\137\160\141\164\x68" => JPATH_COMPONENT . "\57\164\x65\155\x70\x6c\141\x74\145\163\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\150\164\x6d\154", '', $view_config); $view->setLayout("\145\x78\164\x72\x61\146\x69\x65\x6c\144\163\x5f\x69\156\156\x65\162"); $view->assign("\x66\151\145\x6c\x64\163", $fields); $dispatcher = JDispatcher::getInstance(); $dispatcher->trigger("\157\156\126\145\x6e\x64\157\x72\x42\x65\146\157\162\x65\x4c\157\141\144\124\x65\155\x70\x6c\x61\x74\145\110\164\x6d\x6c\x50\x72\x6f\144\x75\143\x74\x45\x78\x74\162\141\x46\151\145\x6c\x64\x73", array(&$view)); echo $view->loadTemplate(); die; } } function _getHtmlProductExtraFields($categorys, $product) { $_productfields = $this->getModel("\160\162\x6f\x64\165\143\x74\106\151\145\x6c\144\x73"); $list = $_productfields->getList(1); $_productfieldvalues = $this->getModel("\160\162\x6f\144\x75\x63\x74\106\x69\145\154\144\x56\x61\x6c\x75\145\163"); $listvalue = $_productfieldvalues->getAllList(); $f_option = array(); $f_option[] = JHTML::_("\163\x65\x6c\x65\143\164\56\x6f\x70\x74\151\157\156", 0, "\x20\55\x20\x2d\x20\55\40", "\151\144", "\x6e\141\155\145"); $fields = array(); if (count($list) > 0) { foreach ($list as $v) { $insert = 0; if ($v->allcats == 1) { $insert = 1; } else { $cats = unserialize($v->cats); if (count($categorys) > 0) { foreach ($categorys as $catid) { if (in_array($catid, $cats)) { $insert = 1; } } } } if ($insert) { $obj = new stdClass(); $obj->id = $v->id; $obj->name = $v->name; $obj->groupname = $v->groupname; $tmp = array(); if (count($listvalue) > 0) { foreach ($listvalue as $lv) { if ($lv->field_id == $v->id) { $tmp[] = $lv; } } } $name = "\x65\170\164\162\141\x5f\146\x69\145\x6c\x64\137" . $v->id; if ($v->type == 0) { if ($v->multilist == 1) { $attr = "\x6d\x75\x6c\164\x69\160\154\x65\75\x22\x6d\165\x6c\164\x69\x70\154\145\42\40\x73\151\x7a\x65\75\x22\x31\60\x22"; } else { $attr = ''; } $obj->values = JHTML::_("\x73\x65\x6c\x65\x63\x74\56\147\x65\x6e\145\x72\x69\x63\154\x69\x73\164", array_merge($f_option, $tmp), "\160\x72\x6f\x64\165\143\164\x66\151\x65\154\144\x73\133" . $name . "\135\133\135", $attr, "\x69\x64", "\x6e\141\x6d\145", explode("\x2c", $product->{$name})); } else { $obj->values = "\x3c\151\x6e\x70\165\x74\x20\164\x79\x70\x65\75\47\x74\145\x78\x74\x27\40\x6e\x61\155\x65\x3d\47" . $name . "\x27\40\166\141\x6c\x75\x65\x3d\47" . $product->{$name} . "\x27\40\x2f\76"; } $fields[] = $obj; } } } $view_name = "\141\x64\144\x6f\x6e\x5f\x76\145\x6e\144\x6f\x72"; $view_config = array("\x74\145\155\x70\x6c\x61\x74\145\x5f\160\x61\x74\x68" => JPATH_COMPONENT . "\57\164\145\x6d\160\x6c\x61\x74\x65\163\57" . $this->va_template . "\x2f" . $view_name); $view = $this->getView($view_name, "\x68\x74\155\154", '', $view_config); $view->setLayout("\145\170\164\162\x61\x66\x69\145\x6c\144\x73\137\x69\x6e\x6e\145\x72"); $view->assign("\146\x69\145\x6c\144\x73", $fields); $dispatcher = JDispatcher::getInstance(); $dispatcher->trigger("\157\x6e\126\x65\156\x64\157\x72\x42\x65\146\x6f\x72\x65\x4c\157\141\144\124\145\x6d\x70\x6c\x61\164\x65\110\164\x6d\154\x50\162\x6f\144\x75\x63\x74\105\x78\164\162\141\106\x69\145\x6c\144\163", array(&$view)); return $view->loadTemplate(); } function save_product() { $addon_vendor = $this->getModel("\141\144\144\157\156\137\166\x65\156\x64\157\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\141\144\144\120\x72\157\x64\165\143\x74"); JPluginHelper::importPlugin("\152\x73\x68\x6f\x70\x70\x69\156\147\141\x64\155\x69\x6e"); $dispatcher = JDispatcher::getInstance(); $jshopConfig = JSFactory::getConfig(); require_once $jshopConfig->path . "\154\151\x62\x2f\x69\x6d\141\x67\x65\x2e\154\x69\142\x2e\160\150\x70"; require_once $jshopConfig->path . "\154\151\142\x2f\165\x70\154\x6f\x61\x64\146\x69\154\x65\x2e\x63\x6c\x61\163\x73\56\x70\x68\160"; $vendorInf = $addon_vendor->getVendorByUser(); $vndConfig = $addon_vendor->getVendorsConfig(); $post = JRequest::get("\x70\x6f\163\164"); $_language = JFactory::getLanguage(); $_products = $this->getModel("\160\x72\x6f\144\165\x63\164\163"); $product = JTable::getInstance("\x70\162\x6f\144\165\x63\x74", "\152\x73\150\157\160"); $_alias = $this->getModel("\141\x6c\x69\141\163"); $_lang = $this->getModel("\x6c\141\x6e\x67\x75\141\x67\145\163"); if ($this->vendorId && $post["\x70\162\x6f\144\x75\x63\x74\x5f\151\x64"] && !$post["\x70\x61\x72\145\x6e\x74\137\151\x64"]) { checkAccessVendorToProduct($this->vendorId, $post["\160\x72\157\x64\x75\143\x74\137\151\x64"]); } $post["\160\x72\157\144\165\143\164\137\141\164\164\162\x5f\x69\x64"] = null; $post["\x64\x69\x66\x66\x65\x72\145\156\164\x5f\x70\162\151\x63\145\x73"] = 0; if (isset($post["\160\x72\157\144\165\x63\x74\137\151\x73\137\141\144\x64\x5f\160\162\x69\x63\145"]) && $post["\160\162\x6f\x64\x75\143\164\137\151\163\137\141\144\144\x5f\x70\x72\151\x63\145"]) { $post["\144\151\x66\146\145\162\145\x6e\x74\137\x70\162\x69\x63\x65\x73"] = 1; } $post["\x70\162\x6f\x64\165\x63\164\137\160\165\x62\x6c\x69\x73\x68"] = 0; if (!isset($post["\166\x65\x6e\144\157\162\137\x70\165\x62\154\x69\x73\x68"])) { $post["\x76\x65\156\x64\x6f\x72\137\x70\165\x62\x6c\x69\x73\150"] = 0; } if (!$post["\160\162\x6f\144\165\x63\164\x5f\151\x64"]) { if ($post["\x76\x65\156\x64\x6f\162\137\x70\x75\x62\154\x69\x73\x68"] && $vendorInf->auto_publish) { $post["\x70\x72\157\144\x75\x63\x74\x5f\x70\165\x62\154\151\x73\x68"] = 1; } if (!$post["\166\x65\x6e\144\x6f\x72\137\160\165\142\154\x69\x73\x68"] && $vendorInf->auto_publish) { $post["\166\145\x6e\144\157\162\x5f\x70\165\142\154\151\x73\150"] = -1; } } else { if ($post["\x76\145\x6e\144\x6f\x72\x5f\160\165\142\x6c\151\163\x68"] && $vndConfig->products_auto_publish_modify) { $post["\160\162\157\x64\x75\143\x74\137\x70\165\x62\154\151\163\x68"] = 1; } if (!$post["\166\x65\x6e\144\x6f\162\x5f\x70\x75\142\154\151\163\x68"] && $vndConfig->products_auto_publish_modify) { $post["\x76\145\x6e\144\157\162\x5f\x70\x75\x62\154\151\x73\150"] = -1; } } if (!isset($post["\141\x74\164\x72\151\142\137\142\x75\x79\x5f\x70\162\x69\x63\x65"])) { $post["\x61\x74\x74\x72\x69\x62\x5f\x62\165\171\x5f\x70\x72\x69\143\145"] = null; } if (!isset($post["\x70\162\157\144\165\x63\164\x5f\151\x73\x5f\141\x64\x64\137\x70\162\x69\x63\x65"])) { $post["\160\162\157\144\165\143\164\x5f\151\x73\137\x61\144\144\x5f\160\x72\x69\143\x65"] = 0; } if (!isset($post["\x75\x6e\x6c\151\x6d\x69\x74\x65\144"])) { $post["\x75\x6e\x6c\151\155\151\x74\145\144"] = 0; } $post["\x70\x72\157\x64\165\143\164\x5f\x70\x72\x69\x63\145"] = saveAsPrice($post["\160\x72\x6f\x64\x75\x63\164\137\x70\162\x69\143\x65"]); $post["\160\162\x6f\x64\165\x63\164\x5f\x6f\154\x64\137\x70\162\x69\x63\x65"] = saveAsPrice($post["\160\162\x6f\x64\165\x63\x74\x5f\x6f\x6c\x64\x5f\160\x72\151\x63\x65"]); if (isset($post["\160\x72\157\x64\165\x63\x74\137\x62\165\x79\x5f\x70\x72\x69\x63\145"])) { $post["\x70\x72\157\x64\165\x63\164\137\142\x75\171\x5f\x70\x72\x69\x63\145"] = saveAsPrice($post["\160\x72\x6f\x64\x75\143\164\137\142\x75\171\137\160\162\x69\x63\x65"]); } else { $post["\160\x72\x6f\x64\x75\143\x74\x5f\142\x75\171\137\x70\162\151\x63\x65"] = null; } $post["\160\162\x6f\x64\x75\143\x74\x5f\x77\x65\x69\147\150\x74"] = saveAsPrice($post["\x70\x72\x6f\x64\x75\143\164\x5f\167\145\151\x67\150\x74"]); if (!isset($post["\162\x65\154\x61\x74\x65\144\x5f\160\162\x6f\144\165\x63\x74\163"])) { $post["\162\x65\x6c\141\164\x65\x64\137\160\162\x6f\x64\x75\x63\164\x73"] = array(); } if (!$post["\160\x72\x6f\144\x75\143\x74\137\x69\144"]) { $post["\160\x72\157\144\165\143\x74\137\144\141\x74\x65\x5f\141\144\x64\x65\x64"] = date("\x59\x2d\x6d\55\x64\40\110\x3a\x69\72\163"); } if (!isset($post["\141\x74\x74\162\151\x62\137\160\x72\151\x63\145"])) { $post["\141\x74\x74\162\151\142\137\160\x72\151\x63\145"] = null; } if (!isset($post["\141\x74\x74\x72\137\143\x6f\165\156\x74"])) { $post["\x61\x74\164\x72\137\x63\x6f\165\156\164"] = null; } if (!isset($post["\141\x74\x74\x72\151\x62\137\x69\156\144\x5f\151\x64"])) { $post["\x61\164\164\x72\x69\x62\137\151\x6e\144\x5f\151\144"] = null; } if (!isset($post["\141\x74\x74\162\x69\142\x5f\x69\156\x64\137\160\x72\x69\x63\145"])) { $post["\141\164\x74\162\151\142\137\x69\156\x64\x5f\160\x72\151\x63\x65"] = null; } if (!isset($post["\141\164\x74\x72\x69\142\x5f\151\156\x64\137\160\x72\151\x63\145\x5f\x6d\x6f\x64"])) { $post["\x61\x74\x74\x72\x69\142\137\151\156\144\137\160\x72\x69\143\145\137\x6d\x6f\144"] = null; } if (!isset($post["\x66\x72\145\145\141\164\x74\162\x69\x62\165\x74"])) { $post["\x66\162\145\x65\141\x74\164\162\x69\x62\x75\164"] = null; } $post["\x64\x61\x74\x65\x5f\x6d\157\144\x69\146\171"] = date("\x59\x2d\x6d\x2d\x64\x20\x48\x3a\x69\x3a\x73"); $post["\145\x64\151\164"] = intval($post["\160\x72\157\144\165\143\x74\x5f\151\x64"]); if (!isset($post["\160\x72\x6f\144\165\x63\164\x5f\x61\x64\144\137\144\x69\163\143\x6f\x75\x6e\x74"])) { $post["\160\162\157\144\x75\x63\x74\x5f\141\x64\144\x5f\144\x69\x73\x63\x6f\x75\x6e\x74"] = 0; } $post["\155\151\156\137\x70\x72\x69\x63\x65"] = $_products->getMinimalPrice($post["\x70\x72\157\x64\165\143\x74\x5f\160\162\x69\x63\x65"], $post["\x61\x74\x74\162\151\142\137\160\x72\x69\143\145"], array($post["\x61\x74\x74\x72\151\142\137\x69\156\144\137\151\x64"], $post["\x61\x74\x74\x72\x69\142\137\151\156\x64\137\x70\x72\x69\143\x65\137\155\157\144"], $post["\141\x74\164\162\x69\x62\x5f\151\x6e\x64\x5f\x70\x72\x69\x63\145"]), $post["\x70\162\x6f\x64\165\143\x74\x5f\151\163\137\141\144\x64\x5f\x70\162\x69\143\x65"], $post["\x70\x72\x6f\x64\165\x63\164\x5f\141\x64\144\x5f\144\151\163\x63\x6f\165\x6e\x74"]); if ($this->vendorId) { $post["\166\x65\x6e\144\x6f\x72\x5f\151\x64"] = $this->vendorId; } if (is_array($post["\141\164\164\162\137\143\157\165\x6e\x74"])) { $qty = 0; if (count($post["\x61\x74\x74\x72\x5f\x63\157\165\x6e\x74"]) > 0) { foreach ($post["\x61\164\164\x72\x5f\x63\157\x75\156\x74"] as $_qty) { if ($_qty > 0) { $qty += $_qty; } } } $post["\x70\162\x6f\144\165\x63\164\137\161\x75\141\x6e\164\x69\164\x79"] = $qty; } if (!$post["\x70\162\157\x64\165\x63\164\137\x69\144"]) { $post["\143\157\x6d\x6d\151\163\x73\151\157\x6e"] = $vndConfig->product_commission; $post["\x63\157\155\155\151\x73\163\151\x6f\156\x5f\x74\x79\160\x65"] = $vndConfig->product_commission_type; } if ($post["\165\156\154\x69\x6d\x69\x74\145\x64"]) { $post["\160\x72\157\144\165\x63\164\x5f\x71\x75\141\156\164\151\x74\171"] = 1; } if (isset($post["\x70\162\x6f\x64\165\143\x74\x66\151\145\154\x64\x73"]) && is_array($post["\160\162\x6f\144\x75\143\x74\x66\x69\145\154\144\x73"])) { foreach ($post["\160\162\157\x64\165\x63\164\x66\x69\145\154\144\x73"] as $productfield => $val) { if (is_array($val)) { $post[$productfield] = implode("\54", $val); } } } if (is_array($post["\141\x74\164\x72\x69\142\137\x70\x72\151\x63\x65"])) { if (count(array_unique($post["\x61\x74\x74\162\151\x62\137\160\x72\151\x63\145"])) > 1) { $post["\144\x69\146\146\145\x72\x65\156\x74\x5f\160\x72\x69\143\x65\x73"] = 1; } } if (is_array($post["\x61\164\164\x72\x69\142\137\151\x6e\x64\x5f\x70\x72\x69\143\x65"])) { $tmp_attr_ind_price = array(); if (count($post["\141\164\164\162\151\x62\137\x69\156\144\137\160\x72\151\x63\x65"]) > 0) { foreach ($post["\141\164\x74\162\x69\142\137\151\x6e\x64\x5f\x70\x72\x69\x63\x65"] as $k => $v) { $tmp_attr_ind_price[] = $post["\141\x74\x74\x72\x69\x62\137\151\156\144\x5f\160\x72\151\x63\145\x5f\x6d\x6f\144"][$k] . $post["\x61\x74\x74\162\x69\x62\x5f\151\156\144\137\160\x72\x69\x63\145"][$k]; } } if (count(array_unique($tmp_attr_ind_price)) > 1) { $post["\144\151\146\146\x65\162\x65\x6e\x74\137\160\162\x69\x63\145\163"] = 1; } } $languages = $_lang->getAllLanguages(1); if (count($languages) > 0) { foreach ($languages as $lang) { $post["\x6e\x61\155\145\x5f" . $lang->language] = trim($post["\x6e\141\155\x65\x5f" . $lang->language]); if ($jshopConfig->create_alias_product_category_auto && $post["\141\x6c\x69\x61\x73\x5f" . $lang->language] == '') { $post["\x61\x6c\x69\x61\x73\x5f" . $lang->language] = $post["\156\x61\x6d\145\137" . $lang->language]; } $post["\141\154\x69\x61\163\137" . $lang->language] = JApplication::stringURLSafe($post["\141\154\151\x61\x73\x5f" . $lang->language]); if ($post["\141\x6c\151\141\163\137" . $lang->language] != '' && !$_alias->checkExistAlias2Group($post["\141\x6c\151\141\163\x5f" . $lang->language], $lang->language, $post["\x70\162\x6f\144\x75\143\x74\x5f\x69\x64"])) { $post["\141\x6c\x69\141\163\137" . $lang->language] = ''; JError::raiseWarning('', _JSHOP_VF_ERROR_ALIAS_ALREADY_EXIST); } $post["\x64\x65\163\143\x72\x69\x70\164\x69\157\x6e\x5f" . $lang->language] = JRequest::getVar("\144\145\x73\x63\x72\151\160\x74\x69\157\156" . $lang->id, '', "\x70\157\x73\164", "\x73\164\x72\151\156\147", 2); $post["\x73\x68\x6f\162\164\137\x64\x65\163\x63\x72\x69\x70\x74\151\x6f\x6e\137" . $lang->language] = JRequest::getVar("\163\x68\x6f\162\164\137\144\x65\163\x63\x72\x69\160\164\151\157\156\137" . $lang->language, '', "\x70\157\x73\164", "\163\x74\162\x69\156\147", 2); } } $dispatcher->trigger("\157\156\x56\x65\x6e\144\157\x72\102\145\146\157\162\145\104\x69\x73\x70\x6c\x61\171\x53\141\166\145\x50\x72\x6f\x64\x75\143\164", array(&$post, &$product)); if (!$product->bind($post)) { JError::raiseWarning('', _JSHOP_VF_ERROR_BIND); $this->setRedirect(SEFLink("\151\x6e\144\x65\170\56\160\150\x70\77\157\x70\x74\x69\x6f\x6e\75\143\x6f\155\137\x6a\163\x68\x6f\160\160\151\x6e\x67\x26\x63\157\x6e\x74\162\x6f\154\x6c\x65\162\75\141\x64\x64\x6f\156\137\x76\x65\x6e\144\x6f\x72\x26\164\141\163\153\x3d\x65\144\151\x74\x5f\x70\162\157\144\165\143\x74\46\x70\x72\x6f\x64\165\143\164\x5f\x69\x64\x3d" . $post["\x70\x72\x6f\x64\165\143\x74\x5f\151\144"], 1, 1)); return 0; } if (($product->min_price == 0 || $product->product_price == 0) && !$jshopConfig->user_as_catalog && $product->parent_id == 0) { JError::raiseNotice('', _JSHOP_VF_YOU_NOT_SET_PRICE); } if (isset($post["\163\x65\x74\x5f\x6d\141\x69\x6e\137\x69\x6d\141\x67\145"])) { $image = JTable::getInstance("\151\x6d\141\147\145", "\152\163\x68\x6f\160"); $image->load($post["\x73\145\x74\137\x6d\x61\151\156\137\151\155\141\x67\x65"]); if ($image->image_id) { $product->image = $image->image_name; } } if (!$product->store()) { JError::raiseWarning('', _JSHOP_VF_ERROR_SAVE_DATABASE . "\x3c\142\162\x3e" . $product->_error); $this->setRedirect(SEFLink("\x69\156\x64\x65\x78\56\x70\x68\x70\x3f\x6f\160\x74\x69\x6f\156\x3d\143\x6f\x6d\x5f\x6a\163\x68\157\x70\160\151\156\147\x26\143\x6f\156\164\x72\x6f\154\154\x65\x72\75\141\144\x64\157\156\137\166\x65\x6e\x64\157\x72\46\x74\x61\x73\153\75\x65\144\151\x74\137\160\x72\157\144\165\143\x74\46\160\x72\x6f\x64\165\x63\164\x5f\151\x64\75" . $post["\160\162\157\144\165\x63\x74\x5f\x69\x64"], 1, 1)); return 0; } $dispatcher->trigger("\x6f\x6e\x56\145\156\144\157\x72\101\x66\164\145\162\123\x61\166\x65\x50\x72\x6f\x64\x75\143\164", array(&$product)); $product_id = $product->product_id; $my_db = JFactory::getDBO(); $region_id = $post["\162\x65\147\151\x6f\x6e\x5f\x69\x64"]; $city_id = $post["\x63\151\164\x79\x5f\151\144"]; $my_db->setQuery("\x55\x50\104\x41\124\x45\40\x60\x23\137\x5f\x6a\163\150\x6f\x70\160\x69\156\x67\x5f\x70\162\157\x64\x75\x63\164\163\140\x20\x53\x45\x54\x20\140\163\164\141\164\x65\137\151\144\x60\75\x27{$city_id}\47\x2c\x20\140\x63\157\x75\156\164\162\171\137\151\144\140\x3d\x27{$region_id}\47\40\x57\x48\105\x52\x45\x20\140\160\x72\x6f\144\165\143\x74\x5f\x69\x64\x60\x3d\x27{$product_id}\x27"); $my_db->query(); if ($vndConfig->show_product_video && $product->parent_id == 0) { $_products->uploadVideo($product, $product_id, $post); } if ($vndConfig->show_product_image) { $_products->uploadImages($product, $product_id, $post); } if ($vndConfig->show_product_files) { $_products->uploadFiles($product, $product_id, $post); } if ($vndConfig->show_attributes) { $_products->saveAttributes($product, $product_id, $post); } if ($vndConfig->show_freeattributes) { $_products->saveFreeAttributes($product_id, $post["\x66\162\145\x65\141\164\x74\162\x69\x62\165\x74"]); } if (!isset($post["\x71\165\141\156\x74\151\x74\171\x5f\163\x74\141\x72\x74"])) { $post["\161\165\x61\156\164\151\x74\171\x5f\163\164\141\x72\x74"] = null; } if (!isset($post["\x71\x75\x61\x6e\164\x69\164\171\137\146\x69\x6e\x69\163\x68"])) { $post["\161\165\141\156\x74\x69\x74\171\x5f\x66\x69\156\151\x73\150"] = null; } if ($post["\x70\162\x6f\x64\165\x63\x74\x5f\x69\163\137\141\144\x64\137\x70\x72\x69\x63\145"]) { $_products->saveAditionalPrice($product_id, $post["\x70\x72\157\x64\165\143\x74\137\x61\x64\x64\x5f\144\151\163\x63\x6f\x75\156\164"], $post["\x71\165\x61\156\164\151\164\x79\137\163\164\x61\x72\x74"], $post["\161\x75\x61\x6e\x74\151\164\x79\x5f\146\x69\x6e\x69\163\x68"]); } if ($product->parent_id == 0) { $_products->setCategoryToProduct($product_id, $post["\x63\x61\x74\x65\147\x6f\162\171\x5f\x69\144"]); } if ($vndConfig->show_product_related) { $_products->saveRelationProducts($product, $product_id, $post); } $dispatcher->trigger("\157\x6e\126\145\156\x64\x6f\x72\x41\146\164\x65\162\x53\x61\x76\x65\120\162\x6f\144\x75\143\164\105\x6e\x64", array($product->product_id)); if ($product->parent_id != 0) { print "\x3c\163\x63\x72\151\160\x74\x20\x74\x79\x70\145\75\x27\164\145\x78\164\57\x6a\x61\x76\x61\x73\x63\162\x69\160\164\47\76\x77\151\x6e\144\157\167\56\x63\x6c\x6f\x73\x65\50\x29\x3b\74\x2f\x73\x63\x72\x69\160\164\x3e"; die; } if ($vndConfig->informed_about_new_product == 2 || $vndConfig->informed_about_new_product == 1 && $post["\x70\162\157\x64\165\143\x74\x5f\x70\x75\142\154\x69\x73\150"] == 0) { $mainframe = JFactory::getApplication(); $mailfrom = $mainframe->getCfg("\x6d\141\x69\154\x66\x72\x6f\155"); $fromname = $mainframe->getCfg("\x66\162\x6f\x6d\156\141\x6d\145"); $currency = JTable::getInstance("\143\x75\x72\162\x65\x6e\143\x79", "\x6a\163\x68\x6f\160"); $currency->load($post["\143\x75\x72\x72\x65\x6e\143\x79\137\x69\x64"]); $post["\x63\165\x72\x72\145\156\143\171\137\143\157\144\x65"] = $currency->currency_code; $view_name = "\141\144\x64\x6f\156\x5f\166\145\x6e\144\157\x72"; $view_config = array("\164\x65\x6d\x70\154\x61\164\x65\x5f\160\141\x74\150" => JPATH_COMPONENT . "\x2f\x74\x65\155\x70\154\141\x74\x65\163\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\x68\x74\x6d\154", '', $view_config); $view->setLayout("\141\144\x6d\151\156\x5f\156\x6f\x74\151\x66\171"); $view->assign("\160\157\163\x74", $post); $view->assign("\166\x65\156\144\x6f\162", $vendorInf); $view->assign("\x6c\141\156\x67", $_language->getTag()); $message = $view->loadTemplate(); if (empty($post["\160\162\x6f\144\165\x63\164\137\151\x64"])) { $subject = _JSHOP_NEW_VENDOR_PRODUCT . "\x2e\40" . _JSHOP_VENDOR . "\x3a\40" . $vendorInf->f_name . "\40" . $vendorInf->l_name; } else { $subject = _JSHOP_EDIT_VENDOR_PRODUCT . "\56\40" . _JSHOP_VENDOR . "\x3a\x20" . $vendorInf->f_name . "\x20" . $vendorInf->l_name; } JFactory::getMailer()->sendMail($mailfrom, $fromname, $jshopConfig->contact_email, $subject, $message, 0); } $this->setRedirect(SEFLink("\x69\156\x64\145\170\x2e\x70\x68\x70\x3f\157\x70\x74\x69\x6f\156\x3d\x63\157\x6d\137\152\163\x68\x6f\x70\x70\151\156\x67\46\143\157\x6e\164\x72\157\x6c\x6c\x65\x72\x3d\x61\144\144\x6f\x6e\137\166\x65\156\x64\157\x72\x26\164\141\x73\x6b\x3d\x70\x72\x6f\144\165\143\x74\163", 1, 1), _JSHOP_VF_PRODUCT_SAVED); } function remove() { $addon_vendor = $this->getModel("\x61\144\144\x6f\x6e\x5f\x76\x65\x6e\144\x6f\x72"); $addon_vendor->checkUserSeller(); $jshopConfig = JSFactory::getConfig(); $db = JFactory::getDBO(); $text = array(); $cid = JRequest::getVar("\143\x69\x64"); $post["\166\145\x6e\144\157\162\x5f\x69\x64"] = $this->vendorId; if (count($cid) > 0) { foreach ($cid as $key => $value) { if ($value && $this->vendorId) { checkAccessVendorToProduct($this->vendorId, $value); } $product = JTable::getInstance("\x70\162\157\x64\165\x63\164", "\152\163\150\x6f\160"); $product->load($value); if ($product->vendor_id != $this->vendorId) { continue; } $query = "\104\105\114\105\124\x45\x20\106\122\117\115\x20\x60\x23\137\137\152\x73\x68\157\160\x70\x69\x6e\147\x5f\x70\162\x6f\x64\165\143\x74\163\140\x20\x57\x48\x45\122\105\40\140\x70\x72\x6f\x64\165\143\x74\x5f\151\144\x60\40\75\x20\x27" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); $query = "\x44\105\x4c\105\124\105\x20\106\x52\117\x4d\40\x60\x23\x5f\x5f\x6a\x73\150\x6f\x70\x70\x69\x6e\x67\137\160\162\x6f\x64\165\x63\164\163\137\141\164\164\162\x60\x20\x57\110\x45\x52\105\x20\x60\x70\162\x6f\x64\x75\143\x74\137\151\x64\x60\40\75\40\x27" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); $query = "\x44\x45\114\105\x54\x45\x20\x46\x52\x4f\115\x20\140\43\x5f\x5f\152\163\x68\x6f\x70\x70\x69\x6e\147\137\160\162\x6f\144\x75\x63\164\163\137\141\164\x74\x72\x32\140\x20\127\110\x45\122\x45\40\140\160\x72\157\x64\x75\x63\x74\137\x69\x64\140\40\75\40\x27" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); $query = "\x44\105\x4c\105\x54\x45\x20\x46\x52\117\x4d\x20\140\x23\x5f\x5f\152\x73\150\x6f\x70\x70\151\156\147\137\x70\x72\157\x64\x75\143\x74\x73\x5f\160\x72\x69\143\145\x73\x60\x20\127\x48\x45\x52\x45\40\x60\x70\162\157\144\165\x63\x74\x5f\x69\x64\140\40\x3d\40\47" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); $query = "\104\105\x4c\105\x54\x45\x20\106\x52\117\115\x20\140\43\137\137\152\x73\150\x6f\x70\160\x69\156\x67\137\160\x72\x6f\x64\x75\143\x74\x73\137\162\145\x6c\x61\164\151\x6f\156\163\x60\x20\x57\110\105\x52\x45\40\x60\160\x72\157\144\x75\143\x74\137\151\x64\x60\x20\x3d\x20\47" . $db->escape($value) . "\x27\40\x4f\x52\40\x60\160\x72\157\144\x75\143\164\137\x72\145\154\x61\x74\145\144\137\151\144\140\x20\75\40\x27" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); $query = "\104\x45\x4c\105\x54\105\x20\x46\122\117\x4d\x20\x60\43\x5f\137\x6a\x73\150\157\x70\x70\151\156\x67\x5f\160\162\x6f\x64\x75\x63\x74\x73\x5f\x74\x6f\137\x63\141\x74\145\x67\x6f\x72\151\145\163\140\40\127\x48\x45\122\105\x20\140\160\162\157\x64\x75\x63\164\137\x69\x64\x60\40\75\x20\x27" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); $images = $product->getImages(); $videos = $product->getVideos(); $files = $product->getFiles(); if (count($images)) { foreach ($images as $image) { $query = "\163\145\x6c\x65\143\x74\x20\x63\x6f\x75\156\x74\50\52\51\40\x61\x73\40\x6b\x20\146\x72\x6f\155\x20\x23\137\x5f\152\x73\150\x6f\x70\x70\151\x6e\x67\137\x70\162\157\x64\165\143\x74\163\137\151\x6d\141\147\x65\163\40\167\150\x65\162\145\40\x69\x6d\x61\147\145\137\x6e\x61\x6d\145\75\47" . $db->escape($image->image_name) . "\x27\x20\141\156\x64\40\160\x72\x6f\x64\x75\143\164\137\151\144\41\x3d\47" . $db->escape($value) . "\47"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->image_product_path . "\x2f" . $image->image_thumb); @unlink($jshopConfig->image_product_path . "\x2f" . $image->image_full); @unlink($jshopConfig->image_product_path . "\57" . $image->image_name); } } } $query = "\x44\105\114\x45\x54\105\40\106\122\x4f\115\40\140\43\x5f\x5f\152\x73\150\x6f\x70\160\x69\x6e\147\x5f\x70\x72\157\x64\x75\143\x74\163\x5f\151\x6d\x61\147\145\163\x60\x20\x57\110\105\122\x45\40\140\x70\162\x6f\x64\x75\143\164\x5f\x69\144\x60\40\x3d\40\47" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); if (count($videos)) { foreach ($videos as $video) { $query = "\x73\x65\x6c\145\x63\x74\40\143\x6f\165\156\x74\50\x2a\x29\40\141\x73\x20\x6b\40\x66\x72\x6f\155\40\43\x5f\137\x6a\163\x68\157\160\160\151\x6e\147\137\160\162\157\x64\x75\x63\164\x73\x5f\x76\x69\x64\145\157\x73\40\167\150\x65\x72\145\x20\166\x69\144\145\157\x5f\x6e\141\155\145\75\x27" . $db->escape($video->video_name) . "\x27\x20\x61\156\144\40\x70\x72\157\x64\165\143\164\137\x69\x64\x21\x3d\47" . $db->escape($value) . "\47"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->video_product_path . "\57" . $video->video_name); if ($video->video_preview) { @unlink($jshopConfig->video_product_path . "\57" . $video->video_preview); } } } } $query = "\104\105\x4c\105\124\x45\40\106\x52\x4f\x4d\x20\140\43\137\x5f\152\163\x68\x6f\x70\x70\x69\x6e\147\137\160\x72\157\x64\x75\143\x74\163\137\x76\x69\x64\145\157\x73\140\40\127\110\105\x52\x45\40\140\160\162\157\144\x75\x63\x74\x5f\x69\x64\140\x20\75\x20\47" . $db->escape($value) . "\47"; $db->setQuery($query); $db->query(); if (count($files)) { foreach ($files as $file) { $query = "\163\x65\x6c\145\143\164\40\143\x6f\165\156\x74\x28\52\x29\40\x61\163\x20\153\40\146\162\157\x6d\x20\43\x5f\x5f\152\163\150\x6f\x70\x70\x69\156\147\x5f\x70\x72\x6f\x64\165\143\164\x73\137\x66\x69\x6c\145\x73\40\167\x68\x65\x72\145\x20\144\145\155\x6f\x3d\47" . $db->escape($file->demo) . "\x27\40\141\156\x64\x20\x70\162\157\144\165\x63\x74\x5f\151\144\x21\x3d\x27" . $db->escape($value) . "\47"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->demo_product_path . "\x2f" . $file->demo); } $query = "\163\x65\x6c\145\x63\x74\40\143\x6f\x75\156\x74\x28\52\x29\40\x61\163\40\x6b\x20\146\162\157\x6d\40\43\137\137\152\x73\150\157\x70\160\x69\156\147\x5f\x70\x72\157\x64\x75\x63\164\163\137\x66\151\x6c\x65\x73\x20\167\150\145\162\145\x20\146\x69\154\145\75\47" . $db->escape($file->file) . "\47\x20\141\x6e\x64\x20\160\x72\x6f\x64\x75\143\164\x5f\x69\x64\41\75\x27" . $db->escape($value) . "\x27"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->files_product_path . "\x2f" . $file->file); } } } $query = "\104\x45\114\105\x54\x45\40\106\122\x4f\x4d\40\140\x23\x5f\x5f\152\x73\150\157\x70\x70\151\x6e\147\x5f\160\x72\x6f\x64\x75\x63\164\x73\x5f\x66\151\154\145\163\140\x20\x57\110\105\122\x45\x20\140\x70\162\x6f\x64\165\143\164\x5f\x69\144\x60\x20\x3d\x20\47" . $db->escape($value) . "\x27"; $db->setQuery($query); $db->query(); $text[] = sprintf(_JSHOP_VF_PRODUCT_DELETED, $value) . "\74\x62\162\x3e"; } } $this->setRedirect(SEFLink("\x69\156\144\145\x78\x2e\160\x68\160\77\157\160\164\x69\157\x6e\x3d\x63\157\155\137\x6a\x73\x68\157\x70\160\151\156\147\46\143\x6f\156\164\x72\157\x6c\x6c\145\162\75\141\144\144\x6f\156\x5f\166\145\x6e\x64\x6f\162\x26\x74\141\163\153\75\160\162\157\144\165\x63\x74\163", 1, 1), implode("\74\x2f\x6c\151\76\74\154\x69\x3e", $text)); } function publish() { $addon_vendor = $this->getModel("\141\144\144\157\156\x5f\166\x65\156\144\x6f\162"); $addon_vendor->checkUserSeller(); $this->_publishProduct(1); $this->setRedirect(SEFLink("\x69\x6e\144\145\x78\x2e\x70\x68\160\x3f\157\160\164\x69\157\156\x3d\143\157\x6d\137\152\x73\x68\157\x70\160\x69\156\147\x26\143\x6f\x6e\x74\162\157\154\x6c\x65\162\75\x61\144\x64\157\156\137\166\145\156\x64\x6f\162\46\x74\x61\163\x6b\75\x70\x72\x6f\x64\165\143\164\163", 1, 1)); } function unpublish() { $addon_vendor = $this->getModel("\x61\144\x64\157\x6e\x5f\x76\x65\x6e\x64\157\x72"); $addon_vendor->checkUserSeller(); $this->_publishProduct(0); $this->setRedirect(SEFLink("\151\x6e\144\145\170\x2e\160\x68\160\x3f\x6f\160\164\151\x6f\x6e\x3d\x63\x6f\155\x5f\152\x73\x68\x6f\160\160\x69\156\147\x26\x63\x6f\x6e\x74\x72\157\x6c\x6c\x65\x72\x3d\141\x64\144\157\x6e\x5f\x76\x65\156\144\157\x72\46\x74\141\163\x6b\75\160\162\x6f\x64\165\143\164\163", 1, 1)); } function pause() { $addon_vendor = $this->getModel("\x61\x64\x64\x6f\x6e\137\x76\x65\x6e\144\157\162"); $addon_vendor->checkUserSeller(); $this->_publishProduct2(-1, 0); $this->setRedirect(SEFLink("\151\156\144\x65\170\x2e\160\x68\x70\x3f\x6f\x70\x74\x69\x6f\x6e\x3d\143\x6f\155\137\152\x73\x68\x6f\160\160\151\156\x67\46\143\x6f\x6e\164\162\x6f\154\154\145\x72\x3d\x61\x64\144\x6f\156\137\166\145\156\x64\157\162\x26\x74\141\x73\153\x3d\160\162\157\x64\x75\143\164\163", 1, 1)); } function resume() { $addon_vendor = $this->getModel("\141\144\144\x6f\x6e\x5f\166\145\156\144\x6f\162"); $addon_vendor->checkUserSeller(); $this->_publishProduct2(1, 1); $this->setRedirect(SEFLink("\151\156\x64\145\x78\x2e\x70\x68\160\77\x6f\x70\x74\151\x6f\156\x3d\x63\x6f\155\137\x6a\x73\150\x6f\160\x70\151\156\x67\x26\x63\x6f\156\x74\x72\157\x6c\154\x65\x72\75\141\144\144\x6f\156\137\x76\145\156\x64\157\162\x26\x74\x61\x73\153\75\160\162\x6f\x64\165\143\164\x73", 1, 1)); } function _publishProduct($flag) { $addon_vendor = $this->getModel("\141\x64\144\157\x6e\137\x76\145\x6e\x64\157\x72"); $addon_vendor->checkUserSeller(); $db = JFactory::getDBO(); $cid = (array) JRequest::getVar("\x63\x69\144"); $post["\166\x65\156\x64\x6f\x72\137\151\144"] = $this->vendorId; foreach ($cid as $key => $value) { $query = "\125\x50\104\x41\124\105\x20\140\43\137\137\152\163\x68\x6f\160\x70\x69\156\147\137\x70\162\157\x64\165\x63\164\163\140\12\40\40\x20\x20\40\x20\40\x20\40\x20\40\x20\x20\x20\40\40\x20\x20\x20\x20\x20\40\x20\123\105\124\40\x60\166\x65\x6e\x64\157\162\x5f\160\165\142\154\x69\x73\x68\x60\x20\75\x20\x27" . $db->escape($flag) . "\x27\xa\40\x20\40\40\40\x20\x20\x20\40\x20\40\40\x20\x20\40\x20\40\40\40\40\x20\40\x20\127\110\x45\x52\x45\40\x60\x70\x72\157\144\165\143\x74\137\x69\x64\x60\x20\x3d\40\x27" . $db->escape($value) . "\47\x20\x41\116\104\40\x60\166\145\156\144\157\x72\x5f\151\144\140\75\47" . $db->escape($this->vendorId) . "\47\40\x41\116\104\40\x60\142\154\157\143\153\x60\x3d\x27\x30\x27"; $db->setQuery($query); $db->query(); } } function _publishProduct2($flag, $flag2) { $addon_vendor = $this->getModel("\x61\144\144\x6f\156\x5f\166\145\156\144\x6f\162"); $addon_vendor->checkUserSeller(); $db = JFactory::getDBO(); $cid = (array) JRequest::getVar("\143\151\144"); $post["\166\145\x6e\x64\157\x72\137\151\144"] = $this->vendorId; if ($flag2 == 0) { $flag2last = 1; } else { $flag2last = 0; } foreach ($cid as $key => $value) { $query = "\125\x50\x44\x41\x54\x45\40\140\x23\x5f\x5f\152\163\150\x6f\160\160\151\x6e\147\137\160\162\x6f\144\165\143\x74\163\x60\12\40\40\x20\40\40\x20\x20\x20\x20\40\x20\x20\x20\x20\40\40\40\40\x20\40\40\x20\x20\123\105\124\40\x60\166\145\x6e\x64\157\162\x5f\160\x75\142\154\x69\163\x68\x60\40\x3d\40\x27" . $db->escape($flag) . "\47\54\xa\x20\x20\x20\x20\40\x20\40\40\40\x20\40\x20\x20\40\x20\x20\x20\40\x20\40\40\x20\x20\140\x70\162\157\x64\x75\x63\164\x5f\160\165\x62\x6c\151\x73\150\x60\x20\x3d\40\x27" . $db->escape($flag2) . "\47\12\40\40\x20\40\x20\40\x20\x20\40\40\x20\40\40\x20\x20\40\40\40\40\40\x20\x20\x20\x57\x48\105\x52\105\40\140\160\162\x6f\144\x75\143\x74\137\x69\144\x60\40\x3d\x20\x27" . $db->escape($value) . "\x27\40\101\116\104\x20\140\166\x65\156\x64\x6f\x72\x5f\151\x64\140\x3d\x27" . $db->escape($this->vendorId) . "\x27\x20\x41\116\x44\x20\140\x76\145\x6e\144\x6f\162\x5f\160\165\142\x6c\x69\x73\150\140\75\47" . $db->escape(-$flag) . "\47\x20\x41\116\104\x20\140\160\162\x6f\144\165\x63\x74\137\x70\165\142\x6c\151\163\x68\x60\x3d\47" . $db->escape($flag2last) . "\47\x20\101\x4e\104\x20\140\x62\x6c\157\143\x6b\140\75\x27\x30\x27"; $db->setQuery($query); $db->query(); } } function product_extra_fields() { $product_id = JRequest::getInt("\x70\162\x6f\x64\165\143\x74\137\x69\144"); $cat_id = JRequest::getVar("\143\x61\164\x5f\151\144"); $product = JTable::getInstance("\160\x72\x6f\x64\165\x63\164", "\x6a\163\150\x6f\x70"); $product->load($product_id); $categorys = array(); if (is_array($cat_id)) { foreach ($cat_id as $cid) { $categorys[] = intval($cid); } } print $this->_getHtmlProductExtraFields($categorys, $product); die; } function search_related() { $addon_vendor = $this->getModel("\141\x64\144\x6f\x6e\x5f\x76\145\x6e\x64\157\x72"); $addon_vendor->checkUserSeller(); $jshopConfig = JSFactory::getConfig(); $products = $this->getModel("\x70\x72\x6f\x64\x75\x63\164\163"); $text_search = JRequest::getVar("\x74\145\170\164"); $limitstart = JRequest::getInt("\163\x74\x61\162\x74"); $no_id = JRequest::getInt("\156\157\x5f\151\144"); $limit = 20; $filter = array("\x77\151\x74\150\157\165\164\137\160\x72\x6f\x64\x75\143\164\137\x69\x64" => $no_id, "\x74\145\170\164\137\163\x65\141\162\x63\x68" => $text_search, "\166\145\x6e\144\157\162\x5f\x69\144" => $this->vendorId, "\x63\141\164\x65\x67\157\162\x79\x5f\x69\144" => 0, "\x6d\x61\156\165\146\x61\143\x74\165\x72\x65\x72\137\151\x64" => 0, "\154\x61\142\145\x6c\x5f\151\x64" => 0, "\160\x75\x62\x6c\151\163\150" => 0); $total = $products->getCountAllProducts($filter); $rows = $addon_vendor->getAllProducts($filter, $limitstart, $limit); $page = ceil($total / $limit); $view_name = "\141\x64\x64\157\156\x5f\166\x65\156\144\157\162"; $view_config = array("\164\145\155\160\x6c\141\164\145\137\160\x61\164\x68" => JPATH_COMPONENT . "\57\164\145\x6d\160\154\x61\x74\x65\x73\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\x68\164\155\154", '', $view_config); $view->setLayout("\160\162\x6f\144\x75\x63\164\x5f\x6c\151\x73\164\137\163\x65\141\x72\x63\150\137\x72\145\x6c\x61\164\x65\144"); $view->assign("\162\x6f\x77\x73", $rows); $view->assign("\x63\x6f\x6e\x66\x69\x67", $jshopConfig); $view->assign("\x6c\x69\155\151\x74", $limit); $view->assign("\160\x61\147\145\x73", $page); $view->assign("\156\x6f\137\151\x64", $no_id); $view->display(); die; } function delete_foto() { $addon_vendor = $this->getModel("\141\x64\144\157\156\137\x76\145\156\x64\x6f\x72"); $addon_vendor->checkUserSeller(); $image_id = JRequest::getInt("\x69\144"); $jshopConfig = JSFactory::getConfig(); $db = JFactory::getDBO(); $query = "\123\105\114\105\x43\x54\40\x70\x72\157\144\56\x60\166\x65\x6e\x64\157\162\x5f\x69\x64\140\40\106\x52\x4f\x4d\x20\140\x23\137\x5f\152\x73\150\x6f\x70\160\x69\156\147\x5f\x70\x72\x6f\144\165\143\x74\x73\137\151\x6d\x61\147\145\163\140\40\x41\123\40\x69\155\141\x67\145\x73\xa\x20\40\40\40\40\40\40\40\11\x9\40\40\114\105\106\x54\40\112\117\x49\x4e\40\140\43\x5f\137\152\x73\150\x6f\x70\x70\151\156\x67\137\160\x72\x6f\x64\165\x63\164\x73\x60\40\x41\123\x20\x70\162\157\x64\40\x4f\x4e\x20\160\x72\x6f\144\56\140\160\x72\x6f\144\165\x63\164\x5f\151\x64\x60\40\75\40\x69\x6d\x61\x67\145\163\56\140\160\x72\x6f\x64\x75\x63\x74\137\x69\144\x60\x20\12\40\40\40\x20\40\40\40\x20\x9\x9\40\x20\x57\x48\105\122\105\40\140\151\x6d\141\147\x65\137\x69\x64\140\40\x3d\40{$db->escape}\x28{$image_id}\51\40\114\111\x4d\x49\x54\40\x31"; $db->setQuery($query); $vendor_id = $db->loadResult(); if ($this->vendorId == $vendor_id) { $query = "\123\105\x4c\x45\x43\124\x20\x2a\40\x46\122\117\x4d\x20\x60\x23\x5f\x5f\152\x73\150\157\160\x70\x69\x6e\x67\137\160\162\157\x64\165\x63\164\163\137\x69\x6d\x61\x67\x65\x73\x60\40\x57\110\105\x52\x45\40\151\155\141\x67\145\x5f\151\x64\40\75\40\x27" . $db->escape($image_id) . "\47"; $db->setQuery($query); $row = $db->loadObject(); $query = "\104\x45\x4c\x45\124\x45\x20\x46\122\117\x4d\x20\x60\43\x5f\137\x6a\163\x68\x6f\x70\x70\151\x6e\x67\x5f\x70\162\157\x64\x75\143\164\163\x5f\x69\x6d\141\x67\x65\163\140\40\x57\x48\x45\x52\105\40\140\151\x6d\x61\147\145\x5f\x69\x64\x60\x20\75\40\47" . $db->escape($image_id) . "\47"; $db->setQuery($query); $db->query(); $query = "\163\x65\154\145\x63\164\40\143\x6f\165\x6e\164\50\x2a\51\x20\x61\163\x20\x6b\x20\146\162\157\155\x20\43\x5f\137\152\x73\x68\157\160\x70\151\x6e\147\x5f\160\x72\x6f\144\165\143\x74\163\137\151\155\x61\x67\145\163\x20\167\x68\145\162\x65\x20\151\155\x61\147\145\x5f\156\x61\155\145\75\47" . $db->escape($row->image_name) . "\47\x20\141\x6e\144\x20\160\x72\157\144\165\x63\164\x5f\x69\144\41\x3d\47" . $db->escape($row->product_id) . "\47"; $db->setQuery($query); if (!$db->loadResult()) { @unlink(getPatchProductImage($row->image_name, "\164\150\x75\155\142", 2)); @unlink(getPatchProductImage($row->image_name, '', 2)); @unlink(getPatchProductImage($row->image_name, "\x66\165\x6c\154", 2)); } $product = JTable::getInstance("\x70\162\x6f\144\165\x63\x74", "\x6a\x73\150\157\160"); $product->load($row->product_id); if ($product->image == $row->image_name) { $product->image = ''; $list_images = $product->getImages(); if (count($list_images)) { $product->image = $list_images[0]->image_name; } $product->store(); } } else { print "\x41\x63\143\145\163\163\x20\144\145\156\x69\145\x64"; } die; } function delete_video() { $addon_vendor = $this->getModel("\x61\x64\x64\157\156\x5f\x76\145\156\x64\x6f\x72"); $addon_vendor->checkUserSeller(); $video_id = JRequest::getInt("\x69\x64"); $jshopConfig = JSFactory::getConfig(); $db = JFactory::getDBO(); $query = "\x53\105\x4c\105\x43\124\40\160\x72\157\x64\56\x60\x76\x65\x6e\144\157\x72\137\151\x64\x60\40\106\122\x4f\115\40\x60\43\137\137\152\163\x68\x6f\x70\160\151\x6e\x67\137\160\x72\x6f\x64\165\143\x74\x73\137\166\151\x64\145\x6f\163\140\40\101\123\x20\x76\151\144\145\x6f\xa\40\40\x20\x20\x20\40\40\40\x9\x9\x20\x20\x4c\x45\106\124\40\112\117\111\x4e\40\140\43\137\137\x6a\x73\x68\157\160\x70\151\x6e\x67\x5f\160\162\x6f\x64\x75\x63\x74\163\140\40\101\123\x20\x70\x72\157\x64\x20\117\x4e\40\x70\162\x6f\x64\56\140\160\x72\x6f\144\x75\x63\x74\137\x69\x64\140\x20\x3d\40\166\151\x64\x65\x6f\x2e\x60\160\x72\x6f\144\x75\143\164\137\x69\x64\x60\40\12\x20\40\x20\40\x20\40\40\40\11\x9\x20\x20\x57\x48\105\122\105\40\140\166\151\x64\x65\157\x5f\x69\x64\140\x20\75\x20{$video_id}\40\114\111\115\x49\124\40\x31"; $db->setQuery($query); $vendor_id = $db->loadResult(); if ($this->vendorId == $vendor_id) { $query = "\x53\105\x4c\105\x43\x54\40\x2a\x20\x46\122\117\x4d\x20\x60\x23\x5f\x5f\x6a\163\150\157\160\160\151\156\x67\137\160\162\x6f\x64\165\143\x74\x73\x5f\x76\x69\x64\145\x6f\163\140\40\x57\110\x45\122\x45\40\x76\x69\x64\145\157\137\151\x64\40\x3d\x20\x27" . $db->escape($video_id) . "\47"; $db->setQuery($query); $row = $db->loadObject(); $query = "\x73\145\x6c\145\143\x74\x20\143\x6f\165\x6e\x74\50\52\x29\40\x66\162\x6f\x6d\40\43\x5f\137\x6a\163\x68\x6f\x70\160\151\156\x67\137\x70\x72\157\144\165\143\x74\x73\x5f\x76\x69\x64\x65\157\163\40\x77\x68\x65\162\145\40\166\151\144\145\157\x5f\156\x61\x6d\145\x3d\47" . $db->escape($row->video_name) . "\x27\x20\x61\156\144\40\x70\162\157\x64\165\x63\164\137\x69\144\x21\75\47" . $db->escape($row->product_id) . "\47"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->video_product_path . "\57" . $row->video_name); if ($row->video_preview) { @unlink($jshopConfig->video_product_path . "\x2f" . $row->video_preview); } } $query = "\104\105\114\x45\124\105\40\106\x52\117\x4d\40\140\43\x5f\137\x6a\163\150\157\160\x70\x69\x6e\147\x5f\160\162\x6f\x64\x75\x63\x74\163\137\166\x69\144\145\x6f\x73\x60\x20\x57\x48\x45\x52\x45\40\140\x76\151\144\145\x6f\x5f\x69\x64\140\40\75\40\47" . $db->escape($video_id) . "\47"; $db->setQuery($query); $db->query(); } else { print "\101\143\143\x65\163\x73\40\144\145\156\151\x65\x64"; } die; } function delete_file() { $addon_vendor = $this->getModel("\141\x64\x64\x6f\x6e\x5f\166\145\156\144\157\162"); $addon_vendor->checkUserSeller(); $jshopConfig = JSFactory::getConfig(); $db = JFactory::getDBO(); $id = JRequest::getInt("\151\144"); $type = JRequest::getVar("\164\x79\160\x65"); $query = "\x53\x45\114\105\x43\124\x20\160\x72\x6f\144\56\x60\x76\145\x6e\144\157\x72\x5f\x69\144\140\40\x46\122\x4f\x4d\40\x60\x23\137\x5f\x6a\x73\150\x6f\x70\x70\151\156\147\x5f\x70\162\157\144\x75\143\x74\x73\x5f\x66\151\154\145\163\140\40\101\x53\x20\146\x69\154\145\163\12\40\x20\x20\40\x20\40\40\40\11\11\x20\40\x4c\105\x46\124\x20\x4a\117\x49\x4e\40\140\43\x5f\x5f\x6a\163\x68\157\160\x70\151\156\x67\137\x70\162\157\x64\165\x63\164\163\140\x20\101\x53\40\x70\x72\x6f\144\40\x4f\116\40\x70\x72\x6f\x64\x2e\140\x70\x72\157\x64\x75\x63\x74\x5f\151\144\140\x20\x3d\x20\x66\151\x6c\145\163\x2e\x60\x70\162\157\144\165\143\x74\x5f\151\144\140\x20\xa\40\x20\x20\x20\x20\40\40\40\x9\x9\x20\40\x57\x48\x45\x52\x45\40\x60\151\x64\140\x20\x3d\x20{$id}\40\x4c\x49\115\x49\124\x20\x31"; $db->setQuery($query); $vendor_id = $db->loadResult(); if ($this->vendorId == $vendor_id) { $query = "\123\x45\114\x45\103\x54\x20\52\x20\x46\122\x4f\x4d\40\x60\43\137\x5f\x6a\163\x68\x6f\x70\160\151\x6e\147\137\160\162\x6f\x64\x75\143\x74\163\137\146\x69\154\145\163\x60\40\x57\x48\105\122\x45\40\x60\x69\144\x60\x20\75\40\x27" . $db->escape($id) . "\x27"; $db->setQuery($query); $row = $db->loadObject(); $delete_row = 0; if ($type == "\x64\145\155\x6f") { if ($row->file == '') { $query = "\x44\x45\114\105\124\x45\40\106\122\117\x4d\x20\140\x23\137\x5f\152\x73\150\157\160\x70\151\x6e\x67\x5f\x70\162\157\x64\165\x63\x74\x73\137\x66\x69\154\145\163\x60\x20\x57\110\105\122\105\x20\x60\151\144\140\40\x3d\x20\47" . $db->escape($id) . "\x27"; $db->setQuery($query); $db->query(); $delete_row = 1; } else { $query = "\165\160\x64\x61\164\x65\40\140\43\x5f\x5f\x6a\163\x68\157\x70\x70\151\156\147\x5f\x70\x72\157\x64\165\x63\164\x73\137\x66\x69\x6c\x65\163\140\x20\x73\145\164\x20\x60\144\145\x6d\157\x60\75\x27\x27\54\40\x64\145\155\157\x5f\x64\145\x73\x63\x72\75\x27\47\x20\127\x48\x45\122\105\40\x60\x69\x64\140\40\x3d\40\x27" . $db->escape($id) . "\47"; $db->setQuery($query); $db->query(); } $query = "\x73\145\x6c\x65\x63\164\x20\x63\157\165\x6e\x74\50\52\51\x20\x61\163\x20\153\x20\146\x72\157\x6d\40\43\x5f\137\152\x73\x68\157\x70\160\151\x6e\x67\137\x70\162\x6f\144\x75\143\164\x73\137\x66\151\x6c\145\163\40\x77\x68\145\x72\145\40\x64\145\155\x6f\x3d\x27" . $db->escape($row->demo) . "\x27"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->demo_product_path . "\57" . $row->demo); } } if ($type == "\146\x69\x6c\145") { if ($row->demo == '') { $query = "\x44\x45\114\x45\124\105\x20\x46\122\x4f\115\40\140\x23\137\137\152\x73\x68\157\x70\x70\x69\156\147\137\160\162\x6f\x64\x75\143\x74\x73\x5f\146\x69\x6c\x65\x73\140\x20\127\x48\105\122\105\40\x60\151\x64\x60\40\x3d\x20\x27" . $db->escape($id) . "\47"; $db->setQuery($query); $db->query(); $delete_row = 1; } else { $query = "\165\160\144\141\x74\x65\x20\140\43\x5f\137\x6a\163\150\x6f\x70\160\x69\x6e\x67\x5f\x70\x72\157\x64\x75\143\164\x73\x5f\146\x69\x6c\x65\163\x60\x20\163\145\x74\x20\x60\146\151\154\145\140\x3d\x27\x27\x2c\x20\x66\151\154\x65\x5f\x64\x65\x73\143\x72\75\47\x27\40\x57\110\x45\122\105\x20\x60\151\x64\140\x20\75\40\47" . $db->escape($id) . "\47"; $db->setQuery($query); $db->query(); } $query = "\163\145\154\x65\143\x74\x20\143\x6f\x75\x6e\x74\x28\52\51\40\x61\163\40\x6b\40\146\162\157\x6d\x20\43\137\x5f\x6a\x73\150\x6f\x70\160\151\x6e\x67\137\x70\x72\157\x64\x75\143\164\x73\137\x66\x69\154\145\163\x20\167\x68\x65\162\145\40\146\151\x6c\x65\x3d\47" . $db->escape($row->file) . "\47"; $db->setQuery($query); if (!$db->loadResult()) { @unlink($jshopConfig->files_product_path . "\57" . $row->file); } } print $delete_row; } else { print "\x41\143\x63\145\163\163\40\144\145\x6e\x69\145\144"; } die; } function edit_vendor() { $addon_vendor = $this->getModel("\141\x64\x64\157\156\137\166\145\156\x64\x6f\x72"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x65\x64\151\164\126\145\x6e\144\x6f\162"); $lang = JSFactory::getLang(); $jshopConfig = JSFactory::getConfig(); $vndConfig = $addon_vendor->getVendorsConfig(); $vendorInf = $addon_vendor->getVendorByUser(); $country = JTable::getInstance("\143\157\x75\156\x74\162\171", "\x6a\163\150\157\x70"); $list_country = $country->getAllCountries(); $option_country[] = JHTML::_("\163\x65\x6c\145\x63\x74\x2e\157\160\x74\151\x6f\156", 0, _JSHOP_REG_SELECT, "\x63\x6f\165\156\x74\162\171\137\151\x64", "\156\141\155\145"); $option_countryes = array_merge($option_country, $list_country); $lists["\143\157\x75\156\x74\x72\x79"] = JHTML::_("\163\145\154\x65\143\164\x2e\147\x65\156\x65\162\151\143\x6c\151\x73\x74", $option_countryes, "\x63\157\165\x6e\164\x72\171", "\x63\154\x61\163\x73\40\x3d\x20\42\151\156\160\165\x74\x62\x6f\170\x22\x20\163\x69\x7a\145\x20\x3d\x20\x22\61\42", "\x63\x6f\165\156\x74\162\x79\x5f\x69\144", "\156\141\x6d\145", $vendorInf->country); $view_name = "\x61\144\144\157\x6e\137\x76\x65\156\x64\157\x72"; $view_config = array("\x74\145\155\160\x6c\x61\x74\x65\137\160\x61\x74\x68" => JPATH_COMPONENT . "\57\164\145\x6d\x70\154\141\164\x65\x73\x2f" . $this->va_template . "\57" . $view_name); $view = $this->getView($view_name, "\x68\x74\155\154", '', $view_config); $view->setLayout("\166\x65\x6e\x64\x6f\162\x5f\x65\x64\151\164"); $view->assign("\x76\x65\156\144\157\162", $vendorInf); $view->assign("\x6c\x69\x73\x74\x73", $lists); $view->assign("\166\156\144\x63\x6f\156\146\151\147", $vndConfig); $view->display(); } function save_vendor() { $addon_vendor = $this->getModel("\141\144\144\x6f\156\137\x76\x65\x6e\144\x6f\162"); $addon_vendor->checkUserSeller(); $addon_vendor->checkTasksAccess("\x65\x64\x69\x74\x56\145\156\x64\x6f\162"); $vndConfig = $addon_vendor->getVendorsConfig(); $vendorInf = $addon_vendor->getVendorByUser(); $vendor = JTable::getInstance("\166\x65\x6e\144\x6f\x72", "\x6a\x73\150\x6f\x70"); $post = JRequest::get("\160\157\163\164"); $post["\151\144"] = $vendorInf->id; $vendor->bind($post); if ($vndConfig->show_vendor_form == 1 || $vndConfig->show_vendor_form == 2) { if (!$vendor->check()) { JError::raiseWarning('', $vendor->getError()); $this->setRedirect(SEFLink("\151\156\144\145\170\56\x70\150\160\77\x6f\x70\x74\x69\x6f\156\75\143\x6f\155\137\152\163\x68\157\160\160\x69\x6e\x67\x26\x63\x6f\156\x74\162\x6f\154\154\x65\x72\x3d\141\144\144\157\156\x5f\x76\x65\x6e\144\157\x72\x26\164\141\x73\153\75\x65\144\151\164\137\166\x65\x6e\x64\157\x72", 1, 1)); return 0; } } if (!$vendor->store()) { JError::raiseWarning('', _JSHOP_ERROR_SAVE_DATABASE); $this->setRedirect(SEFLink("\151\156\x64\145\170\56\x70\150\x70\77\157\160\164\151\157\156\x3d\x63\x6f\x6d\x5f\152\163\x68\x6f\160\x70\x69\x6e\x67\x26\143\157\x6e\x74\x72\x6f\x6c\x6c\145\162\x3d\x61\x64\x64\x6f\x6e\x5f\166\x65\156\x64\x6f\162\46\x74\141\163\x6b\75\145\144\151\x74\137\166\x65\156\144\x6f\162", 1, 1)); return 0; } $this->setRedirect(SEFLink("\151\x6e\144\x65\170\56\x70\x68\x70\x3f\157\160\x74\x69\157\x6e\x3d\143\157\155\x5f\152\163\x68\157\160\160\151\156\x67\x26\x63\157\156\164\162\x6f\154\x6c\x65\162\x3d\x61\x64\x64\x6f\x6e\137\166\x65\x6e\x64\x6f\x72", 1, 1), _JSHOP_VF_VENDOR_SAVED); } public function payments() { JSFactory::loadAdminLanguageFile(); $application = JFactory::getApplication(); $addonModel = JModelLegacy::getInstance("\141\x64\x64\x6f\156\x5f\x76\145\x6e\144\x6f\x72", "\112\163\x68\x6f\160\x70\151\x6e\147\x4d\x6f\x64\145\x6c"); $addonModel->checkUserSeller(); $addonModel->checkTasksAccess("\x70\141\171\x6d\145\x6e\164\163"); $ordering = $application->getUserStateFromRequest("\x63\x6f\155\137\x6a\163\x68\157\160\160\151\156\x67\x2e\x61\144\x64\157\x6e\137\166\x65\x6e\x64\157\162\163\56\160\x61\171\x6d\x65\156\x74\x73\x2e\x6f\x72\144\x65\x72\151\156\x67", "\146\151\154\164\145\x72\137\157\x72\144\145\162", "\x6f\162\x64\145\x72\151\156\x67", "\x63\x6d\144"); $direction = strtoupper($application->getUserStateFromRequest("\x63\x6f\155\x5f\152\163\x68\157\160\x70\x69\156\147\56\141\x64\x64\x6f\156\137\166\145\156\144\x6f\162\x73\56\x70\141\171\x6d\x65\156\x74\x73\x2e\144\151\x72\145\x63\x74\x69\157\x6e", "\146\151\154\x74\145\162\137\x6f\x72\x64\145\x72\x5f\104\x69\x72", "\101\123\x43", "\x63\155\x64")); $rows = $addonModel->getVendorPayments($this->vendorId, false, $ordering, $direction); $view = $this->getView("\x61\x64\x64\x6f\156\x5f\x76\x65\x6e\x64\157\x72", "\x68\x74\x6d\x6c", '', array("\164\145\x6d\160\154\x61\x74\x65\137\x70\141\x74\150" => JPATH_ROOT . "\x2f\x63\157\155\160\x6f\156\x65\156\164\163\57\x63\157\x6d\137\x6a\x73\150\x6f\x70\160\151\156\147\57\x74\145\155\x70\154\141\x74\145\x73\57\141\x64\x64\x6f\156\x73\57\x61\x64\x64\x6f\x6e\x5f\166\x65\x6e\x64\x6f\x72")); $view->setLayout("\160\x61\x79\x6d\145\156\x74\163"); $view->assign("\x70\x61\147\x69\156\141\x74\151\x6f\x6e", new JPagination(count($rows), 0, count($rows))); $view->assign("\x72\x6f\x77\x73", $rows); $view->assign("\x66\x69\x6c\164\145\162\137\157\162\x64\145\x72", $ordering); $view->assign("\x66\151\154\164\145\x72\137\x6f\x72\144\145\162\x5f\x44\151\162", $direction); appendPathWay(_JSHOP_PAYMENTS); $view->display(); } public function paymentEdit() { JSFactory::loadAdminLanguageFile(); $addonModel = JModelLegacy::getInstance("\141\144\144\157\156\x5f\x76\145\x6e\144\x6f\x72", "\112\x73\x68\x6f\x70\160\151\156\147\115\157\144\145\154"); $addonModel->checkUserSeller(); $addonModel->checkTasksAccess("\x70\141\171\x6d\x65\x6e\164\x45\x64\x69\164"); $cid = JRequest::getVar("\143\151\x64", array(), "\120\117\123\124", "\141\x72\x72\141\x79"); $paymentId = (int) (count($cid) ? $cid[0] : JRequest::getInt("\x70\x61\x79\155\145\x6e\x74\137\151\144")); $addonModel->checkPaymentAccess($paymentId); $payment = JTable::getInstance("\x70\x61\x79\155\145\x6e\x74\x4d\x65\x74\x68\x6f\x64", "\152\x73\x68\157\x70"); $payment->load($paymentId); JFilterOutput::objectHTMLSafe($payment, ENT_QUOTES, array()); $view = $this->getView("\141\x64\x64\x6f\x6e\x5f\x76\x65\156\144\157\162", "\150\164\155\x6c", '', array("\x74\x65\x6d\x70\154\x61\x74\x65\x5f\x70\141\x74\150" => JPATH_ROOT . "\57\x63\157\x6d\x70\157\x6e\145\x6e\x74\x73\x2f\x63\157\x6d\137\x6a\163\x68\157\160\x70\x69\x6e\x67\57\164\145\155\x70\x6c\x61\164\x65\x73\57\x61\x64\144\157\156\163\x2f\x61\144\x64\x6f\156\137\166\145\156\x64\x6f\162")); $view->setLayout("\x70\x61\171\x6d\145\x6e\164"); $view->assign("\x70\x61\171\155\145\x6e\164", $payment); $languagesModel = JModelLegacy::getInstance("\154\141\156\x67\165\141\147\145\163", "\112\x73\150\157\x70\160\x69\156\147\x4d\157\x64\145\x6c"); $view->assign("\x6c\x61\x6e\147\x75\x61\x67\145\x73", $languagesModel->getAllLanguages(1)); $view->assign("\x63\x6f\156\x66\151\147\x48\164\x6d\x6c", $addonModel->renderPaymentConfig($payment)); $view->assign("\x74\141\170\117\160\x74\151\x6f\156\x73", $addonModel->getTaxOptions()); $view->assign("\160\141\x79\x6d\x65\156\164\x50\x72\157\x74\x6f\x74\171\x70\145\117\160\x74\x69\157\156\163", $addonModel->getPaymentPrototypeOptions()); $view->assign("\x70\162\x69\143\145\124\x79\160\145\x4f\x70\x74\x69\157\x6e\163", $addonModel->getPriceTypeOptions()); $paymentsModel = JModelLegacy::getInstance("\160\141\171\155\145\x6e\x74\163", "\112\163\x68\157\160\160\151\156\147\115\x6f\x64\x65\x6c"); $view->assign("\x70\141\171\x6d\x65\156\164\124\x79\160\x65\x4f\160\x74\151\x6f\156\163", $paymentsModel->getTypes()); $view->display(); } public function paymentSave() { JSession::checkToken() or die(JText::_("\x4a\x49\x4e\x56\101\x4c\x49\104\x5f\x54\117\113\x45\x4e")); $addonModel = JModelLegacy::getInstance("\141\x64\144\157\x6e\x5f\x76\x65\156\x64\157\162", "\112\x73\x68\x6f\x70\160\151\156\x67\115\x6f\144\x65\x6c"); $paymentId = JRequest::getInt("\160\141\x79\x6d\x65\x6e\164\x5f\151\144"); $addonModel->checkPaymentAccess($paymentId); $post = JRequest::get("\x70\x6f\163\x74"); $payment = JTable::getInstance("\x70\x61\171\x6d\145\156\x74\x4d\145\164\x68\157\x64", "\x6a\163\x68\157\x70"); if ($paymentId == 0) { $prototypePaymentId = JRequest::getInt("\160\x72\x6f\x74\x6f\x74\171\x70\x65\137\x70\x61\x79\x6d\x65\x6e\x74\137\151\144"); if ($prototypePaymentId != 0) { $payment->load($prototypePaymentId); $payment->payment_class .= "\137" . JFactory::getUser()->id; $addonModel->filterEmptyPaymentData($post); } else { $post["\160\x61\x79\x6d\145\x6e\x74\x5f\164\x79\160\x65"] = 1; } } $post["\160\162\151\x63\145"] = saveAsPrice($post["\160\162\x69\143\x65"]); $payment->bind($post); if (isset($post["\x70\x6d\137\160\x61\162\141\155\x73"])) { $parseString = new parseString($post["\160\x6d\x5f\160\141\162\141\155\x73"]); $payment->payment_params = $parseString->splitParamsToString(); } $error = false; if ($payment->check()) { if ($addonModel->checkVendorPaymentExists($payment, $this->vendorId)) { $payment->store(); $addonModel->addPaymentToVendor($this->vendorId, $payment->payment_id); } else { $error = _JSHOP_VENDOR_PAYMENT_ALREDY_EXISTS_ERROR; } } else { $error = $payment->getError(); } if ($error !== false) { $this->setRedirect(SEFLink("\x69\156\144\x65\x78\56\160\150\x70\77\157\x70\164\x69\x6f\x6e\x3d\143\157\155\x5f\x6a\x73\x68\157\x70\x70\151\156\x67\x26\143\x6f\x6e\164\162\x6f\x6c\x6c\145\162\x3d\141\x64\x64\x6f\x6e\137\166\x65\x6e\144\x6f\x72\x26\164\141\163\153\x3d\x70\x61\171\155\x65\156\164\105\144\151\x74\x26\160\141\x79\x6d\x65\x6e\x74\137\x69\x64\x3d" . $paymentId, 1, 1), $error, "\145\162\162\157\x72"); } else { $this->setRedirect(SEFLink("\151\x6e\x64\145\x78\56\160\x68\160\x3f\157\x70\x74\151\x6f\x6e\x3d\x63\x6f\x6d\137\x6a\x73\150\157\x70\160\x69\x6e\147\46\143\x6f\x6e\x74\162\157\x6c\154\x65\x72\x3d\x61\x64\x64\157\x6e\x5f\166\145\156\144\157\x72\46\164\141\x73\153\x3d\x70\141\171\155\145\x6e\x74\x73", 1, 1)); } } public function paymentCancel() { $this->setRedirect(SEFLink("\x69\156\144\145\x78\x2e\x70\150\x70\x3f\157\x70\164\151\x6f\x6e\75\x63\157\155\x5f\152\163\150\x6f\x70\160\x69\156\x67\x26\143\x6f\156\164\162\157\x6c\154\x65\162\75\x61\144\x64\157\156\137\166\145\156\144\x6f\162\x26\x74\x61\x73\x6b\75\160\x61\x79\x6d\x65\156\164\x73", 1, 1)); } public function paymentDelete() { JSession::checkToken() or die(JText::_("\112\111\116\126\101\x4c\111\x44\137\x54\x4f\113\105\116")); $addonModel = JModelLegacy::getInstance("\x61\x64\x64\x6f\x6e\x5f\166\145\x6e\144\x6f\x72", "\112\x73\x68\157\x70\160\x69\156\x67\115\x6f\144\145\x6c"); $cid = JRequest::getVar("\x63\151\144", array(), "\x50\x4f\x53\x54", "\x61\162\x72\x61\x79"); $payment = JTable::getInstance("\160\x61\171\155\x65\x6e\164\115\145\164\x68\x6f\x64", "\x6a\163\150\x6f\160"); $v2p = JTable::getInstance("\126\145\156\x64\x6f\x72\x73\x54\x6f\120\141\171\155\x65\156\164\x73", "\x6a\x73\x68\x6f\x70"); foreach ($cid as $paymentId) { $addonModel->checkPaymentAccess($paymentId); if ($payment->delete($paymentId)) { if ($v2p->load(array("\x70\141\171\x6d\145\x6e\x74\x5f\151\144" => $paymentId))) { $v2p->delete(); } } else { JFactory::getApplication()->enqueueMessage($table->getError(), "\x65\162\162\157\x72"); } } $this->setRedirect(SEFLink("\151\x6e\x64\145\x78\56\160\150\160\x3f\x6f\160\164\151\157\156\75\x63\157\x6d\x5f\152\163\150\157\x70\160\151\156\x67\46\x63\x6f\156\164\x72\157\x6c\154\x65\162\x3d\x61\x64\144\157\156\137\x76\x65\156\x64\x6f\162\x26\164\141\163\x6b\x3d\160\141\x79\x6d\x65\156\164\163", 1, 1)); } public function paymentPublish() { JSession::checkToken() or die(JText::_("\112\x49\116\126\x41\114\111\x44\x5f\124\117\x4b\105\116")); $addonModel = JModelLegacy::getInstance("\x61\x64\x64\157\156\x5f\x76\145\x6e\x64\157\162", "\112\163\150\157\160\160\151\156\x67\x4d\x6f\x64\x65\x6c"); $cid = JRequest::getVar("\143\151\144", array(), "\x50\x4f\x53\124", "\x61\x72\x72\x61\x79"); $task = strtolower(JRequest::getCmd("\164\x61\163\153")); $paymentPublish = (int) ($task == "\x70\141\171\x6d\145\x6e\164\x70\165\x62\x6c\x69\163\150"); $payment = JTable::getInstance("\x70\141\171\x6d\145\156\164\x4d\x65\x74\x68\157\x64", "\152\x73\150\x6f\160"); foreach ($cid as $paymentId) { $addonModel->checkPaymentAccess($paymentId); if ($payment->load($paymentId)) { $payment->payment_publish = $paymentPublish; $payment->store(); } } $this->setRedirect(SEFLink("\151\156\144\145\170\x2e\160\x68\x70\77\157\x70\x74\151\157\156\75\x63\157\x6d\x5f\x6a\x73\x68\x6f\x70\160\x69\156\147\46\143\x6f\156\164\162\157\x6c\154\x65\162\x3d\x61\144\x64\x6f\156\x5f\166\x65\x6e\144\157\x72\46\x74\x61\163\153\x3d\x70\x61\171\x6d\145\x6e\x74\163", 1, 1)); } public function paymentReorder() { JSession::checkToken() or die(JText::_("\112\x49\x4e\126\101\x4c\x49\x44\137\124\117\113\105\116")); $addonModel = JModelLegacy::getInstance("\x61\x64\x64\157\156\x5f\x76\x65\x6e\144\157\162", "\112\163\150\x6f\x70\x70\x69\156\x67\115\157\x64\x65\154"); $cid = JRequest::getVar("\x63\x69\x64", array(), "\120\117\x53\x54", "\141\x72\x72\141\171"); $task = strtolower(JRequest::getCmd("\164\x61\163\153")); $delta = $task == "\160\x61\171\x6d\x65\x6e\164\x6f\x72\144\145\x72\x75\x70" ? -1 : 1; $v2p = JTable::getInstance("\x56\x65\x6e\144\x6f\x72\x73\x54\x6f\x50\x61\171\x6d\145\156\164\x73", "\152\163\150\157\x70"); foreach ($cid as $paymentId) { $addonModel->checkPaymentAccess($paymentId); if ($v2p->load(array("\160\x61\171\x6d\x65\156\164\x5f\x69\x64" => $paymentId, "\x76\145\x6e\144\157\162\x5f\151\x64" => $this->vendorId))) { $v2p->move($delta, array("\x76\145\156\144\157\162\x5f\x69\144" => $this->vendorId)); } } $this->setRedirect(SEFLink("\x69\156\x64\x65\170\56\160\x68\x70\77\x6f\160\164\x69\157\x6e\75\x63\157\155\x5f\x6a\x73\x68\x6f\x70\x70\151\x6e\147\46\x63\157\x6e\x74\x72\157\x6c\x6c\x65\x72\x3d\x61\144\x64\x6f\156\x5f\x76\x65\x6e\144\157\162\46\164\x61\x73\x6b\75\x70\141\x79\155\x65\x6e\x74\x73", 1, 1)); } public function paymentSaveOrder() { JSession::checkToken() or jexit(JText::_("\x4a\111\x4e\126\101\x4c\111\x44\x5f\x54\117\113\x45\116")); $addonModel = JModelLegacy::getInstance("\141\x64\144\x6f\156\x5f\166\x65\156\x64\x6f\x72", "\x4a\x73\x68\157\x70\x70\x69\x6e\x67\115\157\144\x65\154"); $cid = JRequest::getVar("\143\151\144", array(), "\x50\x4f\123\124", "\141\162\162\141\x79"); $order = JRequest::getVar("\x6f\x72\144\145\162", array(), "\141\162\x72\x61\x79"); JArrayHelper::toInteger($cid); JArrayHelper::toInteger($order); $addonModel->paymentSaveOrder($cid, $order); $this->setRedirect(SEFLink("\x69\156\x64\145\x78\56\x70\150\x70\77\157\160\x74\151\x6f\x6e\75\143\x6f\155\137\x6a\163\x68\x6f\160\160\151\x6e\x67\46\143\x6f\156\164\162\157\x6c\x6c\x65\x72\x3d\141\144\144\157\x6e\137\x76\145\x6e\144\x6f\x72\x26\164\141\163\153\75\x70\141\171\155\145\x6e\164\163", 1, 1)); } public function shippings() { JSFactory::loadAdminLanguageFile(); $application = JFactory::getApplication(); $addonModel = JModelLegacy::getInstance("\x61\144\x64\157\x6e\137\166\145\156\144\157\162", "\x4a\x73\150\157\160\160\x69\x6e\147\x4d\157\144\x65\x6c"); $addonModel->checkUserSeller(); $addonModel->checkTasksAccess("\163\150\151\x70\x70\151\x6e\x67\x73"); $ordering = $application->getUserStateFromRequest("\143\x6f\x6d\x5f\x6a\163\150\x6f\160\x70\151\156\x67\x2e\x61\x64\144\157\156\x5f\x76\145\156\x64\x6f\x72\163\56\163\150\151\x70\160\151\x6e\x67\163\56\157\x72\x64\x65\x72\x69\x6e\147", "\x66\151\154\x74\145\x72\x5f\157\x72\x64\x65\x72", "\157\x72\144\145\x72\x69\x6e\147", "\143\x6d\144"); $direction = strtoupper($application->getUserStateFromRequest("\143\x6f\x6d\137\x6a\163\150\x6f\x70\x70\151\156\147\56\141\x64\144\x6f\x6e\137\166\145\156\144\x6f\x72\x73\56\x73\150\x69\160\x70\x69\x6e\147\x73\x2e\144\x69\162\145\143\x74\x69\157\156", "\146\x69\x6c\164\x65\x72\x5f\x6f\x72\144\145\162\x5f\104\151\162", "\101\x53\x43", "\143\155\x64")); $shippings = $addonModel->getVendorShippings($this->vendorId, false, $ordering, $direction); $addonModel->checkShippingsPrices($shippings); $view = $this->getView("\x61\144\x64\x6f\156\137\166\145\x6e\x64\x6f\x72", "\150\164\x6d\x6c", '', array("\164\145\x6d\160\x6c\141\x74\x65\x5f\160\141\164\x68" => JPATH_ROOT . "\57\143\x6f\x6d\160\x6f\x6e\145\156\164\x73\x2f\x63\157\155\137\x6a\163\150\x6f\x70\160\x69\x6e\147\x2f\164\x65\155\160\x6c\x61\x74\x65\163\57\x61\144\144\157\x6e\163\x2f\x61\144\x64\157\x6e\x5f\166\145\156\x64\x6f\x72")); $view->setLayout("\163\150\151\x70\160\x69\x6e\147\163"); $view->assign("\162\x6f\167\x73", $shippings); $view->assign("\x66\x69\154\164\x65\x72\x5f\157\x72\144\145\x72", $filter_order); $view->assign("\x66\x69\x6c\164\145\x72\137\157\162\x64\145\162\x5f\x44\151\x72", $filter_order_Dir); $view->assign("\x70\x61\x67\151\156\141\164\151\157\x6e", new JPagination(count($shippings), 0, count($shippings))); $view->assign("\157\x72\144\145\162\x69\x6e\x67", $ordering); $view->assign("\x64\151\x72\x65\x63\x74\151\x6f\156", $direction); appendPathWay(_JSHOP_SHIPPINGS); $view->display(); } public function shippingEdit() { $addonModel = JModelLegacy::getInstance("\141\x64\x64\x6f\x6e\137\166\145\156\x64\157\x72", "\112\x73\x68\157\x70\x70\151\156\x67\x4d\157\144\145\154"); $addonModel->checkUserSeller(); $addonModel->checkTasksAccess("\163\150\151\160\x70\x69\x6e\147\x45\x64\151\164"); JSFactory::loadAdminLanguageFile(); $cid = JRequest::getVar("\143\151\144", array(), "\x50\117\123\124", "\141\162\162\x61\x79"); $shippingId = (int) (count($cid) ? $cid[0] : JRequest::getInt("\163\x68\x69\160\160\x69\156\x67\137\x69\144")); $addonModel->checkShippingAccess($shippingId); $shipping = JTable::getInstance("\163\x68\x69\160\160\x69\156\147\x4d\145\x74\150\157\x64", "\x6a\163\x68\x6f\160"); $shipping->load($shippingId); $languagesModel = JModelLegacy::getInstance("\x6c\x61\x6e\x67\165\x61\x67\145\x73", "\112\163\x68\157\160\x70\x69\156\x67\x4d\157\x64\x65\154"); $view = $this->getView("\x61\144\144\x6f\156\137\x76\145\x6e\144\x6f\162", "\x68\x74\155\154", '', array("\164\x65\x6d\160\154\141\x74\x65\137\x70\141\164\150" => JPATH_ROOT . "\x2f\x63\x6f\155\160\x6f\x6e\145\x6e\164\163\57\x63\157\x6d\137\152\x73\x68\x6f\160\160\151\156\x67\x2f\x74\145\x6d\x70\x6c\141\164\x65\163\57\x61\144\x64\157\x6e\163\x2f\141\144\144\x6f\x6e\x5f\166\x65\156\x64\157\162")); $view->setLayout("\163\150\x69\160\x70\151\156\x67"); $view->assign("\163\150\x69\160\160\151\156\x67", $shipping); $view->assign("\x6c\141\156\x67\165\x61\x67\x65\163", $languagesModel->getAllLanguages(1)); $view->assign("\x70\x61\x79\x6d\145\156\x74\163\117\x70\164\x69\x6f\156\163", $addonModel->getShippingPaymentsOptions()); $view->display(); } public function shippingSave() { JSession::checkToken() or die(JText::_("\112\x49\116\126\x41\x4c\111\104\x5f\124\x4f\x4b\x45\116")); $addonModel = JModelLegacy::getInstance("\141\x64\x64\157\x6e\137\x76\x65\x6e\144\x6f\x72", "\112\x73\150\x6f\160\x70\151\156\147\115\157\x64\x65\154"); $shippingId = JRequest::getInt("\163\150\151\x70\160\151\156\x67\137\x69\x64"); $addonModel->checkShippingAccess($shippingId); $shipping = JTable::getInstance("\x73\150\x69\x70\x70\x69\156\147\115\145\164\150\157\x64", "\152\163\150\x6f\160"); $shipping->setPayments(JRequest::getVar("\154\151\x73\x74\160\141\x79\155\145\x6e\x74\163", array(), "\x50\x4f\x53\124", "\x61\x72\x72\x61\171")); $shipping->bind(JRequest::get("\x70\x6f\x73\164")); $error = false; if ($shipping->store()) { $addonModel->addShippingToVendor($this->vendorId, $shipping->shipping_id); } else { $error = $shipping->getError(); } if ($error !== false) { $this->setRedirect(SEFLink("\x69\x6e\x64\145\170\56\x70\150\160\x3f\157\160\x74\151\157\156\75\143\157\x6d\x5f\x6a\x73\x68\157\160\x70\x69\x6e\x67\46\x63\157\x6e\x74\162\157\154\154\x65\x72\75\141\x64\x64\157\156\137\x76\145\x6e\144\x6f\x72\x26\x74\141\163\x6b\x3d\x73\x68\151\x70\160\151\x6e\147\105\x64\151\x74\46\x73\x68\x69\160\x70\x69\x6e\x67\137\151\x64\75" . $shippingId, 1, 1), $error, "\x65\162\162\157\x72"); } else { $this->setRedirect(SEFLink("\151\156\x64\145\170\x2e\160\150\x70\77\157\x70\164\x69\x6f\x6e\x3d\143\157\155\137\152\x73\150\x6f\160\x70\x69\156\x67\46\143\157\156\164\162\157\x6c\x6c\145\x72\x3d\141\144\x64\x6f\x6e\x5f\x76\x65\156\x64\157\162\x26\x74\x61\x73\153\x3d\x73\150\x69\x70\160\151\156\147\x73", 1, 1)); } } public function shippingCancel() { $this->setRedirect(SEFLink("\x69\156\144\x65\170\x2e\x70\150\x70\77\157\160\164\x69\157\x6e\x3d\x63\x6f\155\137\152\163\x68\x6f\160\x70\151\x6e\x67\46\x63\x6f\x6e\164\x72\157\154\154\145\162\x3d\141\144\x64\157\156\x5f\x76\x65\x6e\144\x6f\x72\46\164\141\x73\x6b\75\163\x68\x69\x70\x70\151\156\x67\163", 1, 1)); } public function shippingDelete() { JSession::checkToken() or die(JText::_("\112\111\116\126\101\x4c\x49\104\137\124\117\113\x45\116")); $addonModel = JModelLegacy::getInstance("\141\x64\x64\x6f\x6e\137\166\x65\x6e\144\157\162", "\112\x73\150\x6f\160\160\151\156\147\x4d\157\x64\145\x6c"); $cid = JRequest::getVar("\x63\x69\144", array(), "\x50\x4f\123\x54", "\x61\162\162\141\171"); $shipping = JTable::getInstance("\x73\150\151\x70\160\151\156\x67\x4d\x65\164\x68\x6f\144", "\152\163\x68\157\x70"); $v2s = JTable::getInstance("\126\145\x6e\x64\157\162\163\x54\x6f\123\150\151\160\x70\151\x6e\147\x73", "\152\163\150\x6f\x70"); foreach ($cid as $shippingId) { $addonModel->checkShippingAccess($shippingId); if ($shipping->delete($shippingId)) { $addonModel->deleteShippingsPricesByShippingId($shippingId); if ($v2s->load(array("\x73\150\151\160\x70\151\x6e\x67\x5f\151\144" => $shippingId))) { $v2s->delete(); } } } $this->setRedirect(SEFLink("\x69\x6e\x64\x65\x78\56\x70\x68\160\77\x6f\160\164\x69\157\156\x3d\x63\157\155\137\152\x73\150\157\x70\160\x69\156\147\46\x63\x6f\x6e\164\x72\x6f\154\154\145\162\x3d\141\144\144\x6f\156\137\x76\145\x6e\144\157\162\x26\x74\x61\163\x6b\x3d\163\x68\x69\x70\x70\x69\x6e\147\163", 1, 1)); } public function shippingPublish() { JSession::checkToken() or die(JText::_("\112\x49\x4e\x56\101\x4c\x49\104\137\124\117\113\105\x4e")); $addonModel = JModelLegacy::getInstance("\141\144\x64\157\156\137\166\x65\156\x64\157\x72", "\x4a\x73\150\157\x70\x70\x69\x6e\x67\115\157\x64\145\x6c"); $cid = JRequest::getVar("\143\x69\144", array(), "\120\117\123\x54", "\x61\x72\162\x61\x79"); $task = strtolower(JRequest::getCmd("\x74\x61\x73\153")); $shippingPublish = (int) ($task == "\x73\x68\151\160\x70\151\x6e\147\160\165\x62\x6c\x69\x73\x68"); $shipping = JTable::getInstance("\x73\150\151\160\160\151\156\147\x4d\145\164\x68\x6f\144", "\152\x73\150\x6f\160"); foreach ($cid as $shippingId) { $addonModel->checkShippingAccess($shippingId); if ($shipping->load($shippingId)) { $shipping->published = $shippingPublish; $shipping->store(); } } $this->setRedirect(SEFLink("\x69\x6e\144\145\x78\x2e\x70\x68\160\x3f\x6f\x70\164\151\157\156\x3d\x63\x6f\x6d\x5f\x6a\x73\150\157\160\x70\151\156\147\x26\x63\x6f\x6e\x74\162\157\x6c\154\x65\x72\x3d\x61\x64\x64\157\156\x5f\x76\x65\156\144\x6f\x72\46\x74\141\163\x6b\75\163\x68\x69\x70\x70\x69\156\x67\x73", 1, 1)); } public function shippingReorder() { JSession::checkToken() or die(JText::_("\112\x49\116\x56\101\x4c\111\x44\x5f\x54\x4f\x4b\x45\x4e")); $addonModel = JModelLegacy::getInstance("\141\x64\x64\157\156\137\x76\145\x6e\144\x6f\x72", "\x4a\163\150\x6f\x70\160\x69\x6e\x67\115\157\x64\145\154"); $cid = JRequest::getVar("\x63\x69\144", array(), "\120\x4f\x53\124", "\x61\x72\x72\x61\x79"); $task = strtolower(JRequest::getCmd("\x74\141\x73\153")); $delta = $task == "\163\x68\x69\x70\x70\151\156\147\x6f\162\x64\145\162\165\160" ? -1 : 1; $v2s = JTable::getInstance("\x56\x65\156\x64\157\x72\163\x54\x6f\123\150\151\160\160\151\x6e\x67\x73", "\x6a\x73\150\x6f\160"); foreach ($cid as $shippingId) { $addonModel->checkShippingAccess($shippingId); if ($v2s->load(array("\163\150\x69\160\x70\x69\156\x67\137\151\144" => $shippingId, "\166\145\x6e\144\157\x72\x5f\151\x64" => $this->vendorId))) { $v2s->move($delta, array("\x76\145\x6e\x64\157\x72\137\151\144" => $this->vendorId)); } } $this->setRedirect(SEFLink("\x69\156\144\x65\170\x2e\160\x68\160\77\157\x70\x74\x69\157\156\75\143\157\x6d\137\152\x73\x68\157\x70\x70\x69\156\147\x26\x63\157\x6e\x74\162\157\x6c\154\x65\x72\75\141\x64\x64\x6f\156\x5f\166\x65\156\x64\x6f\x72\46\x74\x61\163\x6b\x3d\x73\x68\151\160\x70\151\156\x67\163", 1, 1)); } public function shippingSaveOrder() { JSession::checkToken() or jexit(JText::_("\x4a\111\116\126\x41\114\111\104\137\124\117\113\105\116")); $addonModel = JModelLegacy::getInstance("\x61\x64\x64\157\x6e\137\166\x65\x6e\144\157\162", "\112\163\150\x6f\160\x70\x69\x6e\147\x4d\x6f\144\145\x6c"); $cid = JRequest::getVar("\143\x69\144", array(), "\x50\x4f\x53\124", "\141\x72\x72\141\x79"); $order = JRequest::getVar("\157\x72\144\x65\x72", array(), "\141\162\x72\141\171"); JArrayHelper::toInteger($cid); JArrayHelper::toInteger($order); $addonModel->shippingSaveOrder($cid, $order); $this->setRedirect(SEFLink("\151\x6e\x64\145\170\x2e\x70\150\x70\x3f\157\x70\x74\x69\157\x6e\x3d\x63\157\155\137\152\x73\150\x6f\x70\x70\151\156\x67\46\143\157\x6e\x74\162\x6f\x6c\x6c\x65\162\x3d\x61\144\144\x6f\x6e\x5f\x76\145\156\144\x6f\x72\x26\x74\x61\x73\153\75\163\150\151\160\160\151\156\x67\x73", 1, 1)); } public function shippingsPrices() { JSFactory::loadAdminLanguageFile(); $addonModel = JModelLegacy::getInstance("\x61\x64\144\157\x6e\137\166\x65\x6e\x64\157\x72", "\x4a\x73\x68\157\x70\160\151\156\x67\x4d\x6f\144\x65\154"); $addonModel->checkUserSeller(); $addonModel->checkTasksAccess("\163\150\x69\x70\x70\x69\x6e\147\163\120\162\151\x63\x65\x73"); $application = JFactory::getApplication(); $ordering = $application->getUserStateFromRequest("\x63\x6f\155\x5f\x6a\x73\x68\x6f\160\x70\151\156\147\x2e\141\144\x64\x6f\x6e\137\166\145\x6e\144\157\162\x73\x2e\x73\150\x69\x70\160\151\x6e\147\x73\x70\x72\x69\x63\145\x73\x2e\x6f\162\144\145\x72\x69\156\x67", "\146\151\x6c\164\x65\162\x5f\157\162\144\145\162", "\x73\150\137\160\x72\x5f\x6d\x65\x74\150\x6f\x64\137\x69\x64", "\x63\x6d\x64"); $direction = $application->getUserStateFromRequest("\x63\x6f\x6d\137\152\x73\x68\x6f\160\160\151\x6e\x67\56\x61\x64\144\x6f\156\137\x76\x65\156\144\157\x72\163\56\x73\x68\151\x70\160\x69\x6e\147\163\x70\162\x69\143\145\x73\x2e\x64\151\x72\145\143\164\x69\x6f\x6e", "\146\151\154\164\x65\162\137\157\162\x64\x65\162\x5f\x44\x69\162", "\144\x65\x73\x63", "\143\x6d\x64"); $shippingId = JRequest::getInt("\163\150\x69\x70\x70\151\x6e\147\137\151\144"); $shipping = JTable::getInstance("\163\150\151\x70\160\151\156\x67\115\x65\164\x68\157\144", "\152\163\150\157\x70"); $shipping->load($shippingId); $currency = JTable::getInstance("\143\x75\x72\x72\x65\156\143\171", "\152\x73\x68\157\160"); $currency->load(JSFactory::getConfig()->mainCurrency); $view = $this->getView("\x61\x64\144\157\x6e\137\166\145\156\x64\x6f\x72", "\x68\x74\x6d\154", '', array("\164\x65\155\160\x6c\x61\x74\145\137\x70\x61\164\150" => JPATH_ROOT . "\57\x63\x6f\155\160\x6f\156\145\x6e\164\x73\x2f\143\157\155\x5f\152\163\x68\157\x70\160\151\x6e\x67\x2f\164\145\x6d\160\x6c\x61\x74\145\x73\x2f\141\144\144\157\156\163\x2f\141\x64\144\x6f\156\x5f\166\145\x6e\144\x6f\162")); $view->setLayout("\x73\x68\x69\x70\x70\x69\x6e\x67\163\160\162\151\143\145\x73"); $view->assign("\x72\157\167\163", $addonModel->getShippingPrices($shippingId, $ordering, $direction)); $view->assign("\143\x75\162\162\145\156\x63\171", $currency); $view->assign("\x66\x69\x6c\164\x65\x72\x5f\157\x72\x64\145\x72", $ordering); $view->assign("\x66\x69\154\164\x65\x72\x5f\x6f\x72\144\145\162\137\x44\151\x72", $direction); $view->assign("\163\x68\151\x70\x70\x69\156\147", $shipping); appendPathWay(_JSHOP_SHIPPING_PRICES); $view->display(); } public function shippingsPriceEdit() { JSFactory::loadAdminLanguageFile(); $addonModel = JModelLegacy::getInstance("\141\x64\x64\157\x6e\x5f\x76\x65\156\144\x6f\162", "\112\163\150\157\x70\x70\x69\x6e\x67\x4d\157\144\x65\x6c"); $addonModel->checkUserSeller(); $addonModel->checkTasksAccess("\x73\150\x69\160\160\x69\x6e\x67\x73\x50\162\151\x63\x65\x45\144\151\x74"); $cid = JRequest::getVar("\x63\151\144", array(), "\x50\117\123\x54", "\x61\162\162\x61\x79"); $shippingsPriceId = (int) (count($cid) ? $cid[0] : JRequest::getInt("\x73\150\151\x70\160\x69\156\147\x5f\x70\x72\x69\143\x65\x5f\x69\x64")); $shippingsPrice = JTable::getInstance("\163\x68\x69\x70\x70\151\x6e\x67\115\145\164\x68\x6f\x64\120\162\151\143\145", "\152\163\150\157\x70"); $shippingsPrice->load($shippingsPriceId); $addonModel->checkShippingAccess($shippingsPrice->shipping_method_id); $shippingsPrice->prices = $shippingsPrice->getPrices(); $shippingsModel = JModelLegacy::getInstance("\x73\150\151\160\160\151\x6e\x67\163", "\x4a\163\150\x6f\x70\x70\x69\156\147\x4d\x6f\144\145\x6c"); $countriesModel = JModelLegacy::getInstance("\143\157\165\156\x74\162\x69\145\163", "\x4a\x73\x68\157\160\x70\151\156\147\115\x6f\144\x65\154"); $currency = JTable::getInstance("\x63\165\162\162\x65\156\x63\x79", "\152\163\150\157\x70"); $currency->load(JSFactory::getConfig()->mainCurrency); $view = $this->getView("\x61\144\144\157\156\137\166\145\x6e\144\157\x72", "\150\x74\155\154", '', array("\164\x65\x6d\160\x6c\x61\164\x65\137\x70\x61\x74\x68" => JPATH_ROOT . "\x2f\143\x6f\155\160\157\x6e\145\156\164\163\x2f\143\x6f\x6d\137\152\x73\x68\x6f\x70\x70\x69\156\x67\x2f\x74\x65\x6d\x70\x6c\141\x74\145\163\x2f\141\144\144\x6f\x6e\x73\x2f\141\144\144\x6f\156\137\166\145\156\x64\x6f\162")); $view->setLayout("\x73\150\x69\160\160\151\156\147\x73\160\162\151\x63\x65"); $view->assign("\x73\x68\137\155\145\x74\x68\x6f\144\x5f\x70\162\151\x63\145", $shippingsPrice); $view->assign("\164\141\170\117\x70\x74\x69\157\x6e\163", $addonModel->getTaxOptions()); $view->assign("\x63\157\165\156\164\162\x69\x65\163\x4f\x70\164\151\157\156\163", $countriesModel->getAllCountries(0)); $view->assign("\163\x68\151\160\x70\151\x6e\147\163\x4f\x70\x74\x69\x6f\156\x73", $shippingsModel->getAllShippings(0)); $view->assign("\x64\x65\154\151\166\x65\x72\x79\x54\x69\x6d\145\117\160\x74\151\x6f\x6e\163", $addonModel->getDeliveryTimeOptions()); $view->assign("\143\165\162\x72\145\156\143\171", $currency); $view->display(); } public function shippingsPriceSave() { JSession::checkToken() or die(JText::_("\112\111\x4e\x56\101\114\x49\104\137\x54\x4f\113\105\x4e")); $addonModel = JModelLegacy::getInstance("\x61\x64\144\157\156\137\166\145\x6e\144\x6f\162", "\112\x73\150\157\160\160\151\x6e\x67\x4d\x6f\x64\145\154"); $shippingId = JRequest::getInt("\x73\x68\151\x70\160\x69\x6e\x67\137\155\145\x74\x68\x6f\x64\x5f\151\144"); $addonModel->checkShippingAccess($shippingId); $post = JRequest::get("\160\x6f\163\164"); $post["\x73\150\x69\160\x70\x69\156\x67\x5f\x73\164\141\x6e\x64\137\160\x72\151\143\x65"] = saveAsPrice($post["\163\150\151\160\160\151\x6e\147\137\x73\164\x61\x6e\x64\x5f\x70\162\151\x63\145"]); $shippingPrice = JTable::getInstance("\x73\150\x69\160\x70\x69\x6e\147\115\x65\x74\x68\x6f\x64\120\162\x69\143\x65", "\x6a\163\x68\157\x70"); $shippingPrice->bind($post); $shippingPrice->setParams(''); if (isset($post["\x73\155\137\160\141\162\141\x6d\163"])) { $shippingPrice->setParams($post["\x73\155\x5f\160\x61\162\141\155\163"]); } if ($shippingPrice->store()) { $shippingsModel = JModelLegacy::getInstance("\163\150\151\x70\160\151\156\147\163", "\x4a\x73\x68\157\x70\160\151\x6e\x67\x4d\157\144\x65\154"); $shippingsModel->savePrices($shippingPrice->sh_pr_method_id, $post); $shippingsModel->saveCountries($shippingPrice->sh_pr_method_id, JRequest::getVar("\163\150\x69\160\x70\151\156\147\137\x63\157\165\x6e\x74\x72\151\145\163\137\151\x64")); } $this->setRedirect(SEFLink("\151\x6e\144\x65\x78\56\x70\x68\x70\x3f\x6f\160\x74\x69\157\x6e\x3d\x63\157\x6d\137\x6a\163\x68\x6f\160\160\x69\x6e\147\46\x63\157\156\164\162\x6f\154\154\x65\x72\75\x61\x64\x64\x6f\156\x5f\x76\145\x6e\144\157\162\46\x74\x61\x73\153\75\x73\150\151\x70\160\x69\x6e\x67\163\x50\x72\x69\x63\145\163\46\x73\x68\x69\160\x70\x69\156\147\x5f\151\144\75" . $shippingId, 1, 1)); } public function shippingsPriceDelete() { JSession::checkToken() or die(JText::_("\x4a\x49\116\x56\x41\114\x49\104\x5f\124\117\x4b\x45\x4e")); $addonModel = JModelLegacy::getInstance("\x61\144\144\157\x6e\x5f\x76\x65\156\144\157\162", "\x4a\163\150\x6f\x70\x70\151\156\147\115\157\x64\x65\x6c"); $cid = JRequest::getVar("\143\x69\x64", array(), "\x50\117\123\124", "\141\162\x72\141\171"); $shippingId = JRequest::getInt("\x73\x68\151\x70\x70\x69\x6e\147\x5f\x69\144"); $shippingPrice = JTable::getInstance("\x73\150\151\x70\x70\151\156\147\115\145\164\150\157\x64\120\x72\x69\x63\145", "\x6a\163\x68\157\160"); $addonModel->deleteShippingsPricesByIds($cid); $this->setRedirect(SEFLink("\151\x6e\144\x65\x78\x2e\x70\x68\x70\77\157\160\164\151\x6f\x6e\x3d\x63\157\155\x5f\x6a\163\x68\x6f\160\x70\151\156\147\x26\x63\157\x6e\x74\x72\157\154\154\145\x72\x3d\141\x64\144\157\156\137\x76\x65\156\144\157\162\x26\164\x61\163\x6b\75\x73\150\x69\160\160\151\156\147\163\x50\x72\151\x63\145\163\46\x73\150\151\160\160\x69\x6e\x67\137\x69\x64\x3d" . $shippingId, 1, 1)); } public function shippingsPriceCancel() { $this->setRedirect(SEFLink("\151\x6e\x64\145\x78\x2e\x70\150\x70\x3f\x6f\x70\x74\x69\157\156\75\x63\x6f\x6d\x5f\x6a\x73\150\x6f\x70\160\x69\x6e\147\46\x63\x6f\156\x74\x72\157\154\x6c\145\x72\75\141\144\144\157\156\x5f\x76\145\156\144\157\162\x26\164\141\x73\x6b\75\163\x68\x69\x70\160\151\156\147\x73\120\162\x69\x63\x65\x73\46\163\150\151\x70\160\x69\x6e\147\137\x69\x64\75" . JRequest::getVar("\x73\x68\151\160\x70\x69\156\147\137\x6d\x65\x74\150\157\144\137\x69\144"), 1, 1)); } public function reviewsave() { JSession::checkToken() or die(JText::_("\112\x49\x4e\126\101\114\x49\104\x5f\x54\x4f\113\x45\116")); $vendor_id = JRequest::getInt("\166\145\x6e\x64\x6f\162\137\151\x64"); $return_link = SEFLink("\x69\156\x64\x65\170\56\160\150\x70\77\x6f\160\164\x69\157\x6e\x3d\143\x6f\155\x5f\x6a\x73\150\x6f\x70\x70\x69\x6e\x67\46\x63\157\156\164\x72\x6f\154\x6c\x65\162\75\x76\145\x6e\144\157\x72\x26\164\141\163\x6b\75\x69\x6e\x66\x6f\x26\166\145\x6e\x64\157\162\x5f\x69\144\75" . $vendor_id, 1, 1); $addon_model = JModelLegacy::getInstance("\141\x64\x64\x6f\x6e\x5f\166\145\156\144\x6f\162", "\112\163\150\x6f\x70\x70\x69\156\147\x4d\157\144\145\x6c"); $config = $addon_model->getVendorsConfig(); $addon_model->checkTasksAccess("\x72\145\x76\x69\145\x77\x53\x61\x76\x65"); $review = JTable::getInstance("\126\x65\x6e\144\157\x72\163\122\145\x76\151\x65\167", "\x6a\x73\150\x6f\160"); $review->bind(JRequest::get("\160\157\163\164")); $review->user_id = JSFactory::getUserShop()->user_id; $review->date = date("\x59\x2d\x6d\55\144\40\110\72\151\x3a\x73"); $review->published = $config->vendor_reviews_moderation_enabled ? 0 : 1; $message = null; $message_type = null; if ($config->vendor_reviews_moderation_enabled) { $message = _JSHOP_VENDOR_REVIEW_MODERATION_MESSAGE; $message_type = "\x6d\x65\163\x73\x61\x67\x65"; } if (!$review->store()) { $message = $shipping->getError(); $message_type = "\145\162\x72\157\x72"; } $this->setRedirect($return_link, $message, $message_type); } public function order_status_save() { $order_id = JRequest::getInt("\x6f\162\x64\x65\162\137\x69\x64"); $status = JRequest::getInt("\157\x72\x64\x65\162\137\163\x74\141\x74\x75\x73"); $status_id = $status; $notify = 1; $comments = ''; $addon_vendor = $this->getModel("\141\144\144\157\x6e\x5f\x76\145\x6e\144\157\162"); $vndConfig = $addon_vendor->getVendorsConfig(); $order = $addon_vendor->getOrder($order_id); $order_status_modify = $vndConfig->order_status_modify && $order->vendor_id != -1; if ($order_status_modify) { $model = JSFactory::getModel("\x6f\x72\x64\145\x72\103\x68\141\x6e\147\145\123\x74\141\164\x75\163", "\152\163\150\157\160"); $model->setData($order_id, $status, $sendmessage, $status_id, $notify, $comments, $include, 0); $model->setAppAdmin(1); $model->store(); $message = _VF_ORDER_STATUS_CHANGED; } else { $message = "\x45\162\162\x6f\x72"; } $return_link = SEFLink("\x69\156\x64\x65\x78\56\160\150\x70\77\x6f\160\164\x69\x6f\156\x3d\x63\157\x6d\137\x6a\x73\x68\157\x70\160\x69\156\x67\46\143\157\x6e\164\x72\157\154\x6c\145\x72\75\141\x64\144\157\156\x5f\166\145\156\x64\x6f\162\46\164\141\163\153\75\157\162\x64\145\x72\46\157\x72\144\145\162\x5f\x69\144\75" . $order_id, 1, 1); $this->setRedirect($return_link, $message); } }